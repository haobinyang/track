{"version":3,"sources":["icons/MenuAudio.tsx","icons/MenuImage.tsx","icons/MenuMine.tsx","icons/MenuShape.tsx","icons/MenuText.tsx","icons/MenuTransition.tsx","icons/MenuVideo.tsx","common/types/asset.ts","asset/audios.ts","common/types/player.ts","asset/transitions.ts","common/components/Draggable/config.ts","asset/index.ts","asset/videos.ts","asset/images.ts","asset/gifs.ts","asset/texts.ts","common/styleds/index.tsx","common/utils/index.ts","common/components/Draggable/index.tsx","common/types/clip.ts","player/clips/base.ts","player/clips/audio.ts","player/painter/shader.ts","player/effects/index.ts","player/effects/noEffect.ts","player/effects/gray.ts","player/effects/blur.ts","common/utils/watch.ts","player/clips/image.ts","player/clips/lottie.ts","player/clips/svg.ts","player/clips/text.ts","player/transitions/index.ts","player/transitions/morph.ts","player/transitions/dreamy.ts","player/transitions/fade.ts","player/clips/transition.ts","player/clips/video.ts","common/libs/queue.ts","ffmpeg/util.ts","ffmpeg/index.ts","player/clips/gif.ts","player/util.ts","editor/config.ts","editor/util.ts","editor/components/AssetCard/components/AudioCard/index.tsx","editor/components/AssetCard/components/GifCard/index.tsx","editor/components/AssetCard/components/ImageCard/index.tsx","common/configs/clip.ts","editor/components/AssetCard/components/TextCard/index.tsx","editor/components/AssetCard/components/TransitionCard/index.tsx","editor/components/AssetCard/components/VideoCard/index.tsx","editor/components/AssetCard/styled.tsx","editor/components/AssetCard/index.tsx","editor/components/SideBar/components/AudioPanel/index.tsx","editor/components/SideBar/components/ImagePanel/index.tsx","editor/components/SideBar/components/MenuItem/styled.tsx","editor/components/SideBar/components/MenuItem/index.tsx","editor/components/SideBar/components/MinePanel/index.tsx","editor/components/SideBar/components/ShapePanel/index.tsx","editor/components/SideBar/components/TextPanel/index.tsx","editor/components/SideBar/components/TransitionPanel/index.tsx","editor/components/SideBar/components/VideoPanel/index.tsx","editor/components/SideBar/styled.tsx","editor/components/SideBar/index.tsx","icons/IndicatorBar.tsx","editor/components/Tracks/components/TrackElement/components/AudioTrack/index.tsx","workers/gifToCanvas.worker.ts","editor/components/Tracks/components/TrackElement/components/GifTrack/index.tsx","editor/components/Tracks/components/TrackElement/components/ImageTrack/index.tsx","editor/components/Tracks/components/TrackElement/components/VideoTrack/index.tsx","editor/components/Tracks/components/TrackElement/styled.tsx","editor/components/Tracks/components/TrackElement/index.tsx","editor/components/Tracks/components/Track/styled.tsx","editor/components/Tracks/components/Track/index.tsx","editor/components/Tracks/styled.tsx","editor/components/Tracks/index.tsx","editor/styled.tsx","editor/components/Ruler/styled.tsx","editor/components/Ruler/index.tsx","editor/hooks/keyboard.ts","player/painter/index.ts","player/index.ts","editor/hooks/player.ts","common/components/EffectSelector/index.tsx","common/components/FitSelector/index.tsx","editor/components/ConfigPanel/components/ImagePanel/index.tsx","editor/components/ConfigPanel/components/VideoPanel/index.tsx","editor/components/ConfigPanel/index.tsx","icons/Logo.tsx","editor/components/Header/styled.tsx","editor/components/Header/index.tsx","icons/BackForward.tsx","icons/Cut.tsx","icons/Delete.tsx","icons/FastForward.tsx","icons/pauseButton.tsx","icons/PlayButton.tsx","icons/Redo.tsx","icons/Undo.tsx","editor/components/ToolBar/styled.tsx","editor/components/ToolBar/index.tsx","editor/components/ResizeRotate/components/TextEditor/index.tsx","editor/components/ResizeRotate/styled.tsx","editor/components/ResizeRotate/index.tsx","editor/index.tsx","index.tsx","../external \"THREE\"","../external \"FFmpeg\""],"names":["MenuAudio","props","xmlns","width","height","fill","x","y","rx","stroke","strokeWidth","MenuImage","MenuMine","MenuShape","MenuText","MenuTransition","MenuVideo","AssetType","FitType","EffectType","TransitionType","OverlayType","MoveDirection","TRANSITIONS","name","transition","DREAMY","FADE","ASSET","videos","url","map","video","type","VIDEO","images","image","IMAGE","audios","audio","AUDIO","transitions","TRANSITION","gifs","gif","GIF","texts","value","text","TEXT","Radius10Button","styled","div","Radius99Button","MenuItemContainer","AssetCardContainer","StyledAssetCard","formatMillisecond","ms","showMS","showHour","result","msRemainder","String","padStart","seconds","secondRemainder","minutes","minuteRemainder","hours","svgToCanvas","svg","canvas","canvasContext","Promise","resolve","reject","Image","onload","clearRect","drawImage","onerror","error","src","btoa","unescape","encodeURIComponent","trim","downloadFile","fileURL","fileName","saveLink","document","createElement","href","target","download","navigator","userAgent","toLowerCase","match","search","location","event","MouseEvent","view","window","bubbles","cancelable","dispatchEvent","URL","webkitURL","revokeObjectURL","getTextClipCssText","clip","fontColor","fontSize","fontFamily","join","getTextClipSize","container","querySelector","setAttribute","body","appendChild","innerText","style","cssText","bound","getBoundingClientRect","Math","ceil","ClipType","Draggable","children","direction","ALL","scrollContainerSelector","autoGrow","enable","attachData","slow","onStart","onMove","onEnd","childRef","useRef","shiftX","shiftY","timer","originalStyle","originalLeft","originalTop","preLeft","preTop","isEnd","count","isMoved","isHoverScrollContainer","useState","dragInfo","setDragInfo","useEffect","current","undefined","move","useCallback","el","pageX","pageY","transformStyle","EW","NS","transform","handleHold","step","wrapper","scrollContainer","setInterval","wrapperRect","scrollLeft","clientWidth","handleScroll","below","clearInterval","scrollThreshold","closest","parentElement","right","min","left","handleMouseMove","e","hidden","elementFromPoint","clientX","clientY","currentLeft","currentTop","stepLeft","stepTop","element","belowElement","top","cursorLeft","cursorTop","handleMouseUp","classList","remove","removeEventListener","handleMouseDown","stopPropagation","getAttribute","styles","Object","keys","forEach","key","setProperty","replace","setStyles","add","addEventListener","React","cloneElement","ref","ClipBase","config","player","isAttachToPainter","isEntered","painter","sprite","texture","this","visible","playRange","end","start","id","isManual","removeFromPainter","Audio","context","AudioContext","audioBuffer","source","playbackRate","isPlaying","getAudioBuffer","updatePlaybackRate","alert","decodeAudioData","buffer","slice","createBufferSource","loop","currentTime","positionInTimeline","connect","destination","stop","originalDuration","duration","play","pause","calcUVMap","fitType","playerWidth","playerHeight","currentWidth","currentHeight","originalWidth","originalHeight","translateInPixel","THREE","texWidth","texHeight","translate","clone","CONTAIN","playerRatio","texRatio","set","COVER","FILL","uRange","vRange","Shader","glsl","effect","fromEffect","toEffect","effectMap","NO_EFFECT","uniforms","fragment","texName","funName","GRAY","BLUR","blurSize","horizontalPass","sigma","texOffset","effects","watchList","Map","watch","watchObj","callback","has","Set","get","currentVal","defineProperty","newVal","oldVal","item","geometry","material","initRender","watchChange","val","position","z","fragmentShader","GetEffectFragment","uniformsNeedUpdate","needsUpdate","positionInRender","bottom","load","blobUrl","createTexture","tex","vertexShader","GetVertex","transparent","zIndex","dispose","Lottie","lottie","goToAndStop","Svg","initCanvas","getRealSize","getContext","func","Text","initTexture","transitionMap","freeze","MORPH","strength","Transition","fromClip","toClip","updateShader","updateUniforms","fromOriginalWidth","fromOriginalHeight","fromCurrentWidth","fromCurrentHeight","fromFitType","toOriginalWidth","toOriginalHeight","toCurrentWidth","toCurrentHeight","toFitType","fromURange","fromVRange","toURange","toVRange","fromUniforms","fromFragment","toUniforms","toFragment","transitionUniforms","transitionFragment","GetTransitionFragment","fromId","toId","getClipById","from","to","progress","hide","render","show","Video","a","autoplay","setCurrentTime","abs","newCurrentTime","correctVideoCurrentTime","AsyncAutoQueue","items","pendingPromise","action","push","dequeue","then","catch","Error","finally","shift","payload","extractDuration","field","split","extractVideoInfo","infoItems","resolution","codec","colorSpace","parseInt","fps","extractAudioInfo","Hz","getAudioTempoChain","tempo","toFixed","FFmpegHelperClass","FFmpegHelper","ffmpeg","isLoaded","run","inputFileName","v4","outputFileName","FS","Uint8Array","mediaInfo","setLogger","message","includes","inputs","index","flat","filters","delay","amixPrefix","length","frames","toString","videoBuffer","videoFileName","audioFileName","finalVideo","createFFmpeg","log","asyncQueue","Proxy","prop","args","enqueue","Load","apply","Gif","textureData","currentFrame","data","Uint8ClampedArray","flipY","patch","sumFrameDelay","i","frame","getFrame","createClip","SVG","LOTTIE","canvasToArrayBuffer","toBlob","blob","arrayBuffer","generateVideo","interval","getDomElement","imageData","ImagesToVideo","getAudioMergeItemFromPlayer","clips","getOriginalDuration","generateAudio","audioMergeItems","MergeAudios","all","MergeVideoAudio","finalVideoBuffer","createObjectURL","Blob","getClipRenderInfo","TRACK_WRAPPER_CLASS_NAME","SECOND_WIDTH","INIT_EDITOR_CONTEXT","hoverTrack","setHoverTrack","tracks","setTracks","newTrackIndex","setNewTrackIndex","activeClipId","setActiveClipId","totalDuration","setTotalDuration","setIsPlaying","setDraggingClip","trackWrapperSelector","cursorPositionToElementPosition","cursorPosition","rect","max","cursorPositionToTracksWrapperPosition","tracksWrapper","paddingLeft","getComputedStyle","getTrackIndex","track","Array","prototype","call","querySelectorAll","indexOf","getTrackWrapper","contains","getTrackAndClipIndex","j","trackIndex","clipIndex","needShowPrepareTrack","millisecondsToWidth","milliseconds","widthToMilliseconds","round","getClipInsertIndex","cursorX","getAvailableStartAndEnd","prepareInsertIndex","pre","next","adjustStartAndEnd","availableRange","insertRange","diff","getTotalDuration","lastClip","canWithTransition","clipType","isTransitionStart","clipId","filter","findIndex","isTransitionEnd","deleteSelectedClip","editorContextValue","afterToClip","newRange","assign","splice","splitSelectedClip","canSplit","splitPercent","splitTime","getPlayerContainerBounding","playerContainer","toJSON","AudioCard","onLoaded","fetch","response","file","className","GifCard","parseGIF","decompressFrames","lsd","alt","draggable","ImageCard","img","naturalWidth","naturalHeight","TextCard","TransitionCard","VideoCard","videoWidth","videoHeight","StyledCard","getAssetCard","handleLoaded","AssetCard","useContext","editorContext","loaded","setLoaded","asset","common","rotate","CUSTOM","assetToClip","setClip","handleStart","handleMove","pos","showPrepareTrack","clientHeight","handleTransitionEnd","dataset","halfTransitionDuration","newClip","handleEnd","belowTrack","availableDuration","dragElementWidth","finalStart","finalEnd","renderWidth","renderHeight","AudioPanel","ImagePanel","ResourcePanel","MenuItem","icon","title","resourcePanel","isActive","onClick","handleClick","MinePanel","ShapePanel","TextPanel","TransitionPanel","VideoPanel","StyledSideBar","menuList","SideBar","activeTab","setActiveTab","handleMenuItemClick","IndicatorBar","d","filterUnits","colorInterpolationFilters","floodOpacity","in","values","dy","stdDeviation","in2","operator","AudioTrack","containerRef","waveSurfer","WaveSurfer","create","waveColor","progressColor","fillParent","partialRender","interact","destroy","Worker_fn","Worker","worker","snapCount","postMessage","GifTrack","canvasRef","workerRef","WebWorker","offscreenCanvas","transferControlToOffscreen","drawToCanvas","transformOrigin","memo","imageUrl","snapWidth","snapHeight","ctx","ImageTrack","drawImageToCanvas","seekVideo","seeked","videoUrl","timeStep","VideoTrack","drawVideoToCanvas","StyledTrackElement","StyledName","StyledHandle","transitionStyle","border","getTrackComponent","TrackElement","onUpdate","handleTransition","newStart","updated","originalTrackIndex","before","after","handleLeftHandleMove","preClipEnd","handleRightHandleMove","newEnd","nextClipStart","handleHandleEnd","isTransition","StyledTrackWrapper","StyledTrack","StyledNewPrepareTrack","Track","draggingClip","hoverIndex","handleUpdate","oldData","newData","newClipIndex","isNewTrack","isDraggingTransition","background","clip1","clip2","nextClip","showTransitionPrepareInsert","Fragment","opacity","StyledTracksWrapper","StyledTracks","StyledIndicator","Tracks","onCurrentTimeChange","trackStyle","handleCurrentTimeChange","handleTracksWrapperClick","StyledEditor","StyledEditorLeft","StyledEditorRight","StyledStageTimeline","StyledTimelineWrapper","TracksScrollContainer","Stage","StyledRuler","StyledRulerItem","Ruler","setWidth","observer","ResizeObserver","observe","disconnect","useKeyboard","playerContext","useKeyPress","useDeleteClip","useSplitClip","handleIsPlayingChange","usePlayControl","Painter","scene","camera","renderer","maxAnisotropy","preserveDrawingBuffer","antialias","setPixelRatio","setSize","capabilities","getMaxAnisotropy","selectedObject","getObjectByName","getDrawingBufferSize","domElement","Player","tickTime","rafId","tickFunc","onCurrentTimeChangeCallback","tick","bind","requestAnimationFrame","time","find","init","updateDuration","isInRange","addToPainter","onEnter","onLeave","intTime","floor","task","cancelAnimationFrame","parentNode","removeChild","tracksChanged","newClips","deleteClips","addClip","removeClip","EffectSelector","onChange","onSelect","Option","FitSelector","handleEffectChange","handleFitChange","getPanel","ConfigPanel","activeClip","setActiveClip","handleChange","Logo","xmlnsXlink","patternContentUnits","xlinkHref","StyledHeader","ExportButton","Header","handleExportVideo","exportAsVideo","BackForward","fillRule","clipRule","Cut","Delete","FastForward","PauseButton","PlayButton","Redo","Undo","StyledToolBar","PlayerControl","PlayButtons","Time","Ratios","ClipOperators","TimeLineZoom","ToolBar","handlePlayingChange","handleDelete","handleSplitClip","handleSetToStart","handleSetToEnd","color","marginRight","TextEditor","contentEditableRef","newSize","handleBlur","console","overflow","innerRef","html","disabled","onBlur","StyledTarget","renderDirections","ResizeRotate","setTarget","targetStyle","setTargetStyle","useMemo","playerLeft","handleDragStart","handleDrag","delta","beforeTranslate","handleResizeStart","setOrigin","dragStart","handleResize","drag","isDragBottom","isDragLeft","origin","edge","throttleDrag","onDragStart","onDrag","keepRatio","resizable","throttleResize","onResizeStart","onResize","createContext","Editor","playerContainerRef","handleTracksChange","newTracks","newTotalDuration","newWidth","playerRef","attachTo","playerData","flatNewData","instance","findDiff","usePlayer","handleDocumentClick","Provider","ReactDOM","StrictMode","getElementById","module","exports","FFmpeg"],"mappings":"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","file":"static/js/main.aa413bd1.chunk.js","sourcesContent":["import * as React from 'react';\n\nfunction MenuAudio(props: React.SVGProps<SVGSVGElement>) {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width={30}\n      height={30}\n      fill=\"none\"\n      {...props}\n    >\n      <rect\n        x={1}\n        y={1}\n        width={28}\n        height={28}\n        rx={9}\n        stroke=\"#C9AE4D\"\n        strokeWidth={2}\n      />\n    </svg>\n  );\n}\n\nexport default MenuAudio;\n","import * as React from 'react';\n\nfunction MenuImage(props: React.SVGProps<SVGSVGElement>) {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width={30}\n      height={30}\n      fill=\"none\"\n      {...props}\n    >\n      <rect\n        x={1}\n        y={1}\n        width={28}\n        height={28}\n        rx={9}\n        stroke=\"#38AA26\"\n        strokeWidth={2}\n      />\n    </svg>\n  );\n}\n\nexport default MenuImage;\n","import * as React from 'react';\n\nfunction MenuMine(props: React.SVGProps<SVGSVGElement>) {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width={30}\n      height={30}\n      fill=\"none\"\n      {...props}\n    >\n      <rect\n        x={1}\n        y={1}\n        width={28}\n        height={28}\n        rx={9}\n        stroke=\"#C9AE4D\"\n        strokeWidth={2}\n      />\n    </svg>\n  );\n}\n\nexport default MenuMine;\n","import * as React from 'react';\n\nfunction MenuShape(props: React.SVGProps<SVGSVGElement>) {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width={30}\n      height={30}\n      fill=\"none\"\n      {...props}\n    >\n      <rect\n        x={1}\n        y={1}\n        width={28}\n        height={28}\n        rx={9}\n        stroke=\"#C9AE4D\"\n        strokeWidth={2}\n      />\n    </svg>\n  );\n}\n\nexport default MenuShape;\n","import * as React from 'react';\n\nfunction MenuText(props: React.SVGProps<SVGSVGElement>) {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width={30}\n      height={30}\n      fill=\"none\"\n      {...props}\n    >\n      <rect\n        x={1}\n        y={1}\n        width={28}\n        height={28}\n        rx={9}\n        stroke=\"#AA269D\"\n        strokeWidth={2}\n      />\n    </svg>\n  );\n}\n\nexport default MenuText;\n","import * as React from 'react';\n\nfunction MenuTransition(props: React.SVGProps<SVGSVGElement>) {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width={30}\n      height={30}\n      fill=\"none\"\n      {...props}\n    >\n      <rect\n        x={1}\n        y={1}\n        width={28}\n        height={28}\n        rx={9}\n        stroke=\"#864CFF\"\n        strokeWidth={2}\n      />\n    </svg>\n  );\n}\n\nexport default MenuTransition;\n","import * as React from 'react';\n\nfunction MenuVideo(props: React.SVGProps<SVGSVGElement>) {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width={30}\n      height={30}\n      fill=\"none\"\n      {...props}\n    >\n      <rect\n        x={1}\n        y={1}\n        width={28}\n        height={28}\n        rx={9}\n        stroke=\"#367CE4\"\n        strokeWidth={2}\n      />\n    </svg>\n  );\n}\n\nexport default MenuVideo;\n","import { TransitionType } from './player';\n\nexport enum AssetType {\n  VIDEO,\n  IMAGE,\n  AUDIO,\n  TRANSITION,\n  GIF,\n  TEXT,\n}\n\nexport interface Asset {\n  name: string;\n  type: AssetType;\n}\n\nexport interface VideoAsset extends Asset {\n  url: string;\n}\n\nexport interface ImageAsset extends Asset {\n  url: string;\n}\n\nexport interface AudioAsset extends Asset {\n  url: string;\n}\n\nexport interface GifAsset extends Asset {\n  url: string;\n}\n\nexport interface TextAsset extends Asset {\n  value: string;\n}\n\nexport interface TransitionAsset extends Asset {\n  transition: TransitionType;\n}\n","export const AUDIOS = [\n  {\n    name: 'sky',\n    url: '1.mp3',\n  },\n  {\n    name: 'jay',\n    url: '2.mp3',\n  },\n];\n","import { ObjectType } from '.';\n\nexport enum FitType {\n  CUSTOM,\n  /** 铺满整个播放器，不考虑长宽比 */\n  FILL,\n  /** 保持长宽比，不会被裁剪，可能没法铺满整个播放器 */\n  CONTAIN,\n  /** 铺满整个播放器，同时保持长宽比，可能存在裁剪 */\n  COVER,\n}\n\nexport enum EffectType {\n  NO_EFFECT,\n  BLUR,\n  GRAY,\n}\n\nexport interface Effect {\n  uniforms: ObjectType;\n  fragment: (texName?: string, funName?: string) => string;\n}\n\nexport enum TransitionType {\n  MORPH,\n  DREAMY,\n  FADE,\n}\n\nexport enum OverlayType {\n  PLUNGING,\n}\n","import { TransitionType } from '../common/types/player';\n\nexport const TRANSITIONS = [\n  {\n    name: 'dreamy',\n    transition: TransitionType.DREAMY,\n  },\n  {\n    name: 'fade',\n    transition: TransitionType.FADE,\n  },\n];\n","export enum MoveDirection {\n  ALL,\n  EW, // 东西\n  NS, // 北南\n}\n","import {\n  AssetType,\n  AudioAsset,\n  GifAsset,\n  ImageAsset,\n  TextAsset,\n  TransitionAsset,\n  VideoAsset,\n} from '../common/types/asset';\nimport { AUDIOS } from './audios';\nimport { GIFS } from './gifs';\nimport { IMAGES } from './images';\nimport { TEXTS } from './texts';\nimport { TRANSITIONS } from './transitions';\nimport { VIDEOS } from './videos';\n\nexport const ASSET = {\n  videos: VIDEOS.map((video) => ({ type: AssetType.VIDEO, ...video })) as VideoAsset[],\n  images: IMAGES.map((image) => ({ type: AssetType.IMAGE, ...image })) as ImageAsset[],\n  audios: AUDIOS.map((audio) => ({ type: AssetType.AUDIO, ...audio })) as AudioAsset[],\n  transitions: TRANSITIONS.map((transition) => ({ type: AssetType.TRANSITION, ...transition })) as TransitionAsset[],\n  gifs: GIFS.map((gif) => ({ type: AssetType.GIF, ...gif })) as GifAsset[],\n  texts: TEXTS.map((text) => ({ type: AssetType.TEXT, ...text })) as TextAsset[],\n};\n","export const VIDEOS = [\n  {\n    name: 'leaf',\n    url: '1.mp4', //'https://adsmind.gdtimg.com/ads_svp_video__0b533eaaaaaa7iaef32e55qrvwieadmqaaca.f0.mp4?dis_k=db0de64d4f56c2015472040b1d4dbe05&dis_t=1631864114&m=0a60e4eff013efd2db2228ee7b92ac66',\n  },\n  {\n    name: 'sunflower',\n    url: 'https://adsmind.gdtimg.com/ads_svp_video__0b5356bikoyameao6cufayabuqaee7xqhbibaaaab3yk..mp4?dis_k=00336127182714ebee73d007e9ebd394&dis_t=1631259090&m=78f766034a7339a822b3a1881bf122b6',\n  },\n  {\n    name: 'cartoon',\n    url: '3.webm', //'https://adsmind.gdtimg.com/ads_svp_video__0b533eaaaaaa7iaef32e55qrvwieadmqaaca.f0.mp4?dis_k=db0de64d4f56c2015472040b1d4dbe05&dis_t=1631864114&m=0a60e4eff013efd2db2228ee7b92ac66',\n  },\n];\n","export const IMAGES = [\n  {\n    name: 'dawn',\n    url: 'https://images.unsplash.com/photo-1634322474954-d69e93a8480b?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=2370&q=80',\n  },\n];\n","export const GIFS = [\n  {\n    name: 'horses',\n    url: 'horses.gif',\n  },\n];\n","export const TEXTS = [\n  {\n    name: '文本',\n    value: '添加文本',\n  },\n];\n","import styled from 'styled-components';\n\nexport const Radius10Button = styled.div`\n  width: 30px;\n  height: 30px;\n  background: #1F2836;\n  border: 1px solid #222B3A;\n  box-sizing: border-box;\n  border-radius: 10px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n\n  &:hover {\n    background: #232d3d;\n  }\n`;\n\nexport const Radius99Button = styled.div`\n  height: 24px;\n  padding: 0 14px;\n  background: #1F2836;\n  box-sizing: border-box;\n  border-radius: 99px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  color: #92AEDA;\n\n  &:hover {\n    background: #263142;\n  }\n`;\n\nexport const MenuItemContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  margin-top: 20px;\n  padding: 8px 0;\n  cursor: pointer;\n  background-color: #1A2028;\n\n  &.active {\n    background-color: #384454;\n  }\n\n  &:hover {\n    background-color: #384454;\n  }\n\n  .icon {\n    width: 30px;\n    height: 30px;\n  }\n\n  .title {\n    margin-top: 10px;\n    font-size: 14px;\n    line-height: 16px;\n    color: #7185A6;\n  }\n`;\n\nexport const AssetCardContainer = styled.div`\n  width: 160px;\n  height: 90px;\n  margin: 20px 0 0 20px;\n`;\n\nexport const StyledAssetCard = styled.div`\n  width: 100%;\n  height: 100%;\n  border-radius: 6px;\n  cursor: move;\n  overflow: hidden;\n  position: relative;\n\n  img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    vertical-align: unset;\n  }\n\n  video {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n  }\n\n  .title {\n    position: absolute;\n    bottom: 10px;\n    left: 10px;\n    color: #fff;\n    text-shadow: #000 2px 0px 5px;\n    font-size: 14px;\n    height: 14px;\n    line-height: 14px;\n  }\n`;\n","import { TextClip } from '../types/clip';\n\nexport function getPixelRatio() {\n  return 2;\n}\n\nexport function setStyles(el: HTMLElement, styles: Partial<CSSStyleDeclaration>) {\n  Object.keys(styles).forEach((key) => {\n    // @ts-ignore\n    el.style.setProperty(key.replace(/([A-Z])/g, '-$1').toLowerCase(), styles[key as keyof CSSStyleDeclaration]);\n  });\n}\n\nexport function formatMillisecond(ms: number, showMS: boolean = false, showHour: boolean = true) {\n  let result = '';\n  const msRemainder = ms % 1000;\n  if (msRemainder || showMS) {\n    result = `.${String(msRemainder).padStart(3, '0')}`\n  }\n\n  const seconds = (ms - msRemainder) / 1000;\n  const secondRemainder = seconds % 60;\n  result = `${String(secondRemainder).padStart(2, '0')}${result}`;\n\n  const minutes = (seconds - secondRemainder) / 60;\n  const minuteRemainder = minutes % 60;\n  result = `${String(minuteRemainder).padStart(2, '0')}:${result}`;\n\n  const hours = (minutes - minuteRemainder) / 60;\n  if (showHour || hours) {\n    result = `${String(hours).padStart(2, '0')}:${result}`;\n  }\n  return result;\n}\n\nexport function svgToCanvas(svg: string, canvas: HTMLCanvasElement, canvasContext: CanvasRenderingContext2D | null | undefined) {\n  return new Promise((resolve, reject) => {\n    const { width, height } = canvas;\n    const image = new Image();\n    image.width = width;\n    image.height = height;\n    image.onload = function() {\n      if (canvasContext) {\n        canvasContext.clearRect(0, 0, width, height);\n        canvasContext.drawImage(image, 0, 0);\n      }\n      resolve(true);\n    };\n    image.onerror = function(error) {\n      reject(error);\n    };\n    image.src = `data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(svg.trim())))}`;\n  });\n}\n\nexport function sleep(ms: number) {\n  return new Promise((resolve) => {\n    window.setTimeout(resolve, ms);\n  });\n}\n\nexport function downloadFile(fileURL: string, fileName: string) {\n  const saveLink = document.createElement('a');\n  saveLink.href = fileURL;\n  saveLink.target = '_blank';\n  saveLink.download = fileName;\n  if (navigator.userAgent.toLowerCase().match(/(ipad|iphone|safari)/) && navigator.userAgent.search('Chrome') < 0) {\n    document.location = saveLink.href;\n  } else { // window event not working here\n    const event = new MouseEvent('click', {\n      view: window,\n      bubbles: true,\n      cancelable: false,\n    });\n    saveLink.dispatchEvent(event);\n    (window.URL || window.webkitURL).revokeObjectURL(saveLink.href);\n  }\n}\n\nexport function getTextClipCssText(clip: TextClip) {\n  const { fontColor, fontSize, fontFamily } = clip.props;\n  return [\n    `color:${fontColor}`,\n    `font-size:${fontSize}px`,\n    `font-family:${fontFamily}`,\n    'font-weight:200',\n    'display:inline-block',\n    'transform-origin:left top',\n    `transform:scale(${getPixelRatio()})`,\n  ].join(';');\n}\n\nexport function getTextClipSize(clip: TextClip) {\n  let container = document.querySelector('.div-for-text-size-calc') as HTMLDivElement;\n  if (!container) {\n    container = document.createElement('div');\n    container.setAttribute('class', 'div-for-text-size-calc');\n    document.body.appendChild(container);\n  }\n  container.innerText = clip.value;\n  container.style.cssText = getTextClipCssText(clip);\n  const bound = container.getBoundingClientRect();\n  return {\n    width: Math.ceil(bound.width),\n    height: Math.ceil(bound.height),\n  };\n}\n\nexport function textClipToSvg(clip: TextClip) {\n  return `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" height=\"100%\">\n    <foreignObject width=\"100%\" height=\"100%\">\n      <div xmlns=\"http://www.w3.org/1999/xhtml\">\n        <div style=\"${getTextClipCssText(clip)}\">\n          ${clip.value}\n        </div>\n      </div>\n    </foreignObject>\n  </svg>`;\n}\n","import React, { ReactElement, useCallback, useEffect, useRef, useState } from 'react';\nimport { setStyles } from '../../utils';\nimport { MoveDirection } from './config';\nimport { DragInfo } from './type';\n\ntype Props<T> = {\n  children: React.ReactElement;\n  direction?: MoveDirection;\n  scrollContainerSelector?: string;\n  autoGrow?: boolean;\n  enable?: boolean;\n  attachData?: T;\n  slow?: number;\n  onStart?(): void;\n  onMove?(dragInfo: DragInfo<T>): void;\n  onEnd?(dragInfo: DragInfo<T>): void;\n};\n\nconst Draggable = <T extends {}>({\n  children,\n  direction = MoveDirection.ALL,\n  scrollContainerSelector,\n  autoGrow,\n  enable = true,\n  attachData,\n  slow = 1,\n  onStart,\n  onMove,\n  onEnd,\n}: Props<T>): JSX.Element => {\n  const childRef = useRef<HTMLElement | null>(null);\n  const shiftX = useRef(0);\n  const shiftY = useRef(0);\n  const timer = useRef(0);\n  const originalStyle = useRef('');\n  const originalLeft = useRef(0);\n  const originalTop = useRef(0);\n  const preLeft = useRef(0);\n  const preTop = useRef(0);\n  const isEnd = useRef(false);\n  const count = useRef(0);\n  const isMoved = useRef(false);\n  const isHoverScrollContainer = useRef(false);\n\n  const [dragInfo, setDragInfo] = useState<DragInfo<T>>();\n  useEffect(() => {\n    if (dragInfo) {\n      if (isEnd.current) {\n        count.current = 0;\n        onEnd?.(dragInfo);\n      } else {\n        count.current = count.current + 1;\n        (count.current % slow) === 0 && onMove?.(dragInfo);\n      }\n      setDragInfo(undefined);\n    }\n  }, [dragInfo, onEnd, onMove, slow]);\n\n  /**\n   * 更新拖拽元素的位置\n   */\n  const move = useCallback((el: HTMLElement, pageX: number, pageY: number) => {\n    let transformStyle = '';\n    if (MoveDirection.ALL === direction) {\n      transformStyle = `translate(${pageX - shiftX.current}px, ${pageY - shiftY.current}px)`;\n    }\n    if (MoveDirection.EW === direction) {\n      transformStyle = `translate(${pageX - shiftX.current}px, ${originalTop.current}px)`;\n    }\n    if (MoveDirection.NS === direction) {\n      transformStyle = `translate(${originalLeft.current}px, ${pageY - shiftY.current}px)`;\n    }\n    el.style.transform = transformStyle;\n  }, [direction]);\n\n  const handleHold = useCallback((step: number, wrapper: HTMLElement, scrollContainer: HTMLElement) => {\n    timer.current = window.setInterval(() => {\n      const wrapperRect = wrapper.getBoundingClientRect();\n      if (step > 0 && autoGrow && (wrapper.scrollLeft + wrapperRect.width) > (scrollContainer.clientWidth - 100)) {\n        scrollContainer.style.width = `${scrollContainer.clientWidth + 100}px`;\n      }\n      wrapper.scrollLeft += step * 2; // hold的时候加快速度\n    }, 1000 / 60);\n  }, [autoGrow]);\n\n  /**\n   * 更新指定容器的滚动位置\n   */\n  const handleScroll = useCallback((below: HTMLElement, pageX: number, pageY: number) => {\n    if (timer) {\n      window.clearInterval(timer.current);\n      timer.current = 0;\n    }\n    if (scrollContainerSelector) {\n      const scrollThreshold = 100;\n      const scrollContainer = document.querySelector(scrollContainerSelector) as HTMLElement;\n      if (!isHoverScrollContainer.current) {\n        if (!below?.closest(scrollContainerSelector)) { // 如果不在滚动容器内，则不滚动\n          return;\n        } else {\n          isHoverScrollContainer.current = true;\n        }\n      }\n      if (scrollContainer?.parentElement) {\n        const wrapper = scrollContainer.parentElement;\n        const wrapperRect = wrapper.getBoundingClientRect();\n        let step = 0;\n        if (pageX > wrapperRect.right - scrollThreshold) { // 向右👉\n          if (autoGrow && (wrapper.scrollLeft + wrapperRect.width) > (scrollContainer.clientWidth - 100)) {\n            scrollContainer.style.width = `${scrollContainer.clientWidth + 100}px`;\n          }\n          step = 5 * (1 + Math.min((pageX - wrapperRect.right + scrollThreshold) / scrollThreshold, 1));\n        } else if (pageX < wrapperRect.left + scrollThreshold) { // 👈向左\n          step = -5 * (1 + Math.min((wrapperRect.left + scrollThreshold - pageX) / scrollThreshold, 1));\n        }\n        if (step !== 0) {\n          wrapper.scrollLeft += step;\n          handleHold(step, wrapper, scrollContainer);\n        }\n      }\n    }\n  }, [autoGrow, handleHold, scrollContainerSelector]);\n\n  const handleMouseMove = useCallback((e: MouseEvent) => {\n    const el = childRef.current;\n    if (el) {\n      el.hidden = true;\n      const below = document.elementFromPoint(e.clientX, e.clientY) as HTMLElement;\n      move(el, e.pageX, e.pageY);\n      handleScroll(below, e.pageX, e.pageY);\n      const currentLeft = e.pageX - shiftX.current;\n      const currentTop = e.pageY - shiftY.current;\n      const stepLeft = currentLeft - preLeft.current;\n      const stepTop = currentTop - preTop.current;\n      if (stepLeft !== 0 || stepTop !== 0) {\n        isMoved.current = true;\n        setDragInfo({\n          element: el,\n          belowElement: below,\n          left: currentLeft,\n          top: currentTop,\n          originalLeft: originalLeft.current,\n          originalTop: originalTop.current,\n          stepLeft: currentLeft - preLeft.current,\n          stepTop: currentTop - preTop.current,\n          cursorLeft: e.pageX,\n          cursorTop: e.pageY,\n          attachData,\n          isMoved: isMoved.current,\n        });\n        preLeft.current = currentLeft;\n        preTop.current = currentTop;\n      }\n      el.hidden = false;\n    }\n  }, [move, handleScroll, attachData]);\n\n  const handleMouseUp = useCallback((e: MouseEvent) => {\n    const { pageX, pageY } = e;\n    const el = childRef.current;\n    if (el) {\n      el.hidden = true;\n      const below = document.elementFromPoint(e.clientX, e.clientY) as HTMLElement;\n      el.hidden = false;\n      el.classList.remove('dragged');\n      el.setAttribute('style', originalStyle.current);\n      isEnd.current = true;\n      setDragInfo({\n        element: el,\n        belowElement: below,\n        left: pageX - shiftX.current,\n        top: pageY - shiftY.current,\n        originalLeft: originalLeft.current,\n        originalTop: originalTop.current,\n        stepLeft: 0,\n        stepTop: 0,\n        cursorLeft: pageX,\n        cursorTop: pageY,\n        attachData,\n        isMoved: isMoved.current,\n      });\n    }\n    window.clearInterval(timer.current);\n    window.removeEventListener('mousemove', handleMouseMove, false);\n    window.removeEventListener('mouseup', handleMouseUp, false);\n  }, [attachData, handleMouseMove]);\n\n  const handleMouseDown = useCallback((e: MouseEvent) => {\n    e.stopPropagation();\n    if (childRef.current) {\n      isEnd.current = false;\n      const el = childRef.current;\n      const { left, top, width, height } = el.getBoundingClientRect();\n      shiftX.current = e.clientX - left;\n      shiftY.current = e.clientY - top;\n\n      // 保留原样式\n      originalStyle.current = el.getAttribute('style') || '';\n      originalLeft.current = left;\n      originalTop.current = top;\n      preLeft.current = left;\n      preTop.current = top;\n      isHoverScrollContainer.current = false;\n      isMoved.current = false;\n\n      setStyles(el, {\n        transform: `translate(${left}px, ${top}px)`,\n        width: `${width}px`,\n        height: `${height}px`,\n      });\n      el.classList.add('dragged');\n      onStart?.();\n      move(el, e.pageX, e.pageY);\n      window.addEventListener('mousemove', handleMouseMove, false);\n      window.addEventListener('mouseup', handleMouseUp, false);\n    }\n  }, [handleMouseMove, handleMouseUp, move, onStart]);\n\n  useEffect(() => {\n    const container = childRef.current;\n    if (container && enable) {\n      container.addEventListener('mousedown', handleMouseDown, false);\n      return () => {\n        container.removeEventListener('mousedown', handleMouseDown, false);\n      };\n    }\n  }, [childRef, enable, handleMouseDown]);\n  return (\n    <>\n      {\n        React.cloneElement(children as ReactElement, {\n          ref: (ref: HTMLElement) => (childRef.current = ref),\n        })\n      }\n    </>\n  );\n};\n\nexport default Draggable;\n","import { EffectType, FitType, TransitionType } from './player';\nimport { OverlayProps } from '../../player/svgs';\nimport { AnimationItem } from 'lottie-web';\nimport { ParsedFrame } from 'gifuct-js';\n\nexport enum ClipType {\n  UNKNOWN,\n  VIDEO,\n  IMAGE,\n  AUDIO,\n  TRANSITION,\n  SVG,\n  LOTTIE,\n  TEXT,\n  GIF,\n}\n\nexport interface Clip {\n  id?: string;\n  name: string;\n  type: ClipType;\n  /** 在时间轴上的位置 */\n  positionInTimeline: {\n    start: number;\n    end: number;\n    duration: number;\n  };\n  /** 在渲染界面上的位置 */\n  positionInRender: {\n    fitType: FitType;\n    rotate: number;\n    left: number;\n    bottom: number;\n    width: number;\n    height: number;\n  },\n  /** 原始素材的播放范围 */\n  playRange: {\n    start: number;\n    end: number;\n  },\n  effect: EffectType;\n  originalWidth: number;\n  originalHeight: number;\n  zIndex: number;\n}\n\nexport interface VideoClip extends Clip {\n  url: string;\n  blobUrl: string;\n  buffer: ArrayBuffer;\n}\n\nexport interface ImageClip extends Clip {\n  url: string;\n  blobUrl: string;\n}\n\nexport interface AudioClip extends Clip {\n  url: string;\n  buffer: ArrayBuffer;\n}\n\nexport interface LottieClip extends Clip {\n  lottie: AnimationItem;\n}\n\nexport interface TextClip extends Clip {\n  value: string;\n  props: {\n    fontColor: string;\n    fontSize: number;\n    fontFamily: string;\n  };\n}\n\nexport interface SvgClip extends Clip {\n  func(props: OverlayProps): string; \n}\n\nexport interface GifClip extends Clip {\n  url: string;\n  frames: ParsedFrame[];\n}\n\nexport interface TransitionClip extends Clip {\n  transition: TransitionType;\n  fromId?: string;\n  toId?: string;\n}\n\nexport interface AudioMergeItem {\n  /** 在整个player中的开始时间 */\n  delay: number;\n  /** 原音频中的开始时间 */\n  from: number;\n  /** 原音频中的结束时间 */\n  to: number;\n  /** 播放速度 */\n  tempo: number;\n  type: ClipType;\n  buffer: ArrayBuffer;\n}\n","import Player from '..';\nimport * as THREE from 'three';\nimport { Clip } from '../../common/types/clip';\nimport Painter from '../painter';\n\nexport abstract class ClipBase<T extends Clip = Clip> {\n  private isAttachToPainter: boolean = false;\n\n  /**\n   * 用于控制clip的事件回调\n   */\n  public isEntered: boolean = false;\n\n  public player: Player;\n  public painter: Painter;\n  public sprite?: THREE.Mesh;\n  public config: T;\n  public texture?: THREE.Texture;\n\n  constructor(config: T, player: Player) {\n    this.config = config;\n    this.player = player;\n    this.painter = player.painter;\n  }\n\n  public abstract init(): Promise<void>;\n\n  public play() {}\n\n  public pause() {}\n\n  public show() {\n    if (this.sprite) {\n      this.sprite.visible = true;\n    }\n  }\n\n  public hide() {\n    if (this.sprite) {\n      this.sprite.visible = false;\n    }\n  }\n\n  public updatePlaybackRate() {}\n\n  public getOriginalDuration() {\n    return this.config.playRange.end - this.config.playRange.start;\n  }\n\n  public addToPainter() {\n    if (!this.isAttachToPainter && this.sprite && this.config.id) {\n      this.isAttachToPainter = true;\n      this.player.painter.add(this.sprite, this.config.id);\n    }\n  }\n\n  public removeFromPainter() {\n    if (this.isAttachToPainter && this.config.id) {\n      this.isAttachToPainter = false;\n      this.player.painter.remove(this.config.id);\n    }\n  }\n\n  /**\n   * 首次进入clip时调用，不会继续调用onUpdate\n   */\n  public async onEnter(isManual: boolean) {}\n\n  /**\n   * 离开clip时调用\n   */\n  public async onLeave(isManual: boolean) {}\n\n  /**\n   * 播放器时间改变并且clip在有效范围内调用\n   */\n  public async onUpdate(isManual: boolean) {}\n\n  /**\n   * 销毁函数\n   */\n  public async destroy() {\n    this.removeFromPainter();\n  }\n}\n","import { AudioClip } from '../../common/types/clip';\nimport { ClipBase } from './base';\n\nexport class Audio extends ClipBase<AudioClip> {\n  private context = new AudioContext();\n  private audioBuffer?: AudioBuffer;\n  private source?: AudioBufferSourceNode;\n  public playbackRate = 1;\n\n  private isPlaying: boolean = false;\n\n  public async init() {\n    try {\n      this.audioBuffer = await this.getAudioBuffer();\n      this.updatePlaybackRate();\n    } catch (error) {\n      alert(error);\n    }\n  }\n\n  private getAudioBuffer(): Promise<AudioBuffer> {\n    return new Promise((resolve, reject) => {\n      this.context.decodeAudioData(this.config.buffer.slice(0), (buffer) => {\n        if (buffer) {\n          resolve(buffer);\n        } else {\n          reject(false);\n        }\n      }, (error) => {\n        reject(error);\n      });\n    });\n  }\n\n  public play() {\n    if (this.audioBuffer) {\n      const source = this.context.createBufferSource();\n      source.buffer = this.audioBuffer;\n      source.loop = false;\n      source.start(0, (this.config.playRange.start + (this.player.currentTime - this.config.positionInTimeline.start) * this.playbackRate) / 1000);\n      this.isPlaying = true;\n      this.source = source;\n      this.source.connect(this.context.destination);\n    }\n  }\n\n  public pause() {\n    if (this.source) {\n      this.source.stop();\n      this.isPlaying = false;\n    }\n  }\n\n  public updatePlaybackRate() {\n    const originalDuration = this.config.playRange.end - this.config.playRange.start;\n    this.playbackRate = originalDuration / this.config.positionInTimeline.duration;\n  }\n\n  public async onEnter() {\n    if (this.player.isPlaying) {\n      this.play();\n    }\n  }\n\n  public async onLeave() {\n    if (this.player.isPlaying) {\n      this.pause();\n    }\n  }\n\n  public async onUpdate(isManual: boolean) {\n    if (isManual) {\n      this.pause();\n      if (this.player.isPlaying) {\n        this.play();\n      }\n    }\n  }\n\n  public async destroy() {\n    super.destroy();\n    this.source?.stop();\n  }\n}\n","/**\n * 组装transition和effect\n */\nimport { FitType } from '../../common/types/player';\nimport { glsl } from 'typed-glsl';\nimport * as THREE from 'three';\n\ntype EffectProps = {\n  effect: string;\n};\n\ntype TransitionProps = {\n  fromEffect: string;\n  toEffect: string;\n  transition: string;\n};\n\n/**\n * 根据适配模式计算uv映射\n */\nexport function calcUVMap(\n  fitType: FitType,\n  /** 播放器宽度 */\n  playerWidth: number,\n  /** 播放器高度 */\n  playerHeight: number,\n  /** width in positionInRender */\n  currentWidth: number,\n  /** height in positionInRender */\n  currentHeight: number,\n  /** 素材原始宽度 */\n  originalWidth: number,\n  /** 素材原始高度 */\n  originalHeight: number,\n  /** 相对于左下角的移动距离 */\n  translateInPixel: THREE.Vector2 = new THREE.Vector2(0, 0),\n) {\n  let texWidth = currentWidth; // FitType.CUSTOM\n  let texHeight = currentHeight; // FitType.CUSTOM\n  let translate = translateInPixel.clone(); // FitType.CUSTOM\n  if (fitType === FitType.CONTAIN) {\n    const playerRatio = playerWidth / playerHeight;\n    const texRatio = originalWidth / originalHeight;\n    if (playerRatio / texRatio > 1) {\n      texHeight = playerHeight;\n      texWidth = originalWidth * (playerHeight / originalHeight);\n      translate.set((playerWidth - texWidth) * 0.5, 0);\n    } else {\n      texWidth = playerWidth;\n      texHeight = originalHeight * (playerWidth / originalWidth);\n      translate.set(0, (playerHeight - texHeight) * 0.5);\n    }\n  } else if (fitType === FitType.COVER) {\n    const playerRatio = playerWidth / playerHeight;\n    const texRatio = originalWidth / originalHeight;\n    if (playerRatio / texRatio > 1) {\n      texWidth = playerWidth;\n      texHeight = originalHeight * (playerWidth / originalWidth);\n      translate.set(0, (playerHeight - texHeight) * 0.5);\n    } else {\n      texHeight = playerHeight;\n      texWidth = originalWidth * (playerHeight / originalHeight);\n      translate.set((playerWidth - texWidth) * 0.5, 0);\n    }\n  } else if (fitType === FitType.FILL) {\n    texWidth = playerWidth;\n    texHeight = playerHeight;\n    translate.set(0, 0);\n  }\n  // + 0 可将 -0 变为 0\n  const uRange = new THREE.Vector2(-translate.x / texWidth + 0, (playerWidth - translate.x) / texWidth);\n  const vRange = new THREE.Vector2(-translate.y / texHeight + 0, (playerHeight - translate.y) / texHeight);\n  return [uRange, vRange];\n}\n\nexport class Shader {\n  static GetVertex() {\n    const vertexTemplate = glsl`\n      varying vec2 texCoords;\n      void main() {\n        texCoords = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n      }\n    `;\n    return vertexTemplate;\n  }\n\n  static GetFragment() {\n    const fragTemplate = glsl`\n      varying vec2 texCoords;\n      uniform sampler2D tex;\n      void main() {\n        gl_FragColor = texture2D(tex, texCoords);\n      }\n    `;\n    return fragTemplate;\n  }\n\n  static GetEffectFragment({ effect }: EffectProps) {\n    const fragTemplate = glsl`\n      varying vec2 texCoords;\n      uniform vec2 uRange;\n      uniform vec2 vRange;\n      uniform sampler2D tex;\n      ${effect}\n      vec4 getColor(vec2 uv) {\n        vec2 newUV = vec2(uRange.x + uv.x * (uRange.y - uRange.x), vRange.x + uv.y * (vRange.y - vRange.x));\n        vec4 color = effect(newUV);\n        if(newUV.x>1. || newUV.x<0. || newUV.y>1. || newUV.y<0.){\n          return vec4(0.,0.,0.,0.);\n        }\n        return color;\n      }\n      void main() {\n        gl_FragColor = getColor(texCoords);\n      }\n    `;\n    return fragTemplate;\n  }\n\n  static GetTransitionFragment({\n    fromEffect,\n    toEffect,\n    transition,\n  }: TransitionProps) {\n    const fragTemplate = glsl`\n      varying vec2 texCoords;\n      uniform sampler2D from, to;\n      uniform vec2 fromURange, fromVRange;\n      uniform vec2 toURange, toVRange;\n      uniform float fromRatio, toRatio;\n      uniform float progress;\n      ${fromEffect}\n      ${toEffect}\n      vec4 getFromColor(vec2 uv) {\n        vec2 newUV = vec2(fromURange.x + uv.x * (fromURange.y - fromURange.x), fromVRange.x + uv.y * (fromVRange.y - fromVRange.x));\n        vec4 color = fromEffect(newUV);\n        if(newUV.x>1. || newUV.x<0. || newUV.y>1. || newUV.y<0.){\n          return vec4(0.,0.,0.,0.);\n        }\n        return color;\n      }\n      vec4 getToColor(vec2 uv) {\n        vec2 newUV = vec2(toURange.x + uv.x * (toURange.y - toURange.x), toVRange.x + uv.y * (toVRange.y - toVRange.x));\n        vec4 color = toEffect(newUV);\n        if(newUV.x>1. || newUV.x<0. || newUV.y>1. || newUV.y<0.){\n          return vec4(0.,0.,0.,0.);\n        }\n        return color;\n      }\n      ${transition}\n      void main() {\n        gl_FragColor = transition(texCoords);\n      }\n    `;\n    return fragTemplate;\n  }\n}\n","import { noEffect } from './noEffect';\nimport { gray } from './gray';\nimport { Effect, EffectType } from '../../common/types/player';\nimport { ObjectType } from '../../common/types';\nimport { blur } from './blur';\nimport { ClipBase } from '../clips/base';\n\nconst effectMap: ObjectType<(clip?: ClipBase) => Effect> = {\n  [EffectType.NO_EFFECT]: noEffect,\n  [EffectType.GRAY]: gray,\n  [EffectType.BLUR]: blur,\n};\n\nexport default function effects(type?: EffectType) {\n  return effectMap[type || EffectType.NO_EFFECT];\n}\n","import { glsl } from 'typed-glsl';\n\nexport function noEffect() {\n  return {\n    uniforms: {},\n    fragment: (texName = 'tex', funName = 'effect') => glsl`\n      vec4 ${funName}(vec2 uv) {\n        return texture2D(${texName}, uv);\n      }\n    `\n  };\n}","import { glsl } from 'typed-glsl';\n\nexport function gray() {\n  return {\n    uniforms: {},\n    fragment: (texName = 'tex', funName = 'effect') => glsl`\n      vec4 ${funName}(vec2 uv) {\n        vec4 color = texture2D(${texName}, uv);\n        float gray = (color.r+color.g+color.b)/3.;\n        return vec4(gray,gray,gray,color.a);\n      }\n    `\n  };\n}\n","import { ClipBase } from '../clips/base';\nimport * as THREE from 'three';\nimport { glsl } from 'typed-glsl';\n\nexport function blur(clip?: ClipBase) {\n  return {\n    uniforms: {\n      blurSize: { value: 10 },\n      horizontalPass: { value: 1 }, // 0 or 1 to indicate vertical or horizontal pass\n      /*\n        The sigma value for the gaussian function: higher value means more blur\n        A good value for 9x9 is around 3 to 5\n        A good value for 7x7 is around 2.5 to 4\n        A good value for 5x5 is around 2 to 3.5\n      */\n      sigma: { value: 3.0 },\n      texOffset: { value: new THREE.Vector2(1.0, 1.0) },\n    },\n    fragment: (texName = 'tex', funName = 'effect') => glsl`\n      const float PI = 3.14159265;\n      vec4 ${funName}(vec2 uv) {\n        float numBlurPixelsPerSide = float(blurSize / 2);\n\n        vec3 incrementalGaussian;\n        incrementalGaussian.x = 1.0 / (sqrt(2.0 * PI) * sigma);\n        incrementalGaussian.y = exp(-0.5 / (sigma * sigma));\n        incrementalGaussian.z = incrementalGaussian.y * incrementalGaussian.y;\n\n        vec4 avgValue = vec4(0.0, 0.0, 0.0, 0.0);\n        float coefficientSum = 0.0;\n        avgValue += texture2D(${texName}, uv) * incrementalGaussian.x;\n        coefficientSum += incrementalGaussian.x;\n        incrementalGaussian.xy *= incrementalGaussian.yz;\n\n        for (float i = 1.0; i <= numBlurPixelsPerSide; i++) { \n          avgValue += texture2D(${texName}, uv - i * texOffset) * incrementalGaussian.x;         \n          avgValue += texture2D(${texName}, uv + i * texOffset) * incrementalGaussian.x;         \n          coefficientSum += 2.0 * incrementalGaussian.x;\n          incrementalGaussian.xy *= incrementalGaussian.yz;\n        }\n\n        return avgValue / coefficientSum;\n      }\n    `\n  };\n}\n\n// vec2 p = vertTexCoord.st;\n// float numBlurPixelsPerSide = float(blurSize / 2); \n\n// // Incremental Gaussian Coefficent Calculation (See GPU Gems 3 pp. 877 - 889)\n// vec3 incrementalGaussian;\n// incrementalGaussian.x = 1.0 / (sqrt(2.0 * PI) * sigma);\n// incrementalGaussian.y = exp(-0.5 / (sigma * sigma));\n// incrementalGaussian.z = incrementalGaussian.y * incrementalGaussian.y;\n\n// vec4 avgValue = vec4(0.0, 0.0, 0.0, 0.0);\n// float coefficientSum = 0.0;\n\n// // Take the central sample first...\n// avgValue += texture2D(texture, p) * incrementalGaussian.x;\n// coefficientSum += incrementalGaussian.x;\n// incrementalGaussian.xy *= incrementalGaussian.yz;\n\n// // Go through the remaining 8 vertical samples (4 on each side of the center)\n// for (float i = 1.0; i <= numBlurPixelsPerSide; i++) { \n//   avgValue += texture2D(texture, p - i * texOffset) * incrementalGaussian.x;         \n//   avgValue += texture2D(texture, p + i * texOffset) * incrementalGaussian.x;         \n//   coefficientSum += 2.0 * incrementalGaussian.x;\n//   incrementalGaussian.xy *= incrementalGaussian.yz;\n// }\n\n// gl_FragColor = avgValue / coefficientSum;\n","import { ObjectType } from '../types';\n\ninterface WatchMapValue {\n  [key: string | number | symbol]: Set<(newVal: any, oldVal: any) => void>;\n}\n\nconst watchList: Map<ObjectType, WatchMapValue> = new Map();\n\nexport function watch<ObjType, K extends keyof ObjType>(\n  watchObj: ObjType,\n  key: K,\n  callback: (newVal: ObjType[K], oldVal: ObjType[K]) => void,\n) {\n  if (!watchList.has(watchObj)) {\n    const set = new Set<(newVal: ObjType[K], oldVal: ObjType[K]) => void>();\n    watchList.set(watchObj, { [key]: set });\n  }\n  const map = watchList.get(watchObj);\n  if (map && !map[key]) {\n    map[key] = new Set<(newVal: ObjType[K], oldVal: ObjType[K]) => void>();\n  }\n  watchList.get(watchObj)?.[key].add(callback);\n  let currentVal = watchObj[key];\n  Object.defineProperty(watchObj, key, {\n    get: () => {\n      return currentVal;\n    },\n    set: (newVal: ObjType[K]) => {\n      const oldVal = currentVal;\n      currentVal = newVal;\n      if (newVal !== oldVal) {\n        watchList.get(watchObj)?.[key].forEach((item) => {\n          item(newVal, oldVal);\n          // callback(newVal, oldVal);\n        });\n      }\n    },\n  });\n}\n","import { ClipBase } from './base';\nimport { calcUVMap, Shader } from '../painter/shader';\nimport effects from '../effects';\nimport { ImageClip } from '../../common/types/clip';\nimport * as THREE from 'three';\nimport { watch } from '../../common/utils/watch';\n\nexport class Image extends ClipBase<ImageClip> {\n  private geometry?: THREE.PlaneGeometry;\n  private material?: THREE.ShaderMaterial;\n  public texture?: THREE.Texture;\n\n  public async init() {\n    await this.initRender();\n    this.watchChange();\n  }\n\n  /**\n   * 监听属性变化\n   */\n  private watchChange() {\n    watch(this.config, 'zIndex', (val: number) => {\n      if (this.sprite) {\n        this.sprite.position.z = val;\n      }\n    });\n    watch(this.config, 'effect', (val) => {\n      if (this.material) {\n        const { uniforms, fragment } = effects(val)(this);\n        this.material.uniforms = {\n          ...this.material.uniforms,\n          ...uniforms,\n        };\n        this.material.fragmentShader = Shader.GetEffectFragment({\n          effect: fragment(),\n        });\n        this.material.uniformsNeedUpdate = true;\n        this.material.needsUpdate = true;\n      }\n    });\n    watch(this.config, 'positionInRender', (val) => {\n      if (this.material) {\n        const { width: currentWidth, height: currentHeight, left, bottom } = this.config.positionInRender;\n        const { player, config } = this;\n        const [uRange, vRange] = calcUVMap(\n          val.fitType,\n          player.width,\n          player.height,\n          currentWidth,\n          currentHeight,\n          config.originalWidth,\n          config.originalHeight,\n          new THREE.Vector2(left, bottom),\n        );\n        // @ts-ignore\n        this.material.uniforms.uRange.value = uRange;\n        // @ts-ignore\n        this.material.uniforms.vRange.value = vRange;\n        this.material.uniformsNeedUpdate = true;\n      }\n    });\n  }\n\n  private createTexture(): Promise<THREE.Texture> {\n    return new Promise((resolve) => {\n      new THREE.TextureLoader().load(this.config.blobUrl, function(texture) {\n        resolve(texture);\n      });\n    });\n  }\n\n  private async initRender() {\n    const {\n      positionInRender: { width: currentWidth, height: currentHeight, fitType, left, bottom },\n      effect,\n      originalWidth,\n      originalHeight,\n    } = this.config;\n    const { player } = this;\n    const { uniforms, fragment } = effects(effect)(this);\n    const [uRange, vRange] = calcUVMap(\n      fitType,\n      player.width,\n      player.height,\n      currentWidth,\n      currentHeight,\n      originalWidth,\n      originalHeight,\n      new THREE.Vector2(left, bottom),\n    );\n    this.texture = await this.createTexture();\n    this.geometry = new THREE.PlaneGeometry(player.width, player.height);\n    this.material = new THREE.ShaderMaterial({\n      uniforms: {\n        tex: { value: this.texture },\n        uRange: { value: uRange },\n        vRange: { value: vRange },\n        ...uniforms,\n      },\n      vertexShader: Shader.GetVertex(),\n      fragmentShader: Shader.GetEffectFragment({\n        effect: fragment(),\n      }),\n    });\n    this.material.uniformsNeedUpdate = true;\n    this.material.transparent = true;\n    this.sprite = new THREE.Mesh(this.geometry, this.material);\n    this.sprite.position.z = this.config.zIndex;\n  }\n\n  public async destroy() {\n    super.destroy();\n    this.texture?.dispose();\n    this.geometry?.dispose();\n    this.material?.dispose();\n  }\n}\n","import { ClipBase } from './base';\nimport * as THREE from 'three';\nimport { LottieClip } from '../../common/types/clip';\nimport { watch } from '../../common/utils/watch';\n\nexport class Lottie extends ClipBase<LottieClip> {\n  private geometry?: THREE.PlaneGeometry;\n  private material?: THREE.MeshBasicMaterial;\n\n  public async init() {\n    this.initRender();\n    this.watchChange();\n  }\n\n  private watchChange() {\n    watch(this.config, 'zIndex', (val: number) => {\n      if (this.sprite) {\n        this.sprite.position.z = val;\n      }\n    });\n  }\n\n  private initRender() {\n    const { player: { width, height } } = this;\n    this.geometry = new THREE.PlaneGeometry(width, height);\n    this.material = new THREE.MeshBasicMaterial();\n    const texture = new THREE.CanvasTexture(document.createElement('canvas'));\n    // texture.animation = this.config.lottie;\n    // texture.image = this.config.lottie.container;\n    this.material.map = texture;\n    this.material.transparent = true;\n    this.sprite = new THREE.Mesh(this.geometry, this.material);\n  }\n\n  public async onUpdate() {\n    if (this.material?.map) {\n      const { player: { currentTime } } = this;\n      this.config.lottie.goToAndStop(currentTime - this.config.positionInTimeline.start);\n      this.material.map.needsUpdate = true;\n    }\n  }\n\n  public async destroy() {\n    super.destroy();\n    this.geometry?.dispose();\n    this.material?.dispose();\n  }\n}","import { SvgClip } from '../../common/types/clip';\nimport { ClipBase } from './base';\nimport * as THREE from 'three';\nimport { svgToCanvas } from '../../common/utils';\nimport { watch } from '../../common/utils/watch';\n\nexport class Svg extends ClipBase<SvgClip> {\n  private canvas: HTMLCanvasElement = document.createElement('canvas');\n  private context?: CanvasRenderingContext2D | null;\n\n  private geometry?: THREE.PlaneGeometry;\n  private material?: THREE.MeshBasicMaterial;\n\n  public async init() {\n    this.initCanvas();\n    this.initRender();\n    this.watchChange();\n  }\n\n  private watchChange() {\n    watch(this.config, 'zIndex', (val: number) => {\n      if (this.sprite) {\n        this.sprite.position.z = val;\n      }\n    });\n  }\n\n  private initCanvas() {\n    const { width, height } = this.painter.getRealSize();\n    this.canvas.width = width;\n    this.canvas.height = height;\n    this.context = this.canvas.getContext('2d');\n  }\n\n  private initRender() {\n    const { player: { width, height } } = this;\n    this.geometry = new THREE.PlaneGeometry(width, height);\n    this.material = new THREE.MeshBasicMaterial();\n    this.material.map = new THREE.CanvasTexture(this.canvas);\n    this.material.transparent = true;\n    this.sprite = new THREE.Mesh(this.geometry, this.material);\n    this.sprite.position.z = this.config.zIndex;\n  }\n\n  public async onUpdate() {\n    if (this.material?.map) {\n      const { start, end } = this.config.positionInTimeline;\n      const { player: { currentTime } } = this;\n      const { width, height } = this.painter.getRealSize();\n      const svg = this.config.func({ start, end, currentTime, width, height });\n      await svgToCanvas(svg, this.canvas, this.context);\n      this.material.map.needsUpdate = true;\n    }\n  }\n\n  public async destroy() {\n    super.destroy();\n    this.geometry?.dispose();\n    this.material?.dispose();\n  }\n}\n","import { TextClip } from '../../common/types/clip';\nimport { ClipBase } from './base';\nimport * as THREE from 'three';\nimport { svgToCanvas, textClipToSvg } from '../../common/utils';\nimport { watch } from '../../common/utils/watch';\nimport { calcUVMap, Shader } from '../painter/shader';\nimport effects from '../effects';\n\nexport class Text extends ClipBase<TextClip> {\n  private canvas: HTMLCanvasElement = document.createElement('canvas');\n  private context?: CanvasRenderingContext2D | null;\n\n  private geometry?: THREE.PlaneGeometry;\n  private material?: THREE.ShaderMaterial;\n  public texture?: THREE.CanvasTexture;\n\n  public async init() {\n    await this.initTexture();\n    this.initRender();\n    this.watchChange();\n  }\n\n  private watchChange() {\n    watch(this.config, 'zIndex', (val: number) => {\n      if (this.sprite) {\n        this.sprite.position.z = val;\n      }\n    });\n    watch(this.config, 'positionInRender', (val) => {\n      if (this.material) {\n        const { width: currentWidth, height: currentHeight, left, bottom } = this.config.positionInRender;\n        const { player, config } = this;\n        const [uRange, vRange] = calcUVMap(\n          val.fitType,\n          player.width,\n          player.height,\n          currentWidth,\n          currentHeight,\n          config.originalWidth,\n          config.originalHeight,\n          new THREE.Vector2(left, bottom),\n        );\n        // @ts-ignore\n        this.material.uniforms.uRange.value = uRange;\n        // @ts-ignore\n        this.material.uniforms.vRange.value = vRange;\n        this.material.uniformsNeedUpdate = true;\n      }\n    });\n  }\n\n  private async initTexture() {\n    const { originalWidth, originalHeight } = this.config;\n    this.canvas.width = originalWidth;\n    this.canvas.height = originalHeight;\n    this.context = this.canvas.getContext('2d');\n    const svg = textClipToSvg(this.config);\n    await svgToCanvas(svg, this.canvas, this.context);\n    this.texture = new THREE.CanvasTexture(this.canvas);\n  }\n\n  private initRender() {\n    const {\n      positionInRender: { width: currentWidth, height: currentHeight, fitType, left, bottom },\n      effect,\n      originalWidth,\n      originalHeight,\n    } = this.config;\n    const { player } = this;\n    const { uniforms, fragment } = effects(effect)(this);\n    this.geometry = new THREE.PlaneGeometry(player.width, player.height);\n    const [uRange, vRange] = calcUVMap(\n      fitType,\n      player.width,\n      player.height,\n      currentWidth,\n      currentHeight,\n      originalWidth,\n      originalHeight,\n      new THREE.Vector2(left, bottom),\n    );\n    this.material = new THREE.ShaderMaterial({\n      uniforms: {\n        tex: { value: this.texture },\n        uRange: { value: uRange },\n        vRange: { value: vRange },\n        ...uniforms,\n      },\n      vertexShader: Shader.GetVertex(),\n      fragmentShader: Shader.GetEffectFragment({\n        effect: fragment(),\n      }),\n    });\n    this.material.transparent = true;\n    this.sprite = new THREE.Mesh(this.geometry, this.material);\n    this.sprite.position.z = this.config.zIndex;\n  }\n\n  public async destroy() {\n    super.destroy();\n    this.texture?.dispose();\n    this.geometry?.dispose();\n    this.material?.dispose();\n  }\n}\n","import { morph } from './morph';\nimport { dreamy } from './dreamy';\nimport { fade } from './fade';\nimport { TransitionType } from '../../common/types/player';\n\nconst transitionMap = Object.freeze({\n  [TransitionType.MORPH]: morph,\n  [TransitionType.DREAMY]: dreamy,\n  [TransitionType.FADE]: fade,\n});\n\nexport default function transitions(type: TransitionType) {\n  return transitionMap[type]();\n}\n","import { glsl } from 'typed-glsl';\n\nexport function morph() {\n  return {\n    uniforms: {\n      strength: { value: 0.1 }\n    },\n    fragment: glsl`\n      uniform float strength; // = 0.1\n      vec4 transition(vec2 p) {\n        vec4 ca = getFromColor(p);\n        vec4 cb = getToColor(p);\n        \n        vec2 oa = (((ca.rg+ca.b)*0.5)*2.0-1.0);\n        vec2 ob = (((cb.rg+cb.b)*0.5)*2.0-1.0);\n        vec2 oc = mix(oa,ob,0.5)*strength;\n        \n        float w0 = progress;\n        float w1 = 1.0-w0;\n        return mix(getFromColor(p+oc*w0), getToColor(p-oc*w1), progress);\n      }\n    `\n  };\n}\n","import { glsl } from 'typed-glsl';\n\nexport function dreamy() {\n  return {\n    uniforms: {},\n    fragment: glsl`\n      vec2 offset(float progress, float x, float theta) {\n        float phase = progress*progress + progress + theta;\n        float shifty = 0.03*progress*cos(10.0*(progress+x));\n        return vec2(0, shifty);\n      }\n      vec4 transition(vec2 p) {\n        return mix(getFromColor(p + offset(progress, p.x, 0.0)), getToColor(p + offset(1.0-progress, p.x, 3.14)), progress);\n      }\n    `\n  };\n}\n","import { glsl } from 'typed-glsl';\n\nexport function fade() {\n  return {\n    uniforms: {},\n    fragment: glsl`\n      vec4 transition(vec2 uv) {\n        return mix(\n          getFromColor(uv),\n          getToColor(uv),\n          progress\n        );\n      }\n    `\n  };\n}\n","import { calcUVMap, Shader } from '../painter/shader';\nimport effects from '../effects/index';\nimport transitions from '../transitions';\nimport { ClipBase } from './base';\nimport { TransitionClip } from '../../common/types/clip';\nimport * as THREE from 'three';\nimport { watch } from '../../common/utils/watch';\n\nexport class Transition extends ClipBase<TransitionClip> {\n  private geometry?: THREE.PlaneGeometry;\n  private material?: THREE.ShaderMaterial;\n  private fromClip?: ClipBase;\n  private toClip?: ClipBase;\n\n  public async init() {\n    await this.initRender();\n    this.watchChange();\n  }\n\n  private watchChange() {\n    if (this.fromClip && this.toClip) {\n      watch(this.fromClip.config, 'effect', () => {\n        this.updateShader();\n      });\n      watch(this.fromClip.config, 'positionInRender', () => {\n        this.updateUniforms();\n      });\n      watch(this.toClip.config, 'effect', () => {\n        this.updateShader();\n      });\n      watch(this.toClip.config, 'positionInRender', () => {\n        this.updateUniforms();\n      });\n    }\n  }\n\n  private updateUniforms() {\n    if (this.fromClip && this.toClip && this.material) {\n      const {\n        originalWidth: fromOriginalWidth,\n        originalHeight: fromOriginalHeight,\n        positionInRender: { width: fromCurrentWidth, height: fromCurrentHeight, fitType: fromFitType },\n      } = this.fromClip.config;\n      const {\n        originalWidth: toOriginalWidth, \n        originalHeight: toOriginalHeight,\n        positionInRender: { width: toCurrentWidth, height: toCurrentHeight, fitType: toFitType },\n      } = this.toClip.config;\n      const { player } = this;\n      const [fromURange, fromVRange] = calcUVMap(\n        fromFitType,\n        player.width,\n        player.height,\n        fromCurrentWidth,\n        fromCurrentHeight,\n        fromOriginalWidth,\n        fromOriginalHeight,\n      );\n      const [toURange, toVRange] = calcUVMap(\n        toFitType,\n        player.width,\n        player.height,\n        toCurrentWidth,\n        toCurrentHeight,\n        toOriginalWidth,\n        toOriginalHeight,\n      );\n      // @ts-ignore\n      this.material.uniforms.fromURange.value = fromURange;\n      // @ts-ignore\n      this.material.uniforms.fromVRange.value = fromVRange;\n      // @ts-ignore\n      this.material.uniforms.toURange.value = toURange;\n      // @ts-ignore\n      this.material.uniforms.toVRange.value = toVRange;\n      this.material.uniformsNeedUpdate = true;\n    }\n  }\n\n  private updateShader() {\n    if (this.fromClip && this.toClip && this.material) {\n      const { transition } = this.config;\n      const { effect: fromEffect } = this.fromClip.config;\n      const { effect: toEffect } = this.toClip.config;\n      const { uniforms: fromUniforms, fragment: fromFragment } = effects(fromEffect)();\n      const { uniforms: toUniforms, fragment: toFragment } = effects(toEffect)();\n      const { uniforms: transitionUniforms, fragment: transitionFragment } = transitions(transition);\n      this.material.uniforms = {\n        ...this.material.uniforms,\n        ...fromUniforms,\n        ...toUniforms,\n        ...transitionUniforms,\n      };\n      this.material.fragmentShader = Shader.GetTransitionFragment({\n        fromEffect: fromFragment('from', 'fromEffect'),\n        toEffect: toFragment('to', 'toEffect'),\n        transition: transitionFragment,\n      });\n      this.material.needsUpdate = true;\n    }\n  }\n\n  // 由于不知道关联视频或者图片的初始状态，所以需要等到渲染的时候再初始化\n  private async initRender() {\n    const { player } = this;\n    const { fromId, toId, transition } = this.config;\n    const fromClip = this.fromClip = player.getClipById(fromId);\n    const toClip = this.toClip = player.getClipById(toId);\n    if (fromClip && toClip) {\n      const {\n        originalWidth: fromOriginalWidth,\n        originalHeight: fromOriginalHeight,\n        positionInRender: { width: fromCurrentWidth, height: fromCurrentHeight, fitType: fromFitType },\n        effect: fromEffect,\n      } = fromClip.config;\n      const {\n        originalWidth: toOriginalWidth, \n        originalHeight: toOriginalHeight,\n        positionInRender: { width: toCurrentWidth, height: toCurrentHeight, fitType: toFitType },\n        effect: toEffect,\n      } = toClip.config;\n      const { uniforms: fromUniforms, fragment: fromFragment } = effects(fromEffect)();\n      const { uniforms: toUniforms, fragment: toFragment } = effects(toEffect)();\n      const { uniforms: transitionUniforms, fragment: transitionFragment } = transitions(transition);\n      const [fromURange, fromVRange] = calcUVMap(\n        fromFitType,\n        player.width,\n        player.height,\n        fromCurrentWidth,\n        fromCurrentHeight,\n        fromOriginalWidth,\n        fromOriginalHeight,\n      );\n      const [toURange, toVRange] = calcUVMap(\n        toFitType,\n        player.width,\n        player.height,\n        toCurrentWidth,\n        toCurrentHeight,\n        toOriginalWidth,\n        toOriginalHeight,\n      );\n      this.geometry = new THREE.PlaneGeometry(player.width, player.height);\n      this.material = new THREE.ShaderMaterial({\n        uniforms: {\n          from: { value: fromClip.texture },\n          to: { value: toClip.texture },\n          progress: { value: 0 },\n          fromURange: { value: fromURange },\n          fromVRange: { value: fromVRange },\n          toURange: { value: toURange },\n          toVRange: { value: toVRange },\n          ...fromUniforms,\n          ...toUniforms,\n          ...transitionUniforms,\n        },\n        vertexShader: Shader.GetVertex(),\n        fragmentShader: Shader.GetTransitionFragment({\n          fromEffect: fromFragment('from', 'fromEffect'),\n          toEffect: toFragment('to', 'toEffect'),\n          transition: transitionFragment,\n        }),\n      });\n      this.material.uniformsNeedUpdate = true;\n      this.material.transparent = true;\n      this.sprite = new THREE.Mesh(this.geometry, this.material);\n      this.sprite.position.z = toClip.config.zIndex;\n    }\n  }\n\n  public async onEnter() {\n    if (this.fromClip && this.toClip) {\n      this.fromClip.hide();\n      this.toClip.hide();\n      this.render();\n    }\n  }\n\n  public async onLeave() {\n    if (this.fromClip && this.toClip) {\n      this.fromClip.show();\n      this.toClip.show();\n    }\n  }\n\n  public async onUpdate() {\n    this.render();\n  }\n\n  private async render() {\n    if (this.material?.uniforms) {\n      const { start, end } = this.config.positionInTimeline;\n      const progress = (this.player.currentTime - start) / (end - start);\n      this.material.uniforms.progress.value = progress;\n    }\n  }\n\n  public async destroy() {\n    super.destroy();\n    this.texture?.dispose();\n    this.geometry?.dispose();\n    this.material?.dispose();\n  }\n }\n","import { ClipBase } from './base';\nimport { calcUVMap, Shader } from '../painter/shader';\nimport effects from '../effects';\nimport * as THREE from 'three';\nimport { VideoClip } from '../../common/types/clip';\nimport { watch } from '../../common/utils/watch';\n\nexport class Video extends ClipBase<VideoClip> {\n  private geometry?: THREE.PlaneGeometry;\n  private material?: THREE.ShaderMaterial;\n  public texture?: THREE.VideoTexture;\n  private video?: HTMLVideoElement;\n  public playbackRate = 1;\n  private isPlaying = false;\n\n  public async init() {\n    await this.initRender();\n    this.updatePlaybackRate();\n    this.watchChange();\n  }\n\n  /**\n   * 监听属性变化\n   */\n  private watchChange() {\n    watch(this.config, 'zIndex', (val: number) => {\n      if (this.sprite) {\n        this.sprite.position.z = val;\n      }\n    });\n    watch(this.config, 'effect', (val) => {\n      if (this.material) {\n        const { uniforms, fragment } = effects(val)(this);\n        this.material.uniforms = {\n          ...this.material.uniforms,\n          ...uniforms,\n        };\n        this.material.fragmentShader = Shader.GetEffectFragment({\n          effect: fragment(),\n        });\n        this.material.uniformsNeedUpdate = true;\n        this.material.needsUpdate = true;\n      }\n    });\n    watch(this.config, 'positionInRender', (val) => {\n      if (this.material) {\n        const { width: currentWidth, height: currentHeight, left, bottom } = this.config.positionInRender;\n        const { player, config } = this;\n        const [uRange, vRange] = calcUVMap(\n          val.fitType,\n          player.width,\n          player.height,\n          currentWidth,\n          currentHeight,\n          config.originalWidth,\n          config.originalHeight,\n          new THREE.Vector2(left, bottom),\n        );\n        // @ts-ignore\n        this.material.uniforms.uRange.value = uRange;\n        // @ts-ignore\n        this.material.uniforms.vRange.value = vRange;\n        this.material.uniformsNeedUpdate = true;\n      }\n    });\n  }\n\n  private createTexture(): Promise<THREE.VideoTexture> {\n    return new Promise(async (resolve, reject) => {\n      this.video = document.createElement('video');\n      this.video.loop = false;\n      this.video.autoplay = false;\n      this.video.addEventListener('loadedmetadata', async () => {\n        if (this.video) {\n          const texture = new THREE.VideoTexture(this.video);\n          // @ts-ignore\n          await texture.setCurrentTime(this.config.playRange.start);\n          resolve(texture);\n        }\n      });\n      this.video.src = this.config.blobUrl;\n    });\n  }\n\n  private async initRender() {\n    const {\n      effect,\n      positionInRender: { width: currentWidth, height: currentHeight, fitType, left, bottom },\n      originalWidth,\n      originalHeight,\n    } = this.config;\n    const { player } = this;\n    const { uniforms, fragment } = effects(effect)(this);\n    const [uRange, vRange] = calcUVMap(\n      fitType,\n      player.width,\n      player.height,\n      currentWidth,\n      currentHeight,\n      originalWidth,\n      originalHeight,\n      new THREE.Vector2(left, bottom),\n    );\n    this.texture = await this.createTexture();\n    this.geometry = new THREE.PlaneGeometry(player.width, player.height);\n    this.material = new THREE.ShaderMaterial({\n      uniforms: {\n        tex: { value: this.texture },\n        uRange: { value: uRange },\n        vRange: { value: vRange },\n        ...uniforms,\n      },\n      vertexShader: Shader.GetVertex(),\n      fragmentShader: Shader.GetEffectFragment({\n        effect: fragment(),\n      }),\n    });\n    this.material.uniformsNeedUpdate = true;\n    this.material.transparent = true;\n    this.sprite = new THREE.Mesh(this.geometry, this.material);\n    this.sprite.position.z = this.config.zIndex;\n  }\n\n  public play() {\n    this.video?.play();\n    this.isPlaying = true;\n  }\n\n  public pause() {\n    this.video?.pause();\n    this.isPlaying = false;\n  }\n\n  public updatePlaybackRate() {\n    const originalDuration = this.config.playRange.end - this.config.playRange.start;\n    this.playbackRate = originalDuration / this.config.positionInTimeline.duration;\n  }\n\n  // 根据player的currentTime校正video的currentTime\n  private async correctVideoCurrentTime() {\n    const currentTime = this.player.currentTime;\n    if (this.video && Math.abs(this.video.playbackRate - this.playbackRate) >= 10e-6) {\n      this.video.playbackRate = this.playbackRate;\n    }\n    const newCurrentTime = this.config.playRange.start + (currentTime - this.config.positionInTimeline.start) * this.playbackRate;\n    // @ts-ignore\n    await this.texture.setCurrentTime(newCurrentTime);\n  }\n\n  public async onEnter() {\n    // await this.correctVideoCurrentTime();\n    if (this.player.isPlaying) {\n      this.play();\n    }\n  }\n\n  public async onLeave() {\n    this.pause();\n    if (this.texture) {\n      // @ts-ignore\n      await this.texture.setCurrentTime(this.config.playRange.start);\n    }\n  }\n\n  public async onUpdate(isManual: boolean) {\n    if (isManual) {\n      await this.correctVideoCurrentTime();\n    }\n  }\n\n  public async destroy() {\n    super.destroy();\n    if (this.video) {\n      this.video = undefined;\n    }\n    this.texture?.dispose();\n    this.geometry?.dispose();\n    this.material?.dispose();\n  }\n}\n","interface AsyncQueueItem {\n  action: (...args: any[]) => Promise<any>;\n  resolve: (value: unknown) => void;\n  reject: (reason?: any) => void;\n}\n\nexport class Queue<T> {\n  private items: T[] = [];\n  public enqueue(item: T) {\n    this.items.push(item);\n  }\n  public dequeue() {\n    return this.items.shift();\n  }\n  public get size() {\n    return this.items.length;\n  }\n}\n\nexport class AsyncAutoQueue {\n  private items: AsyncQueueItem[] = [];\n  private pendingPromise: boolean = false;\n\n  public enqueue<T>(action: () => Promise<T>) {\n    return new Promise((resolve, reject) => {\n      this.items.push({ action, resolve, reject });\n      if (!this.pendingPromise) {\n        this.dequeue();\n      }\n    }).then((result) => {\n      return result;\n    }).catch((error) => {\n      throw new Error(error);\n    }).finally(() => {\n      this.pendingPromise = false;\n      this.dequeue();\n    });\n  }\n\n  public async dequeue() {\n    const item = this.items.shift();\n    if (!item) {\n      return false;\n    }\n    try {\n      this.pendingPromise = true;\n      const payload = await item.action();\n      item.resolve(payload);\n    } catch (e) {\n      item.reject(e);\n    }\n    return true;\n  }\n}\n","export function extractDuration(field: string) {\n  try {\n    const duration = field.split(',')[0].replace('Duration:', '');\n    return duration.trim();\n  } catch {\n    return '';\n  }\n}\n\nexport function extractVideoInfo(field: string) {\n  try {\n    const infoItems = field.split('Video:')[1].replace(/\\(.*?\\)/gi, '').split(',');\n    const resolution = infoItems[2].split('x');\n    return {\n      codec: infoItems[0].trim(),\n      colorSpace: infoItems[1].trim(),\n      resolution: {\n        width: parseInt(resolution[0].trim()),\n        height: parseInt(resolution[1].trim()),\n      },\n      fps: parseInt(infoItems[4].replace('fps', '').trim()),\n    };\n  } catch {\n    return {};\n  }\n}\n\nexport function extractAudioInfo(field: string) {\n  try {\n    const infoItems = field.split('Audio:')[1].replace(/\\(.*?\\)/gi, '').split(',');\n    return {\n      codec: infoItems[0].trim(),\n      Hz: parseInt(infoItems[1].replace('Hz', '').trim()),\n    };\n  } catch {\n    return {};\n  }\n}\n\nexport function getAudioTempoChain(tempo: number): string {\n  if (Math.abs(tempo - 1) <= 10e-6) {\n    return '';\n  }\n  if (tempo >= 0.5 && tempo <= 2.0) {\n    return `,atempo=${tempo}`;\n  }\n  if (tempo > 0 && tempo < 0.5) {\n    let start = 0.5;\n    let result = `,atempo=0.5`;\n    while (start > tempo) {\n      start *= 0.5;\n      result += `,atempo=0.5`;\n    }\n    if (Math.abs(start - tempo) > 10e-6) {\n      result += `,atempo=${(tempo / start).toFixed(2)}`;\n    }\n    return result;\n  }\n  if (tempo > 2.0) {\n    let start = 2.0;\n    let result = `,atempo=2.0`;\n    while (start < tempo) {\n      start *= 2.0;\n      result += `,atempo=2.0`;\n    }\n    if (Math.abs(start - tempo) > 10e-6) {\n      result += `,atempo=${(start / tempo).toFixed(2)}`;\n    }\n    return result;\n  }\n  return '';\n}\n","import { createFFmpeg, FFmpeg } from '@ffmpeg/ffmpeg';\nimport { v4 } from 'uuid';\nimport { AsyncAutoQueue } from '../common/libs/queue';\nimport { MediaInfo } from '../common/types';\nimport { AudioMergeItem } from '../common/types/clip';\nimport { extractAudioInfo, extractDuration, extractVideoInfo, getAudioTempoChain } from './util';\n\nclass FFmpegHelperClass {\n  public static ffmpeg: FFmpeg;\n\n  public static async Load() {\n    if (!FFmpegHelper.ffmpeg.isLoaded()) {\n      await FFmpegHelper.ffmpeg.load();\n    }\n  }\n\n  public static async GetVersion() {\n    await FFmpegHelper.ffmpeg.run('-version');\n  }\n\n  public static async VideoTranscode(buffer: ArrayBuffer, codec = 'h264') {\n    const ffmpeg = FFmpegHelperClass.ffmpeg;\n    const inputFileName = `${v4()}`;\n    const outputFileName = `${v4()}.mp4`;\n    // 写入文件\n    ffmpeg.FS('writeFile', inputFileName, new Uint8Array(buffer));\n    // 执行命令\n    await ffmpeg.run('-i', inputFileName, '-c:v', codec, '-c:a', 'aac', outputFileName);\n    // 读取生成的文件\n    const video = ffmpeg.FS('readFile', outputFileName);\n    // 删除写入的文件\n    ffmpeg.FS('unlink', inputFileName);\n    ffmpeg.FS('unlink', outputFileName);\n    return video.buffer;\n  }\n\n  public static async GetMediaInfo(buffer: ArrayBuffer) {\n    const ffmpeg = FFmpegHelperClass.ffmpeg;\n    const inputFileName = `${v4()}`;\n    const mediaInfo: MediaInfo = {};\n    ffmpeg.setLogger(({ type, message }) => {\n      if (type === 'fferr') {\n        if (message.includes('Duration')) {\n          mediaInfo.duration = extractDuration(message);\n        } else if (message.includes('Stream #0')) { // 视频流或者音频流\n          if (message.includes('Video:')) {\n            mediaInfo.video = extractVideoInfo(message);\n          } else if (message.includes('Audio:')) {\n            mediaInfo.audio = extractAudioInfo(message);\n          }\n        }\n      }\n    });\n    // 写入文件\n    ffmpeg.FS('writeFile', inputFileName, new Uint8Array(buffer));\n    // 执行命令\n    await ffmpeg.run('-i', inputFileName);\n    // 删除写入的文件\n    ffmpeg.FS('unlink', inputFileName);\n    return mediaInfo;\n  }\n\n  public static async MergeAudios(items: AudioMergeItem[]) {\n    const ffmpeg = FFmpegHelperClass.ffmpeg;\n    const outputFileName = `${v4()}.aac`;\n    const inputFileName = v4();\n    const inputs = items.map((item, index) => {\n      return ['-i', `${inputFileName}_${index}`, '-ss', `${item.from / 1000}`, '-to', `${(item.to - item.from) / 1000}`];\n    }).flat(1);\n    const filters = items.map((item, index) => {\n      const delay = item.delay / 1000;\n      return `[${index}:a]adelay=${delay}|${delay}|${delay}|${delay}${getAudioTempoChain(item.tempo)}[a${index}];`;\n    }).join('');\n    const amixPrefix = items.map((item, index) => {\n      return `[a${index}]`;\n    }).join('');\n    // 写入文件\n    items.forEach((item, index) => {\n      ffmpeg.FS('writeFile', `${inputFileName}_${index}`, new Uint8Array(item.buffer));\n    });\n    // 执行命令\n    await ffmpeg.run(\n      ...inputs,\n      '-filter_complex',\n      `${filters}${amixPrefix}amix=inputs=${items.length}[aout]`,\n      '-map', '[aout]',\n      outputFileName\n    );\n    // 读取生成的文件\n    const audio = ffmpeg.FS('readFile', outputFileName);\n    // 删除写入的文件\n    items.forEach((item, index) => {\n      ffmpeg.FS('unlink', `${inputFileName}_${index}`);\n    });\n    ffmpeg.FS('unlink', outputFileName);\n    return audio.buffer;\n  }\n  \n  public static async ImagesToVideo(frames: ArrayBuffer[], fps: number = 30) {\n    const ffmpeg = FFmpegHelperClass.ffmpeg;\n    const outputFileName = `${v4()}.mp4`;\n    // 写入文件\n    frames.forEach((item, index) => {\n      ffmpeg.FS('writeFile', `export_${index.toString().padStart(4, '0')}.jpg`, new Uint8Array(item));\n    });\n    // 执行命令\n    await ffmpeg.run(\n      '-framerate', `${fps}`,\n      '-i', `export_%04d.jpg`,\n      '-c:v', 'libx264',\n      '-pix_fmt', 'yuv420p',\n      '-preset', 'ultrafast',\n      '-crf', '1',\n      outputFileName\n    );\n    // 读取生成的文件\n    const video = ffmpeg.FS('readFile', outputFileName);\n    // 删除写入的文件\n    frames.forEach((item, index) => {\n      ffmpeg.FS('unlink', `export_${index.toString().padStart(4, '0')}.jpg`);\n    });\n    ffmpeg.FS('unlink', outputFileName);\n    return video.buffer;\n  }\n  \n  public static async MergeVideoAudio(videoBuffer: ArrayBufferLike, audioBuffer: ArrayBufferLike) {\n    const ffmpeg = FFmpegHelperClass.ffmpeg;\n    const videoFileName = `${v4()}.mp4`;\n    const audioFileName = `${v4()}.aac`;\n    const outputFileName = `${v4()}.mp4`;\n    // 写入文件\n    ffmpeg.FS('writeFile', videoFileName, new Uint8Array(videoBuffer));\n    ffmpeg.FS('writeFile', audioFileName, new Uint8Array(audioBuffer));\n    // 执行命令\n    await ffmpeg.run(\n      '-i', videoFileName,\n      '-i', audioFileName,\n      '-c', 'copy',\n      outputFileName\n    );\n    // 读取生成的文件\n    const finalVideo = ffmpeg.FS('readFile', outputFileName);\n    // 删除写入的文件\n    ffmpeg.FS('unlink', videoFileName);\n    ffmpeg.FS('unlink', audioFileName);\n    ffmpeg.FS('unlink', outputFileName);\n    return finalVideo.buffer;\n  }\n}\n\nFFmpegHelperClass.ffmpeg = createFFmpeg({ log: false });\n\nconst asyncQueue = new AsyncAutoQueue();\n\nconst FFmpegHelper = new Proxy(FFmpegHelperClass, {\n  get(target, prop: keyof FFmpegHelperClass) {\n    const result = prop in target ? target[prop] : undefined;\n    if (typeof result === 'function') {\n      return async function(...args: any[]) {\n        return asyncQueue.enqueue(async () => {\n          await FFmpegHelperClass.Load();\n          return await (result as unknown as Function).apply(target, args);\n        });\n      }\n    }\n    return result;\n  }\n});\n\nexport default FFmpegHelper;\n","import { GifClip } from '../../common/types/clip';\nimport { ClipBase } from './base';\nimport * as THREE from 'three';\nimport { watch } from '../../common/utils/watch';\nimport effects from '../effects';\nimport { calcUVMap, Shader } from '../painter/shader';\n\nexport class Gif extends ClipBase<GifClip> {\n  private geometry?: THREE.PlaneGeometry;\n  private material?: THREE.ShaderMaterial;\n  private playbackRate = 1;\n  private textureData?: Uint8ClampedArray;\n  private currentFrame = 0;\n\n  public texture?: THREE.DataTexture;\n\n  public async init() {\n    this.initRender();\n    this.watchChange();\n  }\n\n  private watchChange() {\n    watch(this.config, 'zIndex', (val: number) => {\n      if (this.sprite) {\n        this.sprite.position.z = val;\n      }\n    });\n    watch(this.config, 'effect', (val) => {\n      if (this.material) {\n        const { uniforms, fragment } = effects(val)(this);\n        this.material.uniforms = {\n          ...this.material.uniforms,\n          ...uniforms,\n        };\n        this.material.fragmentShader = Shader.GetEffectFragment({\n          effect: fragment(),\n        });\n        this.material.uniformsNeedUpdate = true;\n        this.material.needsUpdate = true;\n      }\n    });\n    watch(this.config, 'positionInRender', (val) => {\n      if (this.material) {\n        const { width: currentWidth, height: currentHeight, left, bottom } = this.config.positionInRender;\n        const { player, config } = this;\n        const [uRange, vRange] = calcUVMap(\n          val.fitType,\n          player.width,\n          player.height,\n          currentWidth,\n          currentHeight,\n          config.originalWidth,\n          config.originalHeight,\n          new THREE.Vector2(left, bottom),\n        );\n        // @ts-ignore\n        this.material.uniforms.uRange.value = uRange;\n        // @ts-ignore\n        this.material.uniforms.vRange.value = vRange;\n        this.material.uniformsNeedUpdate = true;\n      }\n    });\n  }\n\n  private createTexture(data: Uint8ClampedArray, width: number, height: number): THREE.DataTexture {\n    this.textureData = new Uint8ClampedArray(data);\n    const texture = new THREE.DataTexture(this.textureData, width, height, THREE.RGBAFormat);\n    texture.flipY = true;\n    return texture;\n  }\n\n  private initRender() {\n    const {\n      positionInRender: {\n        fitType,\n        width: currentWidth,\n        height: currentHeight,\n        left,\n        bottom,\n      },\n      originalWidth,\n      originalHeight,\n      effect,\n      frames,\n    } = this.config;\n    const { player } = this;\n    const { uniforms, fragment } = effects(effect)(this);\n    const [uRange, vRange] = calcUVMap(\n      fitType,\n      player.width,\n      player.height,\n      currentWidth,\n      currentHeight,\n      originalWidth,\n      originalHeight,\n      new THREE.Vector2(left, bottom),\n    );\n    this.texture = this.createTexture(frames[0].patch, originalWidth, originalHeight);\n    this.geometry = new THREE.PlaneGeometry(player.width, player.height);\n    this.material = new THREE.ShaderMaterial({\n      uniforms: {\n        ...uniforms,\n        tex: { value: this.texture },\n        uRange: { value: uRange },\n        vRange: { value: vRange },\n      },\n      vertexShader: Shader.GetVertex(),\n      fragmentShader: Shader.GetEffectFragment({\n        effect: fragment(),\n      }),\n    });\n    this.material.transparent = true;\n    this.material.uniformsNeedUpdate = true;\n    this.sprite = new THREE.Mesh(this.geometry, this.material);\n    this.sprite.position.z = this.config.zIndex;\n  }\n\n  private getFrame() {\n    const currentTime = this.config.playRange.start + (this.player.currentTime - this.config.positionInTimeline.start) * this.playbackRate;\n    let sumFrameDelay = 0;\n    for (let i = 0; i < this.config.frames.length; i++) {\n      const frame = this.config.frames[i];\n      sumFrameDelay += frame.delay;\n      if (currentTime <= sumFrameDelay && this.currentFrame !== i) {\n        this.currentFrame = i;\n        return frame;\n      }\n    }\n  }\n\n  public updatePlaybackRate() {\n    const originalDuration = this.config.playRange.end - this.config.playRange.start;\n    this.playbackRate = originalDuration / this.config.positionInTimeline.duration;\n  }\n\n  public async onUpdate() {\n    const frame = this.getFrame();\n    if (frame && this.texture && this.textureData) {\n      this.textureData.set(frame.patch);\n      this.texture.needsUpdate = true;\n    }\n  }\n\n  public async destroy() {\n    super.destroy();\n    this.texture?.dispose();\n    this.geometry?.dispose();\n    this.material?.dispose();\n  }\n}\n","import {\n  AudioClip,\n  AudioMergeItem,\n  Clip,\n  ClipType,\n  GifClip,\n  ImageClip,\n  LottieClip,\n  SvgClip,\n  TextClip,\n  TransitionClip,\n  VideoClip,\n} from '../common/types/clip';\nimport { downloadFile } from '../common/utils';\nimport { Audio } from './clips/audio';\nimport { Image } from './clips/image';\nimport { Lottie } from './clips/lottie';\nimport { Svg } from './clips/svg';\nimport { Text } from './clips/text';\nimport { Transition } from './clips/transition';\nimport { Video } from './clips/video';\nimport Player from '.';\nimport FFmpegHelper from '../ffmpeg';\nimport { Gif } from './clips/gif';\nimport { FitType } from '../common/types/player';\n\nexport function createClip(config: Clip, player: Player) {\n  switch (config.type) {\n    case ClipType.VIDEO:\n      return new Video(config as VideoClip, player);\n    case ClipType.IMAGE:\n      return new Image(config as ImageClip, player);\n    case ClipType.TRANSITION:\n      return new Transition(config as TransitionClip, player);\n    case ClipType.TEXT:\n      return new Text(config as TextClip, player);\n    case ClipType.AUDIO:\n      return new Audio(config as AudioClip, player);\n    case ClipType.SVG:\n      return new Svg(config as SvgClip, player);\n    case ClipType.LOTTIE:\n      return new Lottie(config as LottieClip, player);\n    case ClipType.GIF:\n      return new Gif(config as GifClip, player);\n  }\n}\n\nexport function canvasToArrayBuffer(canvas: HTMLCanvasElement) {\n  return new Promise<ArrayBuffer>((resolve) => {\n    canvas.toBlob(async (blob) => {\n      if (blob) {\n        const arrayBuffer = await blob.arrayBuffer();\n        resolve(arrayBuffer);\n      }\n    }, 'image/jpeg', 1.0);\n  });\n}\n\nasync function generateVideo(player: Player, fps: number) {\n  const interval = 1000 / fps;\n  let frames: ArrayBuffer[] = [];\n  let currentTime = 0;\n  while (currentTime < player.duration) {\n    await player.setCurrentTime(currentTime);\n    const imageData = await canvasToArrayBuffer(player.painter.getDomElement());\n    frames.push(imageData);\n    // await sleep(interval);\n    currentTime += interval;\n  }\n  if (currentTime > player.duration) {\n    player.setCurrentTime(player.duration);\n    const imageData = await canvasToArrayBuffer(player.painter.getDomElement());\n    frames.push(imageData);\n  }\n  const data = await FFmpegHelper.ImagesToVideo(frames, fps);\n  frames.length = 0; // 清空图片\n  return data;\n}\n\nfunction getAudioMergeItemFromPlayer(player: Player) {\n  const result: AudioMergeItem[] = [];\n  player.clips.forEach((clip) => {\n    if ([ClipType.AUDIO, ClipType.VIDEO].includes(clip.config.type)) {\n      result.push({\n        delay: clip.config.positionInTimeline.start,\n        from: 0,\n        to: (clip as Video).getOriginalDuration(),\n        tempo: (clip as Video).playbackRate,\n        type: clip.config.type,\n        buffer: (clip as Video).config.buffer.slice(0),\n      });\n    }\n  });\n  return result;\n}\n\nasync function generateAudio(player: Player) {\n  const audioMergeItems = getAudioMergeItemFromPlayer(player);\n  return await FFmpegHelper.MergeAudios(audioMergeItems);\n}\n\n/**\n * 将player导出为h264视频文件\n */\nexport async function exportAsVideo(player: Player, fileName = 'export.mp4', fps = 30) {\n  Promise.all([generateVideo(player, fps), generateAudio(player)]).then(async ([videoBuffer, audioBuffer]) => {\n    const finalVideoBuffer = await FFmpegHelper.MergeVideoAudio(videoBuffer, audioBuffer);\n    downloadFile(URL.createObjectURL(new Blob([finalVideoBuffer], { type: 'video/mp4' })), fileName);\n  }).catch((error) => {\n    alert(error);\n  });\n}\n\n/**\n * 获取clip渲染相关的参数\n */\nexport function getClipRenderInfo(clip: Clip, playerWidth: number, playerHeight: number) {\n  const { originalWidth, originalHeight } = clip;\n  const {\n    fitType,\n    width: currentWidth,\n    height: currentHeight,\n    left: currentLeft,\n    bottom: currentBottom,\n  } = clip.positionInRender;\n  let texWidth = currentWidth; // FitType.CUSTOM\n  let texHeight = currentHeight; // FitType.CUSTOM\n  let left = currentLeft; // FitType.CUSTOM\n  let bottom = currentBottom; // FitType.CUSTOM\n  if (fitType === FitType.CONTAIN) {\n    const playerRatio = playerWidth / playerHeight;\n    const texRatio = originalWidth / originalHeight;\n    if (playerRatio / texRatio > 1) {\n      texHeight = playerHeight;\n      texWidth = originalWidth * (playerHeight / originalHeight);\n      left = (playerWidth - texWidth) * 0.5;\n      bottom = 0;\n    } else {\n      texWidth = playerWidth;\n      texHeight = originalHeight * (playerWidth / originalWidth);\n      left = 0;\n      bottom = (playerHeight - texHeight) * 0.5;\n    }\n  } else if (fitType === FitType.COVER) {\n    const playerRatio = playerWidth / playerHeight;\n    const texRatio = originalWidth / originalHeight;\n    if (playerRatio / texRatio > 1) {\n      texWidth = playerWidth;\n      texHeight = originalHeight * (playerWidth / originalWidth);\n      left = 0;\n      bottom = (playerHeight - texHeight) * 0.5;\n    } else {\n      texHeight = playerHeight;\n      texWidth = originalWidth * (playerHeight / originalHeight);\n      left = (playerWidth - texWidth) * 0.5;\n      bottom = 0;\n    }\n  } else if (fitType === FitType.FILL) {\n    texWidth = playerWidth;\n    texHeight = playerHeight;\n    left = 0;\n    bottom = 0;\n  }\n  return { width: texWidth, height: texHeight, left, bottom };\n}\n","import { EditorContext } from './type';\n\nexport const TRACK_WRAPPER_CLASS_NAME = 'track-wrapper';\n\nexport const NEW_TRACK_THRESHOLD = 12;\n\n/**\n * 一秒对应的像素宽度\n */\nexport const SECOND_WIDTH = 100;\n\n/**\n * track高度\n */\nexport const TRACK_HEIGHT = 36;\n\nexport const INIT_EDITOR_CONTEXT: EditorContext = {\n  hoverTrack: null,\n  setHoverTrack: () => {},\n\n  tracks: [],\n  setTracks: () => {},\n\n  newTrackIndex: -1,\n  setNewTrackIndex: () => {},\n\n  activeClipId: '',\n  setActiveClipId: () => {},\n\n  currentTime: 0,\n  setCurrentTime: () => {},\n\n  totalDuration: 0,\n  setTotalDuration: () => {},\n\n  isPlaying: false,\n  setIsPlaying: () => {},\n\n  setDraggingClip: () => {},\n};\n","import { v4 } from 'uuid';\nimport { Position, Range } from '../common/types';\nimport { Asset, AssetType, AudioAsset, TextAsset, TransitionAsset, VideoAsset } from '../common/types/asset';\nimport { AudioClip, Clip, ClipType, GifClip, ImageClip, TextClip, TransitionClip, VideoClip } from '../common/types/clip';\nimport { EffectType, FitType } from '../common/types/player';\nimport { SECOND_WIDTH, TRACK_WRAPPER_CLASS_NAME } from './config';\nimport { EditorContext } from './type';\n\nconst trackWrapperSelector = `.${TRACK_WRAPPER_CLASS_NAME}`;\n\n/**\n * 将光标位置转换为元素内的坐标\n */\nexport function cursorPositionToElementPosition(cursorPosition: Position, element: HTMLElement): Position {\n  if (cursorPosition && element) {\n    const rect = element.getBoundingClientRect();\n    return {\n      x: Math.max(0, cursorPosition.x - rect.x),\n      y: Math.max(0, cursorPosition.y - rect.y),\n    };\n  }\n  return { x: 0, y: 0 };\n}\n\n/**\n * \n */\nexport function cursorPositionToTracksWrapperPosition(cursorPosition: Position) {\n  const tracksWrapper = document.querySelector('.tracks-wrapper') as HTMLElement;\n  if (cursorPosition && tracksWrapper) {\n    const rect = tracksWrapper.getBoundingClientRect();\n    const paddingLeft = parseInt(getComputedStyle(tracksWrapper).paddingLeft, 10);\n    return {\n      x: Math.max(0, cursorPosition.x - rect.x - paddingLeft),\n      y: Math.max(0, cursorPosition.y - rect.y),\n    };\n  }\n  return { x: 0, y: 0 };\n}\n\n/**\n * 获取track index\n */\nexport function getTrackIndex(track?: HTMLElement | null) {\n  if (track) {\n    return Array.prototype.slice.call(track.parentElement?.querySelectorAll(trackWrapperSelector)).indexOf(track);\n  }\n  return -1;\n}\n\nexport function getTrackWrapper(el: HTMLElement) {\n  let parentElement = el?.parentElement;\n  while (parentElement) {\n    if (parentElement.classList.contains(TRACK_WRAPPER_CLASS_NAME)) {\n      return parentElement;\n    }\n    parentElement = parentElement.parentElement;\n  }\n  return null;\n  // return el?.closest(trackWrapperSelector) as HTMLElement;\n}\n\n/**\n * 获取trackElement的trackIndex和clipIndex\n */\nexport function getTrackAndClipIndex(data: Clip[][], id?: string) {\n  for (let i = 0; i < data.length; i++) {\n    for (let j = 0; j < data[i].length; j++) {\n      if (data[i][j].id === id) {\n        return { trackIndex: i, clipIndex: j };\n      }\n    }\n  }\n  return { trackIndex: -1, clipIndex: -1 };\n}\n\nexport function needShowPrepareTrack(data: Clip[][]) {\n  return !(data.length === 0 || (data.length === 1 && data[0].length === 0));\n}\n\nexport function millisecondsToWidth(milliseconds?: number) {\n  return (milliseconds || 0) / 1000 * SECOND_WIDTH;\n}\n\nexport function widthToMilliseconds(width: number) {\n  return Math.round(width / SECOND_WIDTH * 1000);\n}\n\nexport function getClipInsertIndex(cursorX: number, data: Clip[]) {\n  if (data.length) {\n    for (let i = 0; i < data.length; i++) {\n      const { start, end } = data[i].positionInTimeline;\n      if (cursorX >= start && cursorX <= end) {\n        return -1;\n      }\n      if (cursorX < start) {\n        return i;\n      }\n    }\n    if (cursorX > data[data.length - 1].positionInTimeline.end) {\n      return data.length;\n    }\n  }\n  return 0;\n}\n\nexport function getAvailableStartAndEnd(prepareInsertIndex: number, data: Clip[]) {\n  const pre = data[prepareInsertIndex - 1];\n  const next = data[prepareInsertIndex];\n  if (!pre && !next) {\n    return { start: 0, end: 10e9 };\n  }\n  if (!pre && next) {\n    return { start: 0, end: next.positionInTimeline.start };\n  }\n  if (pre && next) {\n    return { start: pre.positionInTimeline.end, end: next.positionInTimeline.start };\n  }\n  if (pre && !next) {\n    return { start: pre.positionInTimeline.end, end: 10e9 };\n  }\n  return { start: 0, end: 0 };\n}\n\n/**\n * 调整插入范围\n * @param availableRange 当前可供插入的范围\n * @param insertRange 要插入的范围\n */\nexport function adjustStartAndEnd(availableRange: Range, insertRange: Range): Range {\n  if (insertRange[0] >= availableRange[0] && insertRange[1] <= availableRange[1]) {\n    return insertRange;\n  }\n  if (insertRange[0] >= availableRange[0] && insertRange[1] > availableRange[1]) { // 需要左移\n    const diff = insertRange[1] - availableRange[1];\n    return [\n      Math.max(insertRange[0] - diff, availableRange[0]),\n      Math.min(insertRange[1] - diff, availableRange[1]),\n    ];\n  }\n  if (insertRange[0] < availableRange[0] && insertRange[1] <= availableRange[1]) { // 需要右移\n    const diff = availableRange[0] - insertRange[0];\n    return [\n      Math.max(insertRange[0] + diff, availableRange[0]),\n      Math.min(insertRange[1] + diff, availableRange[1]),\n    ];\n  }\n  if (insertRange[0] <= availableRange[0] && insertRange[1] >= availableRange[1]) {\n    return availableRange;\n  }\n  return insertRange;\n}\n\n/**\n * 获取当前编辑内容的总时长\n */\nexport function getTotalDuration(data: Clip[][]) {\n  let result = 0;\n  data.forEach((track) => {\n    if (track?.length) {\n      const lastClip = track[track.length - 1];\n      result = Math.max(result, lastClip.positionInTimeline.end);\n    }\n  });\n  return result;\n}\n\n/**\n * 判断两个clip是否相邻\n */\nexport function isClipsNext(clip1?: Clip, clip2?: Clip) {\n  if (clip1 && clip2) {\n    return Math.abs(clip1.positionInTimeline.end - clip2.positionInTimeline.start) <= 10e-6;\n  }\n  return false;\n}\n\nexport function canWithTransition(clipType: ClipType) {\n  return [\n    ClipType.VIDEO,\n    ClipType.IMAGE,\n    ClipType.GIF,\n  ].includes(clipType);\n}\n\nexport function isTransitionStart(tracks: Clip[][], clipId?: string) {\n  const transitions = tracks.flat(1).filter((clip) => clip.type === ClipType.TRANSITION);\n  return transitions.findIndex((transition) => (transition as TransitionClip).fromId === clipId) > -1;\n}\n\nexport function isTransitionEnd(tracks: Clip[][], clipId?: string) {\n  const transitions = tracks.flat(1).filter((clip) => clip.type === ClipType.TRANSITION);\n  return transitions.findIndex((transition) => (transition as TransitionClip).toId === clipId) > -1;\n}\n\nexport function getTransition(tracks: Clip[][], clipId?: string) {\n  const transitions = tracks.flat(1).filter((clip) => clip.type === ClipType.TRANSITION);\n  return transitions.findIndex((transition) => (transition as TransitionClip).fromId === clipId) > -1;\n}\n\nexport function deleteSelectedClip(editorContextValue: EditorContext) {\n  const { tracks, activeClipId, setTracks, setActiveClipId } = editorContextValue;\n  const { trackIndex, clipIndex } = getTrackAndClipIndex(tracks, activeClipId);\n  if (trackIndex > -1 && clipIndex > -1) {\n    const clip = tracks[trackIndex][clipIndex];\n    // 如果是transition，需要更新toClip的position\n    if (clip.type === ClipType.TRANSITION) {\n      const fromClip = tracks[trackIndex][clipIndex - 1];\n      const toClip = tracks[trackIndex][clipIndex + 1];\n      const afterToClip = tracks[trackIndex][clipIndex + 2];\n      const newRange = adjustStartAndEnd(\n        [fromClip?.positionInTimeline?.end || 0, afterToClip?.positionInTimeline?.start || 10e9],\n        [toClip.positionInTimeline.start + clip.positionInTimeline.duration / 2, toClip.positionInTimeline.end + clip.positionInTimeline.duration / 2]\n      );\n      Object.assign(toClip, {\n        positionInTimeline: {\n          start: newRange[0],\n          end: newRange[1],\n          duration: newRange[1] - newRange[0],\n        },\n      });\n      tracks[trackIndex].splice(clipIndex, 1); // 删除clip\n    } else if (isTransitionStart(tracks, activeClipId)) {\n      tracks[trackIndex].splice(clipIndex, 1); // 删除clip\n      tracks[trackIndex].splice(clipIndex, 1); // 删除transition\n    } else if (isTransitionEnd(tracks, activeClipId)) {\n      tracks[trackIndex].splice(clipIndex, 1); // 删除clip\n      tracks[trackIndex].splice(clipIndex - 1, 1); // 删除transition\n    } else {\n      tracks[trackIndex].splice(clipIndex, 1); // 删除clip\n    }\n    setActiveClipId('');\n    setTracks([...tracks]);\n  }\n}\n\nexport function isClipCanSplit(clipType: ClipType) {\n  return [\n    ClipType.AUDIO,\n    ClipType.GIF,\n    ClipType.IMAGE,\n    ClipType.VIDEO,\n  ].includes(clipType);\n}\n\nexport function splitSelectedClip(editorContextValue: EditorContext) {\n  const { tracks, activeClipId, setTracks, currentTime } = editorContextValue;\n  const { trackIndex, clipIndex } = getTrackAndClipIndex(tracks, activeClipId);\n  if (trackIndex > -1 && clipIndex > -1) {\n    const clip = tracks[trackIndex][clipIndex];\n    const canSplit = isClipCanSplit(clip.type);\n    const { start, end } = clip.positionInTimeline;\n    if (canSplit && start < currentTime && end > currentTime) {\n      const splitPercent = (currentTime - start) / (end - start);\n      const splitTime = Math.round((clip.playRange.end - clip.playRange.start) * splitPercent);\n      // 需保持playRange在positionInTimeline之前，不然计算playbackRate会有bug\n      tracks[trackIndex].splice(clipIndex + 1, 0, {\n        ...clip,\n        id: v4(),\n        playRange: {\n          start: splitTime,\n          end: clip.playRange.end,\n        },\n        positionInTimeline: {\n          start: currentTime,\n          end,\n          duration: end - currentTime,\n        },\n      });\n      Object.assign(clip, {\n        playRange: {\n          start: clip.playRange.start,\n          end: splitTime,\n        },\n        positionInTimeline: {\n          start,\n          end: currentTime,\n          duration: currentTime - start,\n        },\n      });\n      setTracks([...tracks]);\n    }\n  }\n}\n\n/**\n * 资源onLoad之前的初始化值\n */\n export function assetToClip(asset: Asset, start?: number, end?: number): Clip {\n  const common = {\n    name: asset.name,\n    positionInTimeline: {\n      start,\n      end,\n      duration: 0,\n    },\n    positionInRender: {\n      fitType: FitType.CONTAIN,\n      rotate: 0,\n      left: 0,\n      bottom: 0,\n      width: 0,\n      height: 0,\n    },\n    playRange: {\n      start: 0,\n      end: 0,\n    },\n    effect: EffectType.NO_EFFECT,\n  };\n  switch (asset.type) {\n    case AssetType.VIDEO:\n      return {\n        ...common,\n        type: ClipType.VIDEO,\n        url: (asset as VideoAsset).url,\n      } as VideoClip;\n    case AssetType.IMAGE:\n      return {\n        ...common,\n        type: ClipType.IMAGE,\n        url: (asset as VideoAsset).url,\n      } as ImageClip;\n    case AssetType.AUDIO:\n      return {\n        ...common,\n        type: ClipType.AUDIO,\n        url: (asset as AudioAsset).url,\n      } as AudioClip;\n    case AssetType.TRANSITION:\n      return {\n        ...common,\n        type: ClipType.TRANSITION,\n        transition: (asset as TransitionAsset).transition,\n      } as TransitionClip;\n    case AssetType.GIF:\n      return {\n        ...common,\n        positionInRender: {\n          ...common.positionInRender,\n          fitType: FitType.CUSTOM,\n        },\n        type: ClipType.GIF,\n        url: (asset as VideoAsset).url,\n        frames: [],\n        originalWidth: 0,\n        originalHeight: 0,\n        zIndex: 0,\n      } as GifClip;\n    case AssetType.TEXT:\n      return {\n        ...common,\n        positionInRender: {\n          ...common.positionInRender,\n          fitType: FitType.CUSTOM,\n          left: 50,\n          bottom: 50,\n        },\n        props: {\n          fontColor: '#fff',\n          fontSize: 16,\n          fontFamily: 'Helvetica',\n        },\n        value: (asset as TextAsset).value,\n        type: ClipType.TEXT,\n        originalWidth: 0,\n        originalHeight: 0,\n        zIndex: 0,\n      } as TextClip;\n    default:\n      return {} as Clip;\n  }\n}\n\nexport function getPlayerContainerBounding(): DOMRect {\n  const playerContainer = document.querySelector('.player-container');\n  if (playerContainer) {\n    return playerContainer.getBoundingClientRect();\n  }\n  return {\n    width: 0,\n    height: 0,\n    x: 0,\n    y: 0,\n    left: 0,\n    right: 0,\n    top: 0,\n    bottom: 0,\n    toJSON: () => {},\n  };\n}\n","import React, { useEffect } from 'react';\nimport { StyledAssetCard } from '../../../../../common/styleds';\nimport { AudioClip } from '../../../../../common/types/clip';\n\ntype Props = {\n  data: AudioClip;\n  onLoaded(data: AudioClip): void;\n};\n\nconst AudioCard: React.FC<Props> = ({ data, onLoaded }) => {\n  useEffect(() => {\n    if (!data.buffer) {\n      fetch(data.url).then((response) => {\n        return response.blob();\n      }).then((file: Blob) => {\n        const blobUrl = URL.createObjectURL(file);\n        const audio = document.createElement('audio');\n        audio.loop = false;\n        audio.addEventListener('loadedmetadata', () => {\n          file.arrayBuffer().then((buffer) => {\n            const duration = Math.round(audio.duration * 1000);\n            onLoaded({\n              ...data,\n              positionInTimeline: {\n                ...data.positionInTimeline,\n                duration: duration,\n              },\n              playRange: {\n                start: 0,\n                end: duration,\n              },\n              buffer,\n            });\n          }).catch((error) => {\n            alert(error.message);\n          });\n        });\n        audio.src = blobUrl;\n      }).catch((error) => {\n        alert(error.message);\n      });\n    }\n  }, [data, onLoaded]);\n  return (\n    <StyledAssetCard>\n      <audio src={data.url} />\n      <div className=\"title\">{data.name}</div>\n    </StyledAssetCard>\n  );\n};\n\nexport default AudioCard;\n","import React, { useEffect } from 'react';\nimport { parseGIF, decompressFrames } from 'gifuct-js';\nimport { GifClip } from '../../../../../common/types/clip';\nimport { StyledAssetCard } from '../../../../../common/styleds';\n\ntype Props = {\n  data: GifClip;\n  onLoaded(data: GifClip): void;\n};\n\nconst GifCard: React.FC<Props> = ({ data, onLoaded }) => {\n  useEffect(() => {\n    if (!data?.frames?.length) {\n      fetch(data.url).then((response) => {\n        return response.arrayBuffer();\n      }).then((buffer: ArrayBuffer) => {\n        const gif = parseGIF(buffer);\n        const frames = decompressFrames(gif, true);\n        let duration = 0;\n        frames.forEach((frame) => {\n          duration += frame.delay;\n        });\n        onLoaded({\n          ...data,\n          positionInTimeline: {\n            ...data.positionInTimeline,\n            duration,\n          },\n          positionInRender: {\n            ...data.positionInRender,\n            width: gif.lsd.width,\n            height: gif.lsd.height,\n          },\n          playRange: {\n            start: 0,\n            end: duration,\n          },\n          frames,\n          originalWidth: gif.lsd.width,\n          originalHeight: gif.lsd.height,\n        });\n      }).catch((error) => {\n        alert(error.message);\n      });\n    }\n  }, [data, onLoaded]);\n  return (\n    <StyledAssetCard>\n      <img src={data.url} alt=\"\" draggable=\"false\" />\n      <div className=\"title\">{data.name}</div>\n    </StyledAssetCard>\n  );\n};\n\nexport default GifCard;\n","import React, { useEffect } from 'react';\nimport { IMAGE_DEFAULT_DURATION } from '../../../../../common/configs/clip';\nimport { StyledAssetCard } from '../../../../../common/styleds';\nimport { ImageClip } from '../../../../../common/types/clip';\n\ntype Props = {\n  data: ImageClip;\n  onLoaded(data: ImageClip): void;\n};\n\nconst ImageCard: React.FC<Props> = ({ data, onLoaded }) => {\n  useEffect(() => {\n    if (!data.blobUrl) {\n      fetch(data.url).then((response) => {\n        return response.blob();\n      }).then((file: Blob) => {\n        const blobUrl = URL.createObjectURL(file);\n        const img = document.createElement('img');\n        img.addEventListener('load', () => {\n          onLoaded({\n            ...data,\n            positionInTimeline: {\n              ...data.positionInTimeline,\n              duration: IMAGE_DEFAULT_DURATION,\n            },\n            positionInRender: {\n              ...data.positionInRender,\n              width: img.naturalWidth,\n              height: img.naturalHeight,\n            },\n            originalWidth: img.naturalWidth,\n            originalHeight: img.naturalHeight,\n            blobUrl,\n          });\n        });\n        img.src = blobUrl;\n      }).catch((error) => {\n        alert(error.message);\n      });\n    }\n  }, [data, onLoaded]);\n  return (\n    <StyledAssetCard>\n      <img src={data.url} alt=\"\" draggable=\"false\" />\n      <div className=\"title\">{data.name}</div>\n    </StyledAssetCard>\n  );\n};\n\nexport default ImageCard;\n","export const TRANSITION_DEFAULT_DURATION = 1000;\n\nexport const TEXT_DEFAULT_DURATION = 2000;\n\nexport const IMAGE_DEFAULT_DURATION = 2000;\n","import React, { useEffect } from 'react';\nimport { TEXT_DEFAULT_DURATION } from '../../../../../common/configs/clip';\nimport { StyledAssetCard } from '../../../../../common/styleds';\nimport { TextClip } from '../../../../../common/types/clip';\nimport { getPixelRatio, getTextClipSize } from '../../../../../common/utils';\n\ntype Props = {\n  data: TextClip;\n  onLoaded(data: TextClip): void;\n};\n\nconst TextCard: React.FC<Props> = ({ data, onLoaded }) => {\n  useEffect(() => {\n    const { width, height } = getTextClipSize(data);\n    onLoaded({\n      ...data,\n      positionInTimeline: {\n        ...data.positionInTimeline,\n        duration: TEXT_DEFAULT_DURATION,\n      },\n      positionInRender: {\n        ...data.positionInRender,\n        width: width / getPixelRatio(),\n        height: height / getPixelRatio(),\n      },\n      originalWidth: width,\n      originalHeight: height,\n    });\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  return (\n    <StyledAssetCard>\n      <div className=\"title\">{data.name}</div>\n    </StyledAssetCard>\n  );\n};\n\nexport default TextCard;\n","import React, { useEffect } from 'react';\nimport { TRANSITION_DEFAULT_DURATION } from '../../../../../common/configs/clip';\nimport { StyledAssetCard } from '../../../../../common/styleds';\nimport { TransitionClip } from '../../../../../common/types/clip';\n\ntype Props = {\n  data: TransitionClip;\n  onLoaded(data: TransitionClip): void;\n};\n\nconst TransitionCard: React.FC<Props> = ({ data, onLoaded }) => {\n  useEffect(() => {\n    onLoaded({\n      ...data,\n      positionInTimeline: {\n        ...data.positionInTimeline,\n        duration: TRANSITION_DEFAULT_DURATION,\n      },\n    });\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  return (\n    <StyledAssetCard>\n      <div className=\"title\">{data.name}</div>\n    </StyledAssetCard>\n  );\n};\n\nexport default TransitionCard;\n","import React, { useEffect } from 'react';\nimport { StyledAssetCard } from '../../../../../common/styleds';\nimport { VideoClip } from '../../../../../common/types/clip';\n\ntype Props = {\n  data: VideoClip;\n  onLoaded(data: VideoClip): void;\n};\n\nconst VideoCard: React.FC<Props> = ({ data, onLoaded }) => {\n  useEffect(() => {\n    if (!data.blobUrl) {\n      fetch(data.url).then((response) => {\n        return response.blob();\n      }).then(async (file: Blob) => {\n        const buffer = await file.arrayBuffer();\n        const blobUrl = URL.createObjectURL(file);\n        const video = document.createElement('video');\n        video.loop = false;\n        video.addEventListener('loadedmetadata', () => {\n          const duration = Math.round(video.duration * 1000);\n          onLoaded({\n            ...data,\n            positionInTimeline: {\n              ...data.positionInTimeline,\n              duration: duration,\n            },\n            positionInRender: {\n              ...data.positionInRender,\n              width: video.videoWidth,\n              height: video.videoHeight,\n            },\n            playRange: {\n              start: 0,\n              end: duration,\n            },\n            originalWidth: video.videoWidth,\n            originalHeight: video.videoHeight,\n            blobUrl,\n            buffer,\n          });\n        });\n        video.src = blobUrl;\n      }).catch((error) => {\n        alert(error.message);\n      });\n    }\n  }, [data, onLoaded]);\n  return (\n    <StyledAssetCard>\n      <video src={data.blobUrl} />\n      <div className=\"title\">{data.name}</div>\n    </StyledAssetCard>\n  );\n};\n\nexport default VideoCard;\n","import styled from 'styled-components';\n\nexport const StyledCard = styled.div`\n  width: 160px;\n  height: 90px;\n  line-height: 90px;\n  text-align: center;\n  border-radius: 6px;\n  background-color: #949494;\n  cursor: pointer;\n`;\n","import React, { useCallback, useContext, useState } from 'react';\nimport { v4 } from 'uuid';\nimport { editorContext } from '../..';\nimport Draggable from '../../../common/components/Draggable';\nimport { MoveDirection } from '../../../common/components/Draggable/config';\nimport { DragInfo } from '../../../common/components/Draggable/type';\nimport { Asset } from '../../../common/types/asset';\nimport { AudioClip, Clip, ClipType, GifClip, ImageClip, TextClip, TransitionClip, VideoClip } from '../../../common/types/clip';\nimport { getClipRenderInfo } from '../../../player/util';\nimport { NEW_TRACK_THRESHOLD } from '../../config';\nimport {\n  adjustStartAndEnd,\n  assetToClip,\n  cursorPositionToElementPosition,\n  cursorPositionToTracksWrapperPosition,\n  getAvailableStartAndEnd,\n  getClipInsertIndex,\n  getPlayerContainerBounding,\n  getTrackAndClipIndex,\n  getTrackIndex,\n  getTrackWrapper,\n  millisecondsToWidth,\n  needShowPrepareTrack,\n  widthToMilliseconds,\n} from '../../util';\nimport AudioCard from './components/AudioCard';\nimport GifCard from './components/GifCard';\nimport ImageCard from './components/ImageCard';\nimport TextCard from './components/TextCard';\nimport TransitionCard from './components/TransitionCard';\nimport VideoCard from './components/VideoCard';\nimport { StyledCard } from './styled';\n\nfunction getAssetCard(data: Clip | undefined, handleLoaded: (data: Clip) => void) {\n  switch (data?.type) {\n    case ClipType.VIDEO:\n      return <VideoCard data={data as VideoClip} onLoaded={handleLoaded} />;\n    case ClipType.IMAGE:\n      return <ImageCard data={data as ImageClip} onLoaded={handleLoaded} />;\n    case ClipType.AUDIO:\n      return <AudioCard data={data as AudioClip} onLoaded={handleLoaded} />;\n    case ClipType.TRANSITION:\n        return <TransitionCard data={data as TransitionClip} onLoaded={handleLoaded} />;\n    case ClipType.GIF:\n      return <GifCard data={data as GifClip} onLoaded={handleLoaded} />;\n    case ClipType.TEXT:\n      return <TextCard data={data as TextClip} onLoaded={handleLoaded} />;\n    default:\n      return null;\n  }\n}\n\ntype Props = {\n  data: Asset;\n};\n\nconst AssetCard: React.FC<Props> = ({ data }) => {\n  const {\n    setHoverTrack,\n    tracks,\n    setTracks,\n    setNewTrackIndex,\n    newTrackIndex,\n    setDraggingClip,\n  } = useContext(editorContext);\n\n  const [loaded, setLoaded] = useState(false);\n  const [clip, setClip] = useState<Clip>(assetToClip(data));\n\n  const handleStart = useCallback(() => {\n    setDraggingClip(clip);\n  }, [clip, setDraggingClip]);\n\n  const handleMove = useCallback((dragInfo: DragInfo<Asset>) => {\n    if (clip?.type === ClipType.TRANSITION) {\n      return;\n    }\n    const hoverTrack = getTrackWrapper(dragInfo.belowElement);\n    if (hoverTrack) {\n      const pos = cursorPositionToElementPosition({ x: dragInfo.cursorLeft, y: dragInfo.cursorTop }, hoverTrack);\n      const showPrepareTrack = needShowPrepareTrack(tracks);\n      const trackIndex = getTrackIndex(hoverTrack);\n      if (pos.y <= NEW_TRACK_THRESHOLD && showPrepareTrack) {\n        setNewTrackIndex(trackIndex);\n      } else if (pos.y >= hoverTrack.clientHeight - NEW_TRACK_THRESHOLD && showPrepareTrack) {\n        setNewTrackIndex(trackIndex + 1);\n      } else {\n        setNewTrackIndex(-1);\n      }\n    }\n    setHoverTrack(hoverTrack);\n  }, [clip?.type, setHoverTrack, setNewTrackIndex, tracks]);\n\n  /**\n   * transition单独处理\n   */\n  const handleTransitionEnd = useCallback((dragInfo: DragInfo<Asset>) => {\n    const below = dragInfo.belowElement;\n    if (below.classList.contains('transition-insert') && clip) {\n      const fromId = below.dataset.from;\n      const toId = below.dataset.to;\n      const { trackIndex, clipIndex } = getTrackAndClipIndex(tracks, fromId);\n      const from = tracks[trackIndex][clipIndex];\n      const to = tracks[trackIndex][clipIndex + 1];\n      const halfTransitionDuration = clip.positionInTimeline.duration / 2;\n      const newClip: TransitionClip = {\n        ...(clip as TransitionClip),\n        id: v4(),\n        positionInTimeline: {\n          ...clip.positionInTimeline,\n          start: from.positionInTimeline.end - halfTransitionDuration,\n          end: from.positionInTimeline.end + halfTransitionDuration,\n        },\n        fromId,\n        toId,\n      };\n      Object.assign(to, {\n        positionInTimeline: {\n          ...to.positionInTimeline,\n          start: to.positionInTimeline.start - halfTransitionDuration,\n          end: to.positionInTimeline.end - halfTransitionDuration,\n        },\n      });\n      tracks[trackIndex].splice(clipIndex + 1, 0, newClip);\n      setTracks([...tracks]);\n    }\n    setDraggingClip(undefined);\n    setNewTrackIndex(-1);\n    setHoverTrack(null);\n  }, [clip, setDraggingClip, setHoverTrack, setNewTrackIndex, setTracks, tracks]);\n\n  const handleEnd = useCallback((dragInfo: DragInfo<Asset>) => {\n    if (clip?.type === ClipType.TRANSITION) {\n      handleTransitionEnd(dragInfo);\n      return;\n    }\n    const belowTrack = getTrackWrapper(dragInfo.belowElement);\n    const pos = cursorPositionToTracksWrapperPosition({ x: dragInfo.cursorLeft, y: dragInfo.cursorTop });\n    let trackIndex = -1;\n    if (newTrackIndex > -1) {\n      trackIndex = newTrackIndex;\n      tracks.splice(trackIndex, 0, []);\n    } else if (belowTrack) {\n      trackIndex = getTrackIndex(belowTrack);\n    }\n    const track = tracks[trackIndex];\n    if (trackIndex > -1 && track) {\n      // 获取将要插入的索引\n      const prepareInsertIndex = getClipInsertIndex(widthToMilliseconds(pos.x), track);\n      if (prepareInsertIndex > -1) {\n        // 获取可供插入的范围\n        const availableDuration = getAvailableStartAndEnd(prepareInsertIndex, track);\n        if (availableDuration.start || availableDuration.end) {\n          const duration = clip?.positionInTimeline?.duration || 0;\n          const width = millisecondsToWidth(duration); // 拖拽的元素放到track上的宽度\n          const dragElementWidth = dragInfo.element.clientWidth;\n          const shiftX = dragInfo.cursorLeft - dragInfo.left;\n          const start = widthToMilliseconds(Math.max(0, pos.x - (shiftX / dragElementWidth) * width));\n          const [finalStart, finalEnd] = adjustStartAndEnd(\n            [availableDuration.start, availableDuration.end],\n            [start, start + duration]\n          );\n          const { height: playerHeight, width: playerWidth } = getPlayerContainerBounding();\n          const { width: renderWidth, height: renderHeight, left, bottom } = getClipRenderInfo(clip, playerWidth, playerHeight);\n          const newClip: Clip = {\n            ...clip,\n            id: v4(),\n            positionInTimeline: {\n              start: finalStart,\n              end: finalEnd,\n              duration: finalEnd - finalStart,\n            },\n            positionInRender: {\n              ...clip.positionInRender,\n              width: renderWidth,\n              height: renderHeight,\n              left,\n              bottom,\n            },\n          };\n          track.splice(prepareInsertIndex, 0, newClip);\n          setTracks([...tracks]);\n        }\n      }\n    }\n    setDraggingClip(undefined);\n    setNewTrackIndex(-1);\n    setHoverTrack(null);\n  }, [clip, handleTransitionEnd, newTrackIndex, setDraggingClip, setHoverTrack, setNewTrackIndex, setTracks, tracks]);\n\n  const handleLoaded = useCallback((data: Clip) => {\n    setClip({ ...clip, ...data });\n    setLoaded(true);\n  }, [clip]);\n\n  return (\n    <Draggable\n      direction={MoveDirection.ALL}\n      scrollContainerSelector=\".tracks-wrapper\"\n      autoGrow={true}\n      enable={loaded}\n      slow={2}\n      onStart={handleStart}\n      onMove={handleMove}\n      onEnd={handleEnd}\n    >\n      <StyledCard>\n        {getAssetCard(clip, handleLoaded)}\n      </StyledCard>\n    </Draggable>\n  );\n};\n\nexport default AssetCard;\n","import React from 'react';\nimport { ASSET } from '../../../../../asset';\nimport { AssetCardContainer } from '../../../../../common/styleds';\nimport AssetCard from '../../../AssetCard';\n\nconst AudioPanel: React.FC = () => {\n  return (\n    <>\n      {\n        ASSET.audios.map((item) => {\n          return (\n            <AssetCardContainer key={item.name}>\n              <AssetCard data={item} />\n            </AssetCardContainer>\n          );\n        })\n      }\n    </>\n  );\n};\n\nexport default AudioPanel;\n","import React from 'react';\nimport { ASSET } from '../../../../../asset';\nimport { AssetCardContainer } from '../../../../../common/styleds';\nimport AssetCard from '../../../AssetCard';\n\nconst ImagePanel: React.FC = () => {\n  return (\n    <>\n      {\n        ASSET.images.map((item) => {\n          return (\n            <AssetCardContainer key={item.name}>\n              <AssetCard data={item} />\n            </AssetCardContainer>\n          );\n        })\n      }\n      {\n        ASSET.gifs.map((item) => {\n          return (\n            <AssetCardContainer key={item.name}>\n              <AssetCard data={item} />\n            </AssetCardContainer>\n          );\n        })\n      }\n    </>\n  );\n};\n\nexport default ImagePanel;\n","import styled from 'styled-components';\n\nexport const ResourcePanel = styled.div`\n  position: fixed;\n  left: 60px;\n  top: 50px;\n  bottom: 300px;\n  width: 380px;\n  background: #1A212B;\n  box-shadow: 5px 0px 9px rgb(0 0 0 / 5%);\n  transition: width 0.1s !important;\n  overflow: hidden;\n  \n  .inner-container {\n    display: flex;\n    flex-wrap: wrap;\n    align-content: flex-start;\n    width: 380px;\n  }\n`;\n","import React, { useCallback } from 'react';\nimport { MenuItemContainer } from '../../../../../common/styleds';\nimport { ResourcePanel } from './styled';\n\ntype Props = {\n  isActive: boolean;\n  title: string;\n  icon: React.ReactNode;\n  resourcePanel?: React.ReactNode;\n  onClick(title: string): void;\n};\n\nconst MenuItem: React.FC<Props> = ({ icon, title, resourcePanel, isActive, onClick }) => {\n  const handleClick = useCallback(() => {\n    onClick(title);\n  }, [onClick, title]);\n  return (\n    <>\n      <MenuItemContainer className={isActive ? 'active' : ''} onClick={handleClick}>\n        <div className=\"icon\">{icon}</div>\n        <div className=\"title\">{title}</div>\n      </MenuItemContainer>\n      <ResourcePanel style={{ ...(!isActive ? { width: 0 } : null) }}>\n        <div className=\"inner-container\">\n          {resourcePanel}\n        </div>\n      </ResourcePanel>\n    </>\n  );\n};\n\nexport default MenuItem;\n","import React from 'react';\n\nconst MinePanel: React.FC = () => {\n  return (\n    <>\n    </>\n  );\n};\n\nexport default MinePanel;\n","import React from 'react';\n\nconst ShapePanel: React.FC = () => {\n  return (\n    <>\n    </>\n  );\n};\n\nexport default ShapePanel;\n","import React from 'react';\nimport { ASSET } from '../../../../../asset';\nimport { AssetCardContainer } from '../../../../../common/styleds';\nimport AssetCard from '../../../AssetCard';\n\nconst TextPanel: React.FC = () => {\n  return (\n    <>\n      {\n        ASSET.texts.map((item) => {\n          return (\n            <AssetCardContainer key={item.name}>\n              <AssetCard data={item} />\n            </AssetCardContainer>\n          );\n        })\n      }\n    </>\n  );\n};\n\nexport default TextPanel;\n","import React from 'react';\nimport { ASSET } from '../../../../../asset';\nimport { AssetCardContainer } from '../../../../../common/styleds';\nimport AssetCard from '../../../AssetCard';\n\nconst TransitionPanel: React.FC = () => {\n  return (\n    <>\n      {\n        ASSET.transitions.map((item) => {\n          return (\n            <AssetCardContainer key={item.name}>\n              <AssetCard data={item} />\n            </AssetCardContainer>\n          );\n        })\n      }\n    </>\n  );\n};\n\nexport default TransitionPanel;\n","import React from 'react';\nimport { ASSET } from '../../../../../asset';\nimport { AssetCardContainer } from '../../../../../common/styleds';\nimport AssetCard from '../../../AssetCard';\n\nconst VideoPanel: React.FC = () => {\n  return (\n    <>\n      {\n        ASSET.videos.map((item) => {\n          return (\n            <AssetCardContainer key={item.name}>\n              <AssetCard data={item} />\n            </AssetCardContainer>\n          );\n        })\n      }\n    </>\n  );\n};\n\nexport default VideoPanel;\n","import styled from 'styled-components';\n\nexport const StyledSideBar = styled.div`\n  background: #1A2028;\n  border: 1px solid rgba(35, 42, 53, 0.8);\n  border-top: none;\n  box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.25);\n  width: 60px;\n`;\n","import React, { useCallback, useState } from 'react';\nimport MenuAudio from '../../../icons/MenuAudio';\nimport MenuImage from '../../../icons/MenuImage';\nimport MenuMine from '../../../icons/MenuMine';\nimport MenuShape from '../../../icons/MenuShape';\nimport MenuText from '../../../icons/MenuText';\nimport MenuTransition from '../../../icons/MenuTransition';\nimport MenuVideo from '../../../icons/MenuVideo';\nimport AudioPanel from './components/AudioPanel';\nimport ImagePanel from './components/ImagePanel';\nimport MenuItem from './components/MenuItem';\nimport MinePanel from './components/MinePanel';\nimport ShapePanel from './components/ShapePanel';\nimport TextPanel from './components/TextPanel';\nimport TransitionPanel from './components/TransitionPanel';\nimport VideoPanel from './components/VideoPanel';\nimport { StyledSideBar } from './styled';\n\nconst menuList = [\n  { title: '我的', icon: <MenuMine />, resourcePanel: <MinePanel /> },\n  { title: '视频', icon: <MenuVideo />, resourcePanel: <VideoPanel /> },\n  { title: '图片', icon: <MenuImage />, resourcePanel: <ImagePanel /> },\n  { title: '形状', icon: <MenuShape />, resourcePanel: <ShapePanel /> },\n  { title: '文字', icon: <MenuText />, resourcePanel: <TextPanel /> },\n  { title: '音频', icon: <MenuAudio />, resourcePanel: <AudioPanel /> },\n  { title: '转场', icon: <MenuTransition />, resourcePanel: <TransitionPanel /> },\n];\n\nconst SideBar: React.FC = () => {\n  const [activeTab, setActiveTab] = useState<string>();\n  const handleMenuItemClick = useCallback((title: string) => {\n    if (activeTab !== title) {\n      setActiveTab(title);\n    } else {\n      setActiveTab(undefined);\n    }\n  }, [activeTab]);\n  return (\n    <StyledSideBar>\n      {\n        menuList.map((item) => {\n          return (\n            <MenuItem\n              key={item.title}\n              title={item.title}\n              icon={item.icon}\n              resourcePanel={item.resourcePanel}\n              isActive={activeTab === item.title}\n              onClick={handleMenuItemClick}\n            />\n          );\n        })\n      }\n    </StyledSideBar>\n  );\n};\n\nexport default SideBar;\n","import * as React from 'react';\n\nfunction IndicatorBar(props: React.SVGProps<SVGSVGElement>) {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width={24}\n      height={28}\n      fill=\"none\"\n      {...props}\n    >\n      <g filter=\"url(#prefix__filter0_d_342:63)\">\n        <path\n          d=\"M6 3a1 1 0 011-1h10a1 1 0 011 1v9.586a1 1 0 01-.293.707l-4.414 4.414a1 1 0 01-.707.293h-1.172a1 1 0 01-.707-.293l-4.414-4.414A1 1 0 016 12.586V3z\"\n          fill=\"#367CE4\"\n        />\n      </g>\n      <defs>\n        <filter\n          id=\"prefix__filter0_d_342:63\"\n          x={0}\n          y={0}\n          width={24}\n          height={28}\n          filterUnits=\"userSpaceOnUse\"\n          colorInterpolationFilters=\"sRGB\"\n        >\n          <feFlood floodOpacity={0} result=\"BackgroundImageFix\" />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset dy={4} />\n          <feGaussianBlur stdDeviation={3} />\n          <feComposite in2=\"hardAlpha\" operator=\"out\" />\n          <feColorMatrix values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0\" />\n          <feBlend\n            in2=\"BackgroundImageFix\"\n            result=\"effect1_dropShadow_342:63\"\n          />\n          <feBlend\n            in=\"SourceGraphic\"\n            in2=\"effect1_dropShadow_342:63\"\n            result=\"shape\"\n          />\n        </filter>\n      </defs>\n    </svg>\n  );\n}\n\nexport default IndicatorBar;\n","import React, { useEffect, useRef } from 'react';\nimport { AudioClip } from '../../../../../../../common/types/clip';\nimport WaveSurfer from 'wavesurfer.js';\nimport { TRACK_HEIGHT } from '../../../../../../config';\n\ntype Props = {\n  clip: AudioClip;\n};\n\nconst AudioTrack: React.FC<Props> = ({ clip }) => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  useEffect(() => {\n    const container = containerRef.current;\n    if (container) {\n      const waveSurfer = WaveSurfer.create({\n        container: container,\n        waveColor: '#216fa3',\n        progressColor: 'purple',\n        fillParent: true,\n        partialRender: true,\n        interact: false,\n        height: TRACK_HEIGHT,\n      });\n      waveSurfer.load(clip.url);\n      return () => {\n        waveSurfer.destroy();\n      };\n    }\n  }, [clip.url]);\n  return (\n    <div style={{ width: '100%' }}>\n      <div ref={containerRef} style={{ position: 'absolute', left: 0, right: 0, top: 0, bottom: 0 }}>\n      </div>\n    </div>\n  );\n};\n\nexport default AudioTrack;\n","export default function Worker_fn() {\n  return new Worker(__webpack_public_path__ + \"static/js/gifToCanvas.worker.e6946d48.worker.js\");\n}\n","import { ParsedFrame } from 'gifuct-js';\nimport React, { memo, useEffect, useRef } from 'react';\nimport { GifClip } from '../../../../../../../common/types/clip';\nimport WebWorker from '../../../../../../../workers/gifToCanvas.worker.ts';\nimport { TRACK_HEIGHT } from '../../../../../../config';\nimport { millisecondsToWidth } from '../../../../../../util';\n\ntype Props = {\n  clip: GifClip;\n};\n\nasync function drawToCanvas(\n  worker: WebWorker,\n  snapCount: number,\n  from: number,\n  to: number,\n  frames: ParsedFrame[],\n) {\n  worker.postMessage({\n    snapCount,\n    from,\n    to,\n    frames,\n  });\n}\n\nconst GifTrack: React.FC<Props> = ({ clip }) => {\n  const { positionInTimeline, originalWidth, originalHeight, frames } = clip;\n  const snapCount = Math.ceil(millisecondsToWidth(positionInTimeline.duration) / TRACK_HEIGHT);\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const workerRef = useRef<WebWorker>(new WebWorker());\n\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    const worker = workerRef.current;\n    if (canvas && worker) {\n      // @ts-ignore\n      const offscreenCanvas = canvas.transferControlToOffscreen();\n      worker.postMessage({\n        canvas: offscreenCanvas,\n      }, [offscreenCanvas]);\n    }\n  }, []);\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    const worker = workerRef.current;\n    if (canvas && worker) {\n      drawToCanvas(worker, snapCount, clip.playRange.start, clip.playRange.end, frames);\n    }\n  }, [frames, clip.playRange.end, clip.playRange.start, snapCount]);\n  return (\n    <div style={{ width: '100%' }}>\n      <div style={{ position: 'absolute', left: 0, right: 0, top: 0, bottom: 0 }}>\n        <canvas\n          ref={canvasRef}\n          style={{ transformOrigin: 'left top', transform: `scale(${TRACK_HEIGHT / originalHeight})` }}\n          width={snapCount * originalWidth}\n          height={originalHeight}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default memo(GifTrack);\n","import React, { useEffect, useRef } from 'react';\nimport { ImageClip } from '../../../../../../../common/types/clip';\nimport { TRACK_HEIGHT } from '../../../../../../config';\nimport { millisecondsToWidth } from '../../../../../../util';\n\ntype Props = {\n  clip: ImageClip;\n};\n\nasync function drawImageToCanvas(\n  canvas: HTMLCanvasElement,\n  imageUrl: string,\n  snapWidth: number,\n  snapHeight: number,\n  snapCount: number,\n) {\n  const ctx = canvas.getContext('2d');\n  const image = new Image();\n  image.onload = function() {\n    let index = 0;\n    while (index < snapCount) {\n      ctx?.drawImage(image, snapWidth * index, 0, snapWidth, snapHeight);\n      index += 1;\n    }\n  };\n  image.src = imageUrl;\n}\n\nconst ImageTrack: React.FC<Props> = ({ clip }) => {\n  const { positionInTimeline, originalWidth, originalHeight } = clip;\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (canvas) {\n      const { width, height: snapHeight } = canvas.getBoundingClientRect();\n      const snapWidth = snapHeight * originalWidth / originalHeight;\n      const snapCount = Math.ceil(width / snapWidth); // 需要展示多少snap\n      drawImageToCanvas(canvas, clip.blobUrl, snapWidth, snapHeight, snapCount);\n    }\n  }, [clip.blobUrl, originalHeight, originalWidth, positionInTimeline.duration]);\n  return (\n    <div style={{ width: '100%' }}>\n      <div style={{ position: 'absolute', left: 0, right: 0, top: 0, bottom: 0 }}>\n        <canvas\n          ref={canvasRef}\n          width={millisecondsToWidth(positionInTimeline.duration)}\n          height={TRACK_HEIGHT}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default ImageTrack;\n","import React, { useEffect, useRef } from 'react';\nimport { VideoClip } from '../../../../../../../common/types/clip';\nimport { TRACK_HEIGHT } from '../../../../../../config';\nimport { millisecondsToWidth } from '../../../../../../util';\n\ntype Props = {\n  clip: VideoClip;\n};\n\nfunction seekVideo(video: HTMLVideoElement, currentTime: number) {\n  return new Promise((resolve) => {\n    function seeked() {\n      video.removeEventListener('seeked', seeked);\n      resolve(true);\n    }\n    video.addEventListener('seeked', seeked);\n    video.currentTime = currentTime / 1000;\n  });\n}\n\nasync function drawVideoToCanvas(\n  canvas: HTMLCanvasElement,\n  videoUrl: string,\n  snapWidth: number,\n  snapHeight: number,\n  snapCount: number,\n  from: number,\n  to: number,\n) {\n  const timeStep = (to - from) / snapCount;\n  const ctx = canvas.getContext('2d');\n  const video = document.createElement('video');\n  video.src = videoUrl;\n  let index = 0;\n  while (index < snapCount) {\n    await seekVideo(video, from + timeStep * index + 1);\n    ctx?.drawImage(video, snapWidth * index, 0, snapWidth, snapHeight);\n    index += 1;\n  }\n}\n\nconst VideoTrack: React.FC<Props> = ({ clip }) => {\n  const { positionInTimeline, originalWidth, originalHeight } = clip;\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (canvas) {\n      const { width, height: snapHeight } = canvas.getBoundingClientRect();\n      const snapWidth = snapHeight * originalWidth / originalHeight;\n      const snapCount = Math.ceil(width / snapWidth); // 需要展示多少snap\n      drawVideoToCanvas(canvas, clip.blobUrl, snapWidth, snapHeight, snapCount, clip.playRange.start, clip.playRange.end);\n    }\n  }, [clip.blobUrl, clip.playRange.end, clip.playRange.start, originalHeight, originalWidth, positionInTimeline.duration]);\n  return (\n    <div style={{ width: '100%' }}>\n      <div style={{ position: 'absolute', left: 0, right: 0, top: 0, bottom: 0 }}>\n        <canvas\n          ref={canvasRef}\n          width={millisecondsToWidth(positionInTimeline.duration)}\n          height={TRACK_HEIGHT}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default VideoTrack;\n","import styled from 'styled-components';\n\nexport const StyledTrackElement = styled.div`\n  /* background-color: #22a5df; */\n  border-radius: 5px;\n  height: 100%;\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  overflow: hidden;\n  display: flex;\n  &.active {\n    box-shadow: 0px 0px 5px 0px rgba(255, 255, 255, .5);\n  }\n`;\n\nexport const StyledLeftHandler = styled.div`\n  position: absolute;\n  width: 10px;\n  height: 100%;\n  left: 0;\n  top: 0;\n  bottom: 0;\n`;\n\nexport const StyledRightHandler = styled.div`\n  position: absolute;\n  width: 10px;\n  height: 100%;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  background: rgba(255, 255, 255, 0.8);\n`;\n\nexport const StyledName = styled.div`\n  color: #fff;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  padding-left: 10px;\n  flex-grow: 1;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n`;\n\nexport const StyledHandle = styled.div`\n  background: rgba(0, 0, 0, 0.5);\n  width: 10px;\n  cursor: ew-resize;\n  flex-shrink: 0;\n  position: relative;\n  z-index: 1;\n`;\n","import React, { memo, useCallback, useContext } from 'react';\nimport { editorContext } from '../../../..';\nimport Draggable from '../../../../../common/components/Draggable';\nimport { MoveDirection } from '../../../../../common/components/Draggable/config';\nimport { DragInfo } from '../../../../../common/components/Draggable/type';\nimport { Asset } from '../../../../../common/types/asset';\nimport { AudioClip, Clip, ClipType, GifClip, ImageClip, VideoClip } from '../../../../../common/types/clip';\nimport { NEW_TRACK_THRESHOLD } from '../../../../config';\nimport {\n  adjustStartAndEnd,\n  cursorPositionToElementPosition,\n  cursorPositionToTracksWrapperPosition,\n  getAvailableStartAndEnd,\n  getClipInsertIndex,\n  getTrackAndClipIndex,\n  getTrackIndex,\n  getTrackWrapper,\n  isTransitionEnd,\n  isTransitionStart,\n  millisecondsToWidth,\n  needShowPrepareTrack,\n  widthToMilliseconds,\n} from '../../../../util';\nimport AudioTrack from './components/AudioTrack';\nimport GifTrack from './components/GifTrack';\nimport ImageTrack from './components/ImageTrack';\nimport VideoTrack from './components/VideoTrack';\nimport { StyledHandle, StyledName, StyledTrackElement } from './styled';\n\nconst transitionStyle = {\n  zIndex: 999,\n  border: '2px solid #fff',\n};\n\nfunction getTrackComponent(clip: Clip) {\n  switch (clip.type) {\n    case ClipType.VIDEO:\n      return <VideoTrack clip={clip as VideoClip} />;\n    case ClipType.GIF:\n      return <GifTrack clip={clip as GifClip} />;\n    case ClipType.AUDIO:\n      return <AudioTrack clip={clip as AudioClip} />;\n    case ClipType.IMAGE:\n      return <ImageTrack clip={clip as ImageClip} />;\n    default:\n      return <StyledName>{clip.name}</StyledName>;\n  }\n}\n\ninterface Props {\n  clip: Clip;\n  onUpdate?(data: Partial<Clip>, trackIndex: number, clipIndex: number, isNewTrack: boolean): void;\n}\n\nconst TrackElement: React.FC<Props> = ({ clip, onUpdate }) => {\n  const { positionInTimeline, id, type } = clip;\n  const {\n    setHoverTrack,\n    tracks,\n    setTracks,\n    setNewTrackIndex,\n    newTrackIndex,\n    activeClipId,\n    setActiveClipId,\n  } = useContext(editorContext);\n\n  const handleTransition = useCallback((dragInfo: DragInfo<Asset>) => {\n    // const pos = cursorPositionToTracksWrapperPosition({ x: dragInfo.cursorLeft, y: dragInfo.cursorTop });\n    // let newStart = widthToMilliseconds(pos.x - (dragInfo.cursorLeft - dragInfo.left));\n    if (dragInfo.stepLeft !== 0 || dragInfo.stepTop !== 0) {\n      const { trackIndex, clipIndex } = getTrackAndClipIndex(tracks, id);\n      if (isTransitionStart(tracks, id)) {\n        // const transition = tracks[trackIndex][clipIndex + 1];\n        // 删除transition\n        tracks[trackIndex].splice(clipIndex + 1, 1);\n        // const to = tracks[trackIndex][clipIndex + 1];\n        // Object.assign(to, {\n        //   start: to.start + transition.duration / 2,\n        //   end: to.end + transition.duration / 2,\n        // });\n        setTracks([...tracks]);\n      } else if (isTransitionEnd(tracks, id)) {\n        // const transition = tracks[trackIndex][clipIndex - 1];\n        // const to = tracks[trackIndex][clipIndex];\n        // 更新clip start和duration\n        // Object.assign(to, {\n        //   start: to.start + transition.duration / 2,\n        //   end: to.end + transition.duration / 2,\n        // });\n        // 删除transition\n        tracks[trackIndex].splice(clipIndex - 1, 1);\n        setTracks([...tracks]);\n      }\n    }\n  }, [id, setTracks, tracks]);\n\n  const handleMove = useCallback((dragInfo: DragInfo<Asset>) => {\n    handleTransition(dragInfo);\n\n    const hoverTrack = getTrackWrapper(dragInfo.belowElement);\n    if (hoverTrack) {\n      const pos = cursorPositionToElementPosition({ x: dragInfo.cursorLeft, y: dragInfo.cursorTop }, hoverTrack);\n      const showPrepareTrack = needShowPrepareTrack(tracks);\n      const trackIndex = getTrackIndex(hoverTrack);\n      if (pos.y <= NEW_TRACK_THRESHOLD && showPrepareTrack) {\n        setNewTrackIndex(trackIndex);\n      } else if (pos.y >= hoverTrack.clientHeight - NEW_TRACK_THRESHOLD && showPrepareTrack) {\n        setNewTrackIndex(trackIndex + 1);\n      } else {\n        setNewTrackIndex(-1);\n      }\n    }\n    setHoverTrack(hoverTrack);\n  }, [handleTransition, setHoverTrack, setNewTrackIndex, tracks]);\n\n  const handleEnd = useCallback((dragInfo: DragInfo<Asset>) => {\n    if (dragInfo.isMoved) {\n      const belowTrack = getTrackWrapper(dragInfo.belowElement);\n      const pos = cursorPositionToTracksWrapperPosition({ x: dragInfo.cursorLeft, y: dragInfo.cursorTop });\n      let newStart = widthToMilliseconds(Math.max(0, pos.x - (dragInfo.cursorLeft - dragInfo.left)));\n      let updated = false;\n      if (newTrackIndex > -1) {\n        updated = true;\n        onUpdate?.({\n          positionInTimeline: {\n            ...positionInTimeline,\n            start: newStart, \n            end: newStart + positionInTimeline.duration \n          },\n        }, newTrackIndex, 0, true);\n      } else if (belowTrack) {\n        let trackIndex = getTrackIndex(belowTrack);\n        const { trackIndex: originalTrackIndex } = getTrackAndClipIndex(tracks, id);\n        let track = tracks[trackIndex];\n        if (trackIndex === originalTrackIndex) {\n          track = track.filter((item) => item.id !== id);\n        }\n        if (trackIndex > -1 && track) {\n          const prepareInsertIndex = getClipInsertIndex(widthToMilliseconds(pos.x), track);\n          if (prepareInsertIndex > -1) {\n            const availableDuration = getAvailableStartAndEnd(prepareInsertIndex, track);\n            if (availableDuration.start || availableDuration.end) {\n              const [start, end] = adjustStartAndEnd(\n                [availableDuration.start, availableDuration.end],\n                [newStart, newStart + positionInTimeline.duration]\n              );\n              updated = true;\n              onUpdate?.({\n                positionInTimeline: {\n                  start,\n                  end,\n                  duration: end - start,\n                },\n              }, trackIndex, prepareInsertIndex, false);\n            }\n          }\n        }\n      }\n      // 删除transition之后可能会错位，需要修正\n      if (!updated) {\n        const { trackIndex, clipIndex } = getTrackAndClipIndex(tracks, id);\n        const before = tracks[trackIndex][clipIndex - 1];\n        const after = tracks[trackIndex][clipIndex + 1];\n        if ((before && before.positionInTimeline.end > positionInTimeline.start) || (after && after.positionInTimeline.start < positionInTimeline.end)) {\n          const newRange = adjustStartAndEnd(\n            [before?.positionInTimeline?.end || 0, after?.positionInTimeline?.start || 10e9],\n            [positionInTimeline.start, positionInTimeline.end]\n          );\n          onUpdate?.({\n            positionInTimeline: {\n              start: newRange[0],\n              end: newRange[1],\n              duration: newRange[1] - newRange[0],\n            },\n          }, trackIndex, clipIndex, false);\n        }\n      }\n    }\n    setNewTrackIndex(-1);\n    setHoverTrack(null);\n  }, [id, newTrackIndex, onUpdate, positionInTimeline, setHoverTrack, setNewTrackIndex, tracks]);\n\n  const handleLeftHandleMove = useCallback((dragInfo: DragInfo<Asset>) => {\n    const newStart = positionInTimeline.start + widthToMilliseconds(dragInfo.stepLeft);\n    if (positionInTimeline.end - newStart >= 500) {\n      const { trackIndex, clipIndex } = getTrackAndClipIndex(tracks, id);\n      const preClipEnd = tracks[trackIndex][clipIndex - 1]?.positionInTimeline?.end || 0;\n      onUpdate?.({\n        positionInTimeline: {\n          ...positionInTimeline,\n          start: Math.max(newStart, preClipEnd),\n          duration: positionInTimeline.end - Math.max(newStart, preClipEnd),\n        },\n      }, trackIndex, clipIndex, false);\n    }\n  }, [id, onUpdate, positionInTimeline, tracks]);\n\n  const handleRightHandleMove = useCallback((dragInfo: DragInfo<Asset>) => {\n    const newEnd = positionInTimeline.end + widthToMilliseconds(dragInfo.stepLeft);\n    if (newEnd - positionInTimeline.start >= 500) {\n      const { trackIndex, clipIndex } = getTrackAndClipIndex(tracks, id);\n      const nextClipStart = tracks[trackIndex][clipIndex + 1]?.positionInTimeline?.start || 10e9;\n      onUpdate?.({\n        positionInTimeline: {\n          ...positionInTimeline,\n          end: Math.min(newEnd, nextClipStart),\n          duration: Math.min(newEnd, nextClipStart) - positionInTimeline.start,\n        },\n      }, trackIndex, clipIndex, false);\n    }\n  }, [positionInTimeline, tracks, id, onUpdate]);\n\n  /**\n   * 拖拽结束的时候更新duration\n   */\n  const handleHandleEnd = useCallback(() => {\n    const { trackIndex, clipIndex } = getTrackAndClipIndex(tracks, id);\n    onUpdate?.({\n      positionInTimeline: {\n        ...positionInTimeline,\n        duration: positionInTimeline.end - positionInTimeline.start,\n      },\n    }, trackIndex, clipIndex, false);\n  }, [id, onUpdate, positionInTimeline, tracks]);\n\n  const handleClick = useCallback((e: React.MouseEvent) => {\n    e.stopPropagation();\n    setActiveClipId(id || '');\n  }, [id, setActiveClipId]);\n\n  const isTransition = type === ClipType.TRANSITION;\n\n  return (\n    <Draggable\n      scrollContainerSelector=\".tracks-wrapper\"\n      autoGrow={true}\n      slow={2}\n      onMove={handleMove}\n      onEnd={handleEnd}\n      enable={!isTransition}\n    >\n      <StyledTrackElement\n        className={`track-element ${activeClipId === id ? 'active' : ''}`}\n        onClick={handleClick}\n        style={{\n          width: millisecondsToWidth(positionInTimeline.end - positionInTimeline.start),\n          left: millisecondsToWidth(positionInTimeline.start),\n          ...( type === ClipType.TRANSITION ? transitionStyle : null ),\n        }}\n      >\n        {\n          !isTransition && !isTransitionEnd(tracks, id) ? <StyledHandle>\n            <Draggable\n              direction={MoveDirection.EW}\n              onMove={handleLeftHandleMove}\n              onEnd={handleHandleEnd}\n            >\n              <div style={{ width: '100%', height: '100%' }}></div>\n            </Draggable>\n          </StyledHandle> : null\n        }\n        {getTrackComponent(clip)}\n        {\n          !isTransition && !isTransitionStart(tracks, id) ? <StyledHandle>\n            <Draggable\n              direction={MoveDirection.EW}\n              onMove={handleRightHandleMove}\n              onEnd={handleHandleEnd}\n            >\n              <div style={{ width: '100%', height: '100%' }}></div>\n            </Draggable>\n          </StyledHandle> : null\n        }\n      </StyledTrackElement>\n    </Draggable>\n  );\n};\n\nexport default memo(TrackElement);\n","import styled from 'styled-components';\n\nexport const StyledTrackWrapper = styled.div`\n  width: 100%;\n  height: 46px;\n  padding: 5px 0px;\n  flex-shrink: 0;\n`;\n\nexport const StyledTrack = styled.div`\n  width: 100%;\n  height: 100%;\n  border: 2px dashed #203351;\n  border-radius: 8px;\n  position: relative;\n  background: #121314;\n`;\n\nexport const StyledNewPrepareTrack = styled.div`\n  height: 0;\n  position: relative;\n  pointer-events: none;\n  &::after {\n    content: '';\n    position: absolute;\n    background: rgb(69 211 174);\n    width: 100%;\n    height: 2px;\n    border-radius: 2px;\n    left: 0;\n    right: 0;\n    top: -1px;\n  }\n  &::before {\n    content: '+';\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    width: 20px;\n    height: 20px;\n    border-radius: 10px;\n    background: rgb(69 211 174);\n    transform: translate(-10px, -10px);\n    text-align: center;\n    line-height: 20px;\n    z-index: 1;\n  }\n`;\n","import React, { useCallback, useContext } from 'react';\nimport { editorContext } from '../../../..';\nimport { Clip, ClipType } from '../../../../../common/types/clip';\nimport { TRACK_WRAPPER_CLASS_NAME } from '../../../../config';\nimport { canWithTransition, getTrackAndClipIndex, getTrackIndex, isClipsNext, millisecondsToWidth, needShowPrepareTrack } from '../../../../util';\nimport TrackElement from '../TrackElement';\nimport { StyledTrackElement } from '../TrackElement/styled';\nimport { StyledNewPrepareTrack, StyledTrack, StyledTrackWrapper } from './styled';\n\ntype Props = {\n  clips: Clip[];\n  index: number;\n  style?: React.CSSProperties;\n};\n\nconst Track: React.FC<Props> = ({ clips, style, index }) => {\n  const { hoverTrack, tracks, setTracks, newTrackIndex, draggingClip } = useContext(editorContext);\n  const hoverIndex = getTrackIndex(hoverTrack);\n  const handleUpdate = useCallback((oldData: Clip, newData: Partial<Clip>, newTrackIndex: number, newClipIndex: number, isNewTrack: boolean) => {\n    // 获取原数据所在索引\n    const { trackIndex, clipIndex } = getTrackAndClipIndex(tracks, oldData.id);\n    if (trackIndex > -1 && clipIndex > -1) {\n      // 删除原clip\n      const oldData = tracks[trackIndex].splice(clipIndex, 1)[0];\n      Object.assign(oldData, newData);\n      if (isNewTrack) {\n        tracks.splice(newTrackIndex, 0, [oldData]);\n      } else {\n        tracks[newTrackIndex].splice(newClipIndex, 0, oldData);\n      }\n      setTracks([...tracks]);\n    }\n  }, [setTracks, tracks]);\n  const showPrepareTrack = needShowPrepareTrack(tracks);\n  const isDraggingTransition = draggingClip?.type === ClipType.TRANSITION;\n  return (\n    <>\n      {\n        showPrepareTrack && newTrackIndex === index ? <StyledNewPrepareTrack /> : null\n      }\n      <StyledTrackWrapper style={style} className={TRACK_WRAPPER_CLASS_NAME}>\n        <StyledTrack\n          style={{\n            ...(clips.length ? { border: 0, background: '#121314' } : null),\n            ...(hoverIndex === index && newTrackIndex === -1 ? { background: 'rgb(18 19 20 / 50%)' } : null)\n          }}\n        >\n          {\n            clips.map((clip, index) => {\n              const nextClip = clips[index + 1];\n              let showTransitionPrepareInsert = false;\n              if (isDraggingTransition && isClipsNext(clip, nextClip)) {\n                if (canWithTransition(clip?.type) && canWithTransition(nextClip?.type)) {\n                  showTransitionPrepareInsert = true;\n                }\n              }\n              return (\n                <React.Fragment key={clip.id}>\n                  <TrackElement\n                    clip={clip}\n                    onUpdate={(data: Partial<Clip>, newTrackIndex: number, newClipIndex: number, isNewTrack: boolean) => {\n                      handleUpdate(clip, data, newTrackIndex, newClipIndex, isNewTrack);\n                    }}\n                  />\n                  {\n                    showTransitionPrepareInsert && draggingClip ? <StyledTrackElement\n                      className=\"transition-insert\"\n                      data-from={clip.id}\n                      data-to={nextClip.id}\n                      style={{\n                        width: millisecondsToWidth(draggingClip.positionInTimeline.duration),\n                        left: millisecondsToWidth(clip.positionInTimeline.end - draggingClip.positionInTimeline.duration / 2),\n                        zIndex: 999,\n                        opacity: 0.5,\n                        border: '2px solid #fff',\n                      }}\n                    /> : null\n                  }\n                </React.Fragment>\n              );\n            })\n          }\n        </StyledTrack>\n      </StyledTrackWrapper>\n      {\n        showPrepareTrack && newTrackIndex === index + 1 ? <StyledNewPrepareTrack /> : null\n      }\n    </>\n  );\n};\n\nexport default Track;\n","import styled from 'styled-components';\n\nexport const StyledTracksWrapper = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  padding: 10px 20px;\n  position: relative;\n  overflow-y: auto;\n  overscroll-behavior: unset;\n`;\n\nexport const StyledTracks = styled.div`\n  flex: 1 1 0%;\n  display: flex;\n  flex-direction: column;\n  -webkit-box-pack: center;\n  justify-content: center;\n`;\n\nexport const StyledIndicator = styled.div`\n  width: 0;\n  top: 40px;\n  bottom: 4px;\n  position: absolute;\n  /* cursor: move; */\n  z-index: 1000;\n\n  &::before {\n    content: '';\n    width: 2px;\n    background-color: #367CE4;\n    left: -1px;\n    top: -10px;\n    bottom: 0;\n    border-radius: 2px;\n    position: absolute;\n  }\n\n  .indicator-bar {\n    position: absolute;\n    top: -20px;\n    left: -12px;\n  }\n`;\n","import React, { useCallback, useContext } from 'react';\nimport { editorContext } from '../..';\nimport IndicatorBar from '../../../icons/IndicatorBar';\nimport { cursorPositionToTracksWrapperPosition, getTotalDuration, millisecondsToWidth, widthToMilliseconds } from '../../util';\nimport Track from './components/Track';\nimport { StyledIndicator, StyledTracks, StyledTracksWrapper } from './styled';\n\ntype Props = {\n  onCurrentTimeChange(currentTime: number): void;\n};\n\nconst Tracks: React.FC<Props> = ({ onCurrentTimeChange }) => {\n  const { tracks, currentTime } = useContext(editorContext);\n  const trackStyle: React.CSSProperties = tracks.length === 1 && tracks[0].length === 0 ? { height: 90 } : {};\n\n  const handleCurrentTimeChange = useCallback((x: number, y: number, width: number) => {\n    const totalDuration = getTotalDuration(tracks);\n    const pos = cursorPositionToTracksWrapperPosition({ x, y });\n    const newCurrentTime = widthToMilliseconds(Math.max(0, pos.x - width));\n    onCurrentTimeChange(Math.min(newCurrentTime, totalDuration));\n  }, [onCurrentTimeChange, tracks]);\n\n  const handleTracksWrapperClick = useCallback((e: React.MouseEvent) => {\n    handleCurrentTimeChange(e.pageX, e.pageY, 0);\n  }, [handleCurrentTimeChange]);\n\n  return (\n    <>\n      <StyledTracksWrapper className=\"tracks-wrapper\" onClick={handleTracksWrapperClick}>\n        <StyledTracks>\n          {\n            tracks.map((clips, index) => {\n              return (\n                <Track index={index} clips={clips} key={index} style={trackStyle} />\n              );\n            })\n          }\n        </StyledTracks>\n      </StyledTracksWrapper>\n      <StyledIndicator style={{ left: millisecondsToWidth(currentTime) + 20 }}>\n        <IndicatorBar className=\"indicator-bar\" />\n      </StyledIndicator>\n    </>\n  );\n};\n\nexport default Tracks;\n","import styled from 'styled-components';\n\nexport const StyledEditor = styled.div`\n  display: flex;\n  width: 100%;\n  height: calc(100% - 50px);\n  user-select: none;\n  overflow: hidden;\n`;\n\nexport const StyledEditorLeft = styled.div`\n  display: flex;\n  height: 100%;\n  position: relative;\n  z-index: 2000;\n`;\n\nexport const StyledEditorRight = styled.div`\n  display: flex;\n  flex: 1 1 0%;\n  flex-direction: column;\n  overflow: hidden;\n`;\n\nexport const StyledStageTimeline = styled.div`\n  flex: 1 1 0%;\n  display: grid;\n  grid-template-rows: minmax(200px, 1.1fr) minmax(200px, 0.9fr);\n  overflow: hidden;\n`;\n\nexport const StyledTimelineWrapper = styled.div`\n  background-color: #14181D;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  position: relative;\n`;\n\nexport const TracksScrollContainer = styled.div`\n  overflow-x: auto;\n  display: flex;\n  flex-direction: column;\n  flex-grow: 1;\n  position: relative;\n`;\n\nexport const Stage = styled.div`\n  display: flex;\n  justify-content: space-around;\n  align-items: center;\n`;\n","import styled from 'styled-components';\n\nexport const StyledRuler = styled.div`\n  padding: 0 20px;\n  height: 36px;\n  display: flex;\n  overflow: hidden;\n  flex-grow: 0;\n  flex-shrink: 0;\n  background: #1A2028;\n  border-top: 1px solid #14181D;\n  box-shadow: 0px 12px 16px rgba(0, 0, 0, 0.14);\n`;\n\nexport const StyledRulerItem = styled.div`\n  position: relative;\n  height: 20px;\n  padding: 8px 5px;\n  font-size: 12px;\n  line-height: 12px;\n  color: #7185A6;\n  flex-grow: 0;\n  flex-shrink: 0;\n  &::before {\n    content: '';\n    position: absolute;\n    left: 0;\n    top: 0;\n    bottom: 0;\n    width: 1px;\n    height: 20px;\n    background-color: #566C8D;;\n  }\n  &::after {\n    content: '';\n    position: absolute;\n    left: 50%;\n    top: 0;\n    bottom: 0;\n    width: 1px;\n    height: 12px;\n    background: #566C8D;\n    opacity: 0.5;\n  }\n`;\n\n","import React, { useEffect, useState } from 'react';\nimport { formatMillisecond } from '../../../common/utils';\nimport { SECOND_WIDTH } from '../../config';\nimport { StyledRuler, StyledRulerItem } from './styled';\n\nconst Ruler: React.FC = () => {\n  const [width, setWidth] = useState(0);\n  useEffect(() => {\n    const tracksWrapper = document.querySelector('.tracks-wrapper') as HTMLElement;\n    if (tracksWrapper) {\n      setWidth(tracksWrapper.clientWidth);\n      const observer = new ResizeObserver(() => {\n        const tracksWrapperWidth = tracksWrapper.clientWidth;\n        if (tracksWrapperWidth !== width) {\n          setWidth(tracksWrapper.clientWidth);\n        }\n      });\n      observer.observe(tracksWrapper)\n      return () => {\n        observer.disconnect();\n      };\n    }\n  }, [width]);\n  return (\n    <StyledRuler style={{ width }}>\n      {\n        Array.from(Array(Math.ceil(width / SECOND_WIDTH))).map((value, index) => {\n          return (\n            <StyledRulerItem key={index} style={{ width: SECOND_WIDTH }}>\n              {formatMillisecond(index * 1000, false, false)}\n            </StyledRulerItem>\n          );\n        })\n      }\n    </StyledRuler>\n  );\n};\n\nexport default Ruler;\n","import { EditorContext, PlayerContext } from '../type';\nimport { deleteSelectedClip, splitSelectedClip } from '../util';\nimport { useKeyPress } from 'ahooks';\n\nexport const useDeleteClip = (editorContextValue: EditorContext) => {\n  useKeyPress('Backspace', () => {\n    deleteSelectedClip(editorContextValue);\n  });\n};\n\n/**\n * 切分当前选中的clip\n */\nexport const useSplitClip = (editorContextValue: EditorContext) => {\n  useKeyPress('ctrl.c', () => {\n    splitSelectedClip(editorContextValue);\n  });\n};\n\n/**\n * 播放/暂停\n */\n export const usePlayControl = (editorContextValue: EditorContext, playerContext: PlayerContext) => {\n  useKeyPress(' ', () => {\n    const { isPlaying } = editorContextValue;\n    playerContext.handleIsPlayingChange(!isPlaying);\n  });\n};\n\nexport const useKeyboard = (editorContextValue: EditorContext, playerContext: PlayerContext) => {\n  useDeleteClip(editorContextValue);\n  useSplitClip(editorContextValue);\n  usePlayControl(editorContextValue, playerContext);\n};\n","import * as THREE from 'three';\nimport { getPixelRatio } from '../../common/utils';\n\nexport default class Painter {\n  private scene: THREE.Scene;\n  private camera: THREE.Camera;\n  private renderer: THREE.WebGLRenderer;\n  private maxAnisotropy: number;\n\n  constructor(width: number, height: number) {\n    this.scene = new THREE.Scene();\n    this.camera = new THREE.OrthographicCamera(width / - 2, width / 2, height / 2, height / - 2, -1000, 1000);\n    this.renderer = new THREE.WebGLRenderer({ \n      preserveDrawingBuffer: true,\n      antialias: true,\n    });\n    this.renderer.setPixelRatio(getPixelRatio());\n    this.renderer.setSize(width, height);\n    this.maxAnisotropy = this.renderer.capabilities.getMaxAnisotropy();\n  }\n\n  public add(sprite: THREE.Mesh, name: string) {\n    sprite.name = name;\n    this.scene.add(sprite);\n  }\n\n  public remove(name: string) {\n    const selectedObject = this.scene.getObjectByName(name);\n    if (selectedObject) {\n      this.scene.remove(selectedObject);\n    }\n  }\n\n  public getRealSize() {\n    const result = new THREE.Vector2();\n    this.renderer.getDrawingBufferSize(result);\n    return result;\n  }\n\n  public getDomElement() {\n    return this.renderer.domElement;\n  }\n\n  public render() {\n    const { renderer, scene, camera } = this;\n    renderer.render(scene, camera);\n  }\n}\n","import Painter from './painter';\nimport { Clip, ClipType } from '../common/types/clip';\nimport { ClipBase } from './clips/base';\nimport { createClip } from './util';\nimport { watch } from '../common/utils/watch';\nimport { Transition } from './clips/transition';\n\ntype Props = {\n  width: number;\n  height: number;\n  onCurrentTimeChange?(currentTime: number): void;\n  onEnd?(): void;\n};\n\nexport default class Player {\n  // 自动播放相关\n  private tickTime = 0;\n  private rafId = 0;\n  private tickFunc;\n\n  private onCurrentTimeChangeCallback?: (currentTime: number) => void;\n  private onEnd?: () => void;\n\n  public painter: Painter;\n  public clips: ClipBase<Clip>[] = [];\n\n  /**\n   * 播放相关属性\n   */\n  public currentTime = 0;\n  public duration = 0;\n  public isPlaying = false;\n  public width = 0;\n  public height = 0;\n\n  constructor({ width, height, onCurrentTimeChange, onEnd }: Props) {\n    this.width = width;\n    this.height = height;\n    this.painter = new Painter(width, height);\n    this.onCurrentTimeChangeCallback = onCurrentTimeChange;\n    this.onEnd = onEnd;\n    this.tickFunc = this.tick.bind(this);\n    this.rafId = requestAnimationFrame(this.tickFunc);\n  }\n\n  private async tick(time: number) {\n    await this.render(time);\n    this.rafId = requestAnimationFrame(this.tickFunc);\n  }\n\n  public isInRange(clip: ClipBase<Clip>) {\n    const { start, end } = clip.config.positionInTimeline;\n    return start <= this.currentTime && end >= this.currentTime;\n  }\n\n  public updateDuration() {\n    this.duration = 0;\n    this.clips.forEach(({ config }) => {\n      if (config.positionInTimeline.end > this.duration) {\n        this.duration = config.positionInTimeline.end;\n      }\n    });\n  }\n\n  public getClipById(id?: string) {\n    return this.clips.find((clip) => clip.config.id === id);\n  }\n\n  public async addClip(clip: Clip) {\n    const newClip = createClip(clip, this) as ClipBase<Clip>;\n    await newClip.init();\n    this.clips.push(newClip);\n    await this.onCurrentTimeChange();\n    this.updateDuration();\n\n    // 位置改变时\n    watch(newClip.config, 'positionInTimeline', async (val) => {\n      newClip.updatePlaybackRate();\n      if (this.isInRange(newClip)) {\n        if (newClip.isEntered) {\n          await newClip.onUpdate(true);\n        } else {\n          newClip.isEntered = true;\n          newClip.addToPainter();\n          await newClip.onEnter(true);\n        }\n      } else {\n        if (newClip.isEntered) {\n          newClip.isEntered = false;\n          newClip.removeFromPainter();\n          await newClip.onLeave(true);\n        }\n      }\n    });\n    // watch(newClip.config, 'playRange', async () => {\n    //   await newClip.onUpdate(true);\n    // });\n  }\n\n  public async removeClip(id?: string) {\n    const clip = this.getClipById(id);\n    if (clip) {\n      await clip.destroy();\n      if (clip.config.type === ClipType.TRANSITION) {\n        const fromClip = this.getClipById((clip as Transition).config.fromId);\n        const toClip = this.getClipById((clip as Transition).config.toId);\n        fromClip?.show();\n        toClip?.show();\n      }\n      this.clips.splice(this.clips.indexOf(clip), 1);\n      this.updateDuration();\n    }\n  }\n\n  private async render(time: number) {\n    const intTime = Math.floor(time); // 转为整数\n    if (this.isPlaying) {\n      this.currentTime += intTime - this.tickTime;\n      this.currentTime = Math.min(this.currentTime, this.duration);\n      await this.onCurrentTimeChange();\n      if (this.currentTime >= this.duration) {\n        this.pause();\n        this.onEnd?.();\n      }\n    }\n    this.painter.render();\n    this.tickTime = intTime;\n  }\n\n  /**\n   * 播放\n   */\n  public async play() {\n    if (!this.isPlaying) {\n      this.isPlaying = true;\n      this.clips.forEach((clip) => {\n        if (this.isInRange(clip)) {\n          clip.play();\n        }\n      });\n    }\n  }\n\n  /**\n   * 暂停\n   */\n  public async pause() {\n    if (this.isPlaying) {\n      this.isPlaying = false;\n      this.clips.forEach((clip) => {\n        clip.pause();\n      });\n    }\n  }\n\n  /**\n   * 手动更新时间戳\n   */\n  public async setCurrentTime(currentTime: number) {\n    this.currentTime = Math.max(0, Math.min(currentTime, this.duration));\n    await this.onCurrentTimeChange(true);\n    if (this.currentTime >= this.duration) {\n      this.pause();\n      this.onEnd?.();\n    }\n  }\n\n  /**\n   * 时间戳变化\n   */\n  private async onCurrentTimeChange(isManual: boolean = false) {\n    let task: Promise<void>[] = [];\n    this.clips.forEach((clip) => {\n      if (this.isInRange(clip)) {\n        if (clip.isEntered) {\n          task.push(clip.onUpdate(isManual));\n        } else {\n          clip.isEntered = true;\n          clip.addToPainter();\n          task.push(clip.onEnter(isManual));\n        }\n      } else {\n        if (clip.isEntered) {\n          clip.isEntered = false;\n          clip.removeFromPainter();\n          task.push(clip.onLeave(isManual));\n        }\n      }\n    });\n    await Promise.all(task).catch((error) => {\n      alert(error.message);\n    });\n    task = [];\n    this.onCurrentTimeChangeCallback?.(this.currentTime);\n  }\n\n  /**\n   * 将播放器插入到指定节点\n   */\n  public attachTo(container: HTMLElement) {\n    container?.appendChild(this.painter.getDomElement());\n  }\n\n  /**\n   * 销毁播放器\n   */\n  public async destroy() {\n    cancelAnimationFrame(this.rafId);\n    let task: Promise<void>[] = [];\n    this.clips.forEach((clip) => {\n      task.push(clip.destroy());\n    });\n    await Promise.all(task).catch((error) => {\n      alert(error.message);\n    });\n    task = [];\n    this.clips.length = 0;\n    this.clips = [];\n    const canvas = this.painter.getDomElement();\n    if (canvas) {\n      canvas.parentNode?.removeChild(canvas);\n    }\n  }\n}\n","import React, { useCallback, useEffect, useRef } from 'react';\nimport { Clip } from '../../common/types/clip';\nimport Player from '../../player';\nimport { ClipBase } from '../../player/clips/base';\nimport { EditorContext, PlayerContext } from '../type';\n\n/**\n * 找出tracks出现了哪些改变\n */\nconst findDiff = (playerData: ClipBase[], newData: Clip[][]) => {\n  const newClips: Clip[] = [];\n  const deleteClips: string[] = [];\n  const flatNewData = newData.flat(1);\n  playerData.forEach((instance) => {\n    const newClip = flatNewData.find((clip) => clip.id === instance.config.id);\n    if (!newClip && instance.config.id) { // 表示删除\n      deleteClips.push(instance.config.id);\n    }\n  });\n  flatNewData.forEach((clip) => {\n    const oldClip = playerData.find((item) => item.config.id === clip.id);\n    if (!oldClip) {\n      newClips.push(clip);\n    }\n  });\n  return {\n    newClips,\n    deleteClips,\n  };\n}\n\n/**\n * clips增删\n */\nconst tracksChanged = async (player: Player, newClips: Clip[], deleteClips: string[]) => {\n  if (player) {\n    const task: Promise<void>[] = [];\n    newClips.forEach((clip) => {\n      task.push(player?.addClip(clip));\n    });\n    deleteClips.forEach((id) => {\n      task.push(player.removeClip(id));\n    });\n    await Promise.all(task).catch((error) => {\n      alert(error.message);\n    });\n  }\n};\n\nexport const usePlayer = (\n  editorContextValue: EditorContext,\n  containerRef: React.RefObject<HTMLDivElement>,\n): PlayerContext => {\n  const playerRef = useRef<Player>();\n  const {\n    tracks,\n    totalDuration,\n    setCurrentTime,\n    isPlaying,\n    setIsPlaying,\n  } = editorContextValue;\n\n  /**\n   * 初始化播放器\n   */\n  useEffect(() => {\n    if (!playerRef.current && containerRef.current) {\n      playerRef.current = new Player({\n        width: 768,\n        height: 432,\n        onCurrentTimeChange(currentTime: number) {\n          setCurrentTime(currentTime);\n        },\n        onEnd() {\n          setIsPlaying(false);\n        },\n      });\n      playerRef.current.attachTo(containerRef.current);\n    }\n  }, [containerRef, setCurrentTime, setIsPlaying, tracks]);\n\n  /**\n   * 增删\n   */\n  useEffect(() => {\n    if (playerRef.current && tracks.length) {\n      const { newClips, deleteClips } = findDiff(playerRef.current.clips, tracks);\n      tracksChanged(playerRef.current, newClips, deleteClips);\n    }\n  }, [tracks]);\n\n  /**\n   * 暂停/播放\n   */\n   const handleIsPlayingChange = useCallback(async (isPlaying: boolean) => {\n    if (playerRef.current) {\n      if (!isPlaying) {\n        await playerRef.current.pause();\n        setIsPlaying(false);\n      } else {\n        await playerRef.current.play();\n        setIsPlaying(true);\n      }\n    }\n  }, [setIsPlaying]);\n\n  /**\n   * 定位时长\n   */\n  const handleCurrentTimeChange = useCallback(async (currentTime: number) => {\n    const player = playerRef.current;\n    if (player) {\n      player.pause();\n      await player.setCurrentTime(currentTime);\n      setIsPlaying(false);\n      setCurrentTime(currentTime);\n    }\n  }, [setCurrentTime, setIsPlaying]);\n\n  /**\n   * 更新总时长\n   */\n  useEffect(() => {\n    if (playerRef.current && totalDuration >= 0) {\n      playerRef.current.updateDuration();\n    }\n  }, [totalDuration]);\n\n  return {\n    player: playerRef.current,\n    isPlaying,\n    setIsPlaying,\n    handleIsPlayingChange,\n    handleCurrentTimeChange,\n  };\n};\n","import { Select } from 'antd';\nimport React from 'react';\nimport { EffectType } from '../../types/player';\n\ntype Props = {\n  value: EffectType;\n  onChange(data: EffectType): void;\n};\n\nconst EffectSelector: React.FC<Props> = ({\n  value,\n  onChange,\n}) => {\n  return (\n    <div>\n      <Select value={value} onSelect={onChange}>\n        <Select.Option value={EffectType.NO_EFFECT}>无</Select.Option>\n        <Select.Option value={EffectType.BLUR}>高斯模糊</Select.Option>\n        <Select.Option value={EffectType.GRAY}>灰度</Select.Option>\n      </Select>\n    </div>\n  );\n};\n\nexport default EffectSelector;\n","import { Select } from 'antd';\nimport React from 'react';\nimport { FitType } from '../../types/player';\n\ntype Props = {\n  value: FitType;\n  onChange(data: FitType): void;\n};\n\nconst FitSelector: React.FC<Props> = ({\n  value,\n  onChange,\n}) => {\n  return (\n    <div>\n      <Select value={value} onSelect={onChange}>\n        <Select.Option value={FitType.CUSTOM}>自定义</Select.Option>\n        <Select.Option value={FitType.CONTAIN}>contain</Select.Option>\n        <Select.Option value={FitType.COVER}>cover</Select.Option>\n        <Select.Option value={FitType.FILL}>fill</Select.Option>\n      </Select>\n    </div>\n  );\n};\n\nexport default FitSelector;\n","import React, { useCallback } from 'react';\nimport { ImageClip } from '../../../../../common/types/clip';\nimport { EffectType, FitType } from '../../../../../common/types/player';\nimport EffectSelector from '../../../../../common/components/EffectSelector';\nimport FitSelector from '../../../../../common/components/FitSelector';\n\ntype Props = {\n  data: ImageClip;\n  onChange(data: Partial<ImageClip>): void;\n};\n\nconst ImagePanel: React.FC<Props> = ({ data, onChange }) => {\n  const handleEffectChange = useCallback((value: EffectType) => {\n    onChange({\n      effect: value,\n    });\n  }, [onChange]);\n  const handleFitChange = useCallback((value: FitType) => {\n    onChange({\n      positionInRender: {\n        ...data.positionInRender,\n        fitType: value,\n        width: data.originalWidth,\n        height: data.originalHeight,\n      },\n    });\n  }, [data.originalHeight, data.originalWidth, data.positionInRender, onChange]);\n  return (\n    <div>\n      <EffectSelector\n        value={data.effect}\n        onChange={handleEffectChange}\n      />\n      <FitSelector\n        value={data.positionInRender.fitType}\n        onChange={handleFitChange}\n      />\n    </div>\n  );\n};\n\nexport default ImagePanel;\n","import React, { useCallback } from 'react';\nimport { VideoClip } from '../../../../../common/types/clip';\nimport { EffectType, FitType } from '../../../../../common/types/player';\nimport EffectSelector from '../../../../../common/components/EffectSelector';\nimport FitSelector from '../../../../../common/components/FitSelector';\n\ntype Props = {\n  data: VideoClip;\n  onChange(data: Partial<VideoClip>): void;\n};\n\nconst VideoPanel: React.FC<Props> = ({ data, onChange }) => {\n  const handleEffectChange = useCallback((value: EffectType) => {\n    onChange({\n      effect: value,\n    });\n  }, [onChange]);\n  const handleFitChange = useCallback((value: FitType) => {\n    onChange({\n      positionInRender: {\n        ...data.positionInRender,\n        fitType: value,\n        width: data.originalWidth,\n        height: data.originalHeight,\n      },\n    });\n  }, [data.originalHeight, data.originalWidth, data.positionInRender, onChange]);\n  return (\n    <div>\n      <EffectSelector\n        value={data.effect}\n        onChange={handleEffectChange}\n      />\n      <FitSelector\n        value={data.positionInRender.fitType}\n        onChange={handleFitChange}\n      />\n    </div>\n  );\n};\n\nexport default VideoPanel;\n","import React, { useCallback, useContext, useEffect, useState } from 'react';\nimport { editorContext } from '../..';\nimport { Clip, ClipType, ImageClip, VideoClip } from '../../../common/types/clip';\nimport { getTrackAndClipIndex } from '../../util';\nimport ImagePanel from './components/ImagePanel';\nimport VideoPanel from './components/VideoPanel';\n\nfunction getPanel(data: Clip | undefined, onChange: (data: Partial<Clip>) => void) {\n  switch (data?.type) {\n    case ClipType.VIDEO:\n      return <VideoPanel data={data as VideoClip} onChange={onChange} />;\n    case ClipType.IMAGE:\n      return <ImagePanel data={data as ImageClip} onChange={onChange} />;\n    default:\n      return null;\n  }\n}\n\nconst ConfigPanel: React.FC = () => {\n  const { activeClipId, tracks, setTracks } = useContext(editorContext);\n  const [activeClip, setActiveClip] = useState<Clip>();\n  useEffect(() => {\n    const { trackIndex, clipIndex } = getTrackAndClipIndex(tracks, activeClipId);\n    setActiveClip(tracks[trackIndex]?.[clipIndex]);\n  }, [activeClipId, tracks]);\n  const handleChange = useCallback((data: Partial<Clip>) => {\n    if (activeClip) {\n      Object.assign(activeClip, data);\n      setTracks([...tracks]);\n    }\n  }, [activeClip, setTracks, tracks]);\n\n  // 防止选中的clip失焦\n  const handleClick = useCallback((e: React.MouseEvent) => {\n    e.stopPropagation();\n  }, []);\n  return (\n    <div style={{ width: 200 }} onClick={handleClick}>\n      {getPanel(activeClip, handleChange)}\n    </div>\n  );\n};\n\nexport default ConfigPanel;\n","import * as React from \"react\";\n\nfunction Logo(props: React.SVGProps<SVGSVGElement>) {\n  return (\n    <svg\n      width={19}\n      height={27}\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      xmlnsXlink=\"http://www.w3.org/1999/xlink\"\n      {...props}\n    >\n      <path fill=\"url(#prefix__pattern0)\" d=\"M0 0h19v27H0z\" />\n      <defs>\n        <pattern\n          id=\"prefix__pattern0\"\n          patternContentUnits=\"objectBoundingBox\"\n          width={1}\n          height={1}\n        >\n          <use\n            xlinkHref=\"#prefix__image0_348:26\"\n            transform=\"matrix(.01923 0 0 .01351 -.635 -.297)\"\n          />\n        </pattern>\n        <image\n          id=\"prefix__image0_348:26\"\n          width={120}\n          height={120}\n          xlinkHref=\"data:image/png;base64,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\"\n        />\n      </defs>\n    </svg>\n  );\n}\n\nexport default Logo;\n","import styled from 'styled-components';\n\nexport const StyledHeader = styled.div`\n  width: 100%;\n  height: 50px;\n  user-select: none;\n  overflow: hidden;\n  background: #1A2028;\n  position: relative;\n  z-index: 10000;\n  display: flex;\n  align-items: center;\n  padding-left: 20px;\n`;\n\nexport const ExportButton = styled.div`\n  position: absolute;\n  height: 28px;\n  right: 20px;\n  padding: 0 20px;\n  background: #38AA26;\n  border-radius: 99px;\n  text-align: center;\n  line-height: 28px;\n  cursor: pointer;\n  font-size: 12px;\n`;\n","import React, { useCallback } from 'react';\nimport Logo from '../../../icons/Logo';\nimport Player from '../../../player';\nimport { exportAsVideo } from '../../../player/util';\nimport { ExportButton, StyledHeader } from './styled';\n\ntype Props = {\n  player?: Player;\n};\n\nconst Header: React.FC<Props> = ({ player }) => {\n  const handleExportVideo = useCallback(() => {\n    if (player) {\n      exportAsVideo(player);\n    }\n  }, [player]);\n  return (\n    <StyledHeader>\n      <Logo />\n      <ExportButton onClick={handleExportVideo}>导出视频</ExportButton>\n    </StyledHeader>\n  );\n};\n\nexport default Header;\n","import * as React from 'react';\n\nfunction BackForward(props: React.SVGProps<SVGSVGElement>) {\n  return (\n    <svg\n      width={12}\n      height={12}\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      {...props}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M3 0H0v12h3V0zm9 0L5 6l7 6V0z\"\n        fill=\"#7B9FD6\"\n      />\n    </svg>\n  );\n}\n\nexport default BackForward;\n","import * as React from 'react';\n\nfunction Cut(props: React.SVGProps<SVGSVGElement>) {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width={14}\n      height={12}\n      fill=\"none\"\n      {...props}\n    >\n      <path\n        d=\"M12.898.317a.667.667 0 01-.212.918l-4.42 2.762 2.677 1.672h.035a3.167 3.167 0 11-1.803.466L7.009 4.783 4.834 6.14a3.167 3.167 0 11-1.759-.474l2.676-1.67-4.419-2.762a.667.667 0 01-.25-.85L1.12.317a.667.667 0 01.919-.212l4.97 3.106 4.97-3.106a.667.667 0 01.919.212zM3.167 7a1.833 1.833 0 100 3.667 1.833 1.833 0 000-3.667zm7.666 0a1.833 1.833 0 100 3.667 1.833 1.833 0 000-3.667z\"\n        fill=\"#7185A6\"\n      />\n    </svg>\n  );\n}\n\nexport default Cut;\n","import * as React from 'react';\n\nfunction Delete(props: React.SVGProps<SVGSVGElement>) {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width={14}\n      height={14}\n      fill=\"none\"\n      {...props}\n    >\n      <path\n        d=\"M12.667 2.467a.667.667 0 010 1.333h-.69l-.281 8.509a1.407 1.407 0 01-1.304 1.354l-.102.004H3.704a1.407 1.407 0 01-1.407-1.36L2.021 3.8h-.688a.667.667 0 110-1.332h11.334zm-2.024 1.332H3.357l.273 8.463c.001.03.02.055.046.066l.028.005h6.586c.04 0 .072-.031.073-.071l.28-8.463zM7 5.333A.667.667 0 017.667 6v4a.667.667 0 01-1.334 0V6A.667.667 0 017 5.333zm2.667-5a.667.667 0 110 1.334H4.333a.667.667 0 110-1.334h5.334z\"\n        fill=\"#7185A6\"\n      />\n    </svg>\n  );\n}\n\nexport default Delete;\n","import * as React from \"react\";\n\nfunction FastForward(props: React.SVGProps<SVGSVGElement>) {\n  return (\n    <svg\n      width={12}\n      height={12}\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      {...props}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M0 12l7-6-7-6v12zm9 0h3V0H9v12z\"\n        fill=\"#7B9FD6\"\n      />\n    </svg>\n  );\n}\n\nexport default FastForward;\n","import * as React from 'react';\n\nfunction PauseButton(props: React.SVGProps<SVGSVGElement>) {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width={10}\n      height={12}\n      fill=\"none\"\n      {...props}\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M3 0H0v12h3V0zm7 0H7v12h3V0z\"\n        fill=\"#7B9FD6\"\n      />\n    </svg>\n  );\n}\n\nexport default PauseButton;\n","import * as React from 'react';\n\nfunction PlayButton(props: React.SVGProps<SVGSVGElement>) {\n  return (\n    <svg\n      width={10}\n      height={12}\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      {...props}\n    >\n      <path d=\"M10 6L0 12V0l10 6z\" fill=\"#7B9FD6\" />\n    </svg>\n  );\n}\n\nexport default PlayButton;\n","import * as React from 'react';\n\nfunction Redo(props: React.SVGProps<SVGSVGElement>) {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width={14}\n      height={13}\n      fill=\"none\"\n      {...props}\n    >\n      <path\n        d=\"M9.18.877a.667.667 0 01.943-.03l3.333 3.13.056.06a.667.667 0 01-.055.912l-3.333 3.143-.065.053a.667.667 0 01-.878-.081l-.053-.065a.667.667 0 01.08-.878l2.255-2.124H4.827a3.163 3.163 0 00-3.16 3.166 3.164 3.164 0 003.015 3.164l.145.004h7.84a.667.667 0 01.078 1.328l-.079.005h-7.84a4.497 4.497 0 01-4.493-4.5A4.497 4.497 0 014.67 3.667l.158-.003h6.345L9.21 1.818l-.057-.061a.667.667 0 01.027-.88z\"\n        fill=\"#7185A6\"\n      />\n    </svg>\n  );\n}\n\nexport default Redo;\n","import * as React from 'react';\n\nfunction Undo(props: React.SVGProps<SVGSVGElement>) {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width={14}\n      height={13}\n      fill=\"none\"\n      {...props}\n    >\n      <path\n        d=\"M4.82.877a.667.667 0 00-.943-.03L.544 3.977l-.056.06a.667.667 0 00.055.912l3.333 3.143.065.053a.667.667 0 00.878-.081l.053-.065a.667.667 0 00-.08-.878L2.536 4.997h6.636a3.163 3.163 0 013.16 3.166 3.164 3.164 0 01-3.015 3.164l-.145.004h-7.84a.667.667 0 00-.078 1.328l.078.005h7.84a4.497 4.497 0 004.494-4.5A4.496 4.496 0 009.33 3.667l-.158-.003H2.827L4.79 1.818l.057-.061a.667.667 0 00-.027-.88z\"\n        fill=\"#7185A6\"\n      />\n    </svg>\n  );\n}\n\nexport default Undo;\n","import styled from 'styled-components';\n\nexport const StyledToolBar = styled.div`\n  height: 50px;\n  background: #1A2028;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  flex-shrink: 0;\n  padding: 0 24px;\n`;\n\nexport const PlayerControl = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  width: 40%;\n  min-width: 700px;\n`;\n\nexport const PlayButtons = styled.div`\n  width: 150px;\n  display: flex;\n  justify-content: space-between;\n`;\n\nexport const Time = styled.div`\n  font-family: monospace;\n  font-style: normal;\n  font-weight: normal;\n  font-size: 18px;\n  line-height: 21px;\n  color: #7185A6;\n`;\n\nexport const Ratios = styled.div`\n  display: flex;\n`;\n\nexport const ClipOperators = styled.div`\n  display: flex;\n  width: 170px;\n  justify-content: space-between;\n`;\n\nexport const TimeLineZoom = styled.div`\n  width: 200px;\n  flex-shrink: 0;\n`;\n","import React, { useCallback, useContext } from 'react';\nimport { editorContext } from '../..';\nimport { Radius10Button, Radius99Button } from '../../../common/styleds';\nimport { formatMillisecond } from '../../../common/utils';\nimport BackForward from '../../../icons/BackForward';\nimport Cut from '../../../icons/Cut';\nimport Delete from '../../../icons/Delete';\nimport FastForward from '../../../icons/FastForward';\nimport PauseButton from '../../../icons/pauseButton';\nimport PlayButton from '../../../icons/PlayButton';\nimport Redo from '../../../icons/Redo';\nimport Undo from '../../../icons/Undo';\nimport { PlayerContext } from '../../type';\nimport { deleteSelectedClip, splitSelectedClip } from '../../util';\nimport { ClipOperators, PlayButtons, PlayerControl, Ratios, StyledToolBar, Time, TimeLineZoom } from './styled';\n\ntype Props = {\n  playerContext: PlayerContext;\n};\n\nconst ToolBar: React.FC<Props> = ({ playerContext }) => {\n  const editorContextValue = useContext(editorContext);\n  const { isPlaying, totalDuration, currentTime } = editorContextValue;\n  const handlePlayingChange = useCallback(() => {\n    playerContext.handleIsPlayingChange(!isPlaying);\n  }, [playerContext, isPlaying]);\n  const handleDelete = useCallback(() => {\n    deleteSelectedClip(editorContextValue);\n  }, [editorContextValue]);\n  const handleSplitClip = useCallback(() => {\n    splitSelectedClip(editorContextValue);\n  }, [editorContextValue]);\n  const handleSetToStart = useCallback(() => {\n    playerContext.handleCurrentTimeChange(0);\n  }, [playerContext]);\n  const handleSetToEnd = useCallback(() => {\n    playerContext.handleCurrentTimeChange(totalDuration);\n  }, [playerContext, totalDuration]);\n  return (\n    <StyledToolBar>\n\n      <ClipOperators>\n        <Radius10Button>\n          <Undo />\n        </Radius10Button>\n        <Radius10Button>\n          <Redo />\n        </Radius10Button>\n        <Radius10Button onClick={handleSplitClip}>\n          <Cut />\n        </Radius10Button>\n        <Radius10Button onClick={handleDelete}>\n          <Delete />\n        </Radius10Button>\n      </ClipOperators>\n\n      <PlayerControl>\n        <PlayButtons>\n          <Radius10Button onClick={handleSetToStart}>\n            <BackForward />\n          </Radius10Button>\n          <Radius10Button style={{ width: 60 }} onClick={handlePlayingChange}>\n            {\n              isPlaying ? <PauseButton /> : <PlayButton />\n            }\n          </Radius10Button>\n          <Radius10Button onClick={handleSetToEnd}>\n            <FastForward />\n          </Radius10Button>\n        </PlayButtons>\n\n        <Time>\n          <span style={{ color: '#367CE4' }}>\n            {formatMillisecond(currentTime, true)}\n          </span> / {formatMillisecond(totalDuration, true)}\n        </Time>\n\n        <Ratios>\n          <Radius99Button style={{ marginRight: 16 }}>\n            16:9\n          </Radius99Button>\n          <Radius99Button>\n            9:16\n          </Radius99Button>\n        </Ratios>\n      </PlayerControl>\n\n      <TimeLineZoom>\n        \n      </TimeLineZoom>\n\n    </StyledToolBar>\n  );\n};\n\nexport default ToolBar;\n","import React, { useCallback, useRef } from 'react';\nimport ContentEditable, { ContentEditableEvent } from 'react-contenteditable';\nimport { TextClip } from '../../../../../common/types/clip';\nimport { getTextClipSize } from '../../../../../common/utils';\n\ntype Props = {\n  clip: TextClip;\n};\n\nconst TextEditor: React.FC<Props> = ({ clip }) => {\n  const { width, height } = clip.positionInRender;\n  const text = useRef(clip.value);\n  const contentEditableRef = useRef<HTMLElement>(null);\n  const handleChange = useCallback((e: ContentEditableEvent) => {\n    text.current = e.target.value;\n    Object.assign(clip, { value: text.current });\n    const newSize = getTextClipSize(clip);\n    Object.assign(clip, {\n      positionInRender: {\n        ...clip.positionInRender,\n        width: newSize.width,\n        height: newSize.height,\n      },\n    });\n  }, [clip]);\n\n  const handleBlur = useCallback(() => {\n    console.log(text.current);\n  }, []);\n  return (\n    <div style={{ width: width, height: height, overflow: 'hidden' }}>\n      <ContentEditable\n        innerRef={contentEditableRef}\n        html={text.current} // innerHTML of the editable div\n        disabled={false} // use true to disable editing\n        onChange={handleChange} // handle innerHTML change\n        onBlur={handleBlur}\n      />\n    </div>\n  );\n};\n\nexport default TextEditor;\n","import styled from 'styled-components';\n\nexport const StyledTarget = styled.div`\n  position: fixed;\n`;\n","import React, { useCallback, useContext, useEffect, useMemo, useState } from 'react';\nimport Moveable from 'react-moveable';\nimport { editorContext } from '../..';\nimport { ClipType, TextClip } from '../../../common/types/clip';\nimport { FitType } from '../../../common/types/player';\nimport { getClipRenderInfo } from '../../../player/util';\nimport { getPlayerContainerBounding, getTrackAndClipIndex } from '../../util';\nimport TextEditor from './components/TextEditor';\nimport { StyledTarget } from './styled';\n\nconst renderDirections = ['nw', 'ne', 'sw', 'se'];\n\nconst ResizeRotate: React.FC = () => {\n  const { activeClipId, tracks } = useContext(editorContext);\n  const [target, setTarget] = useState<HTMLDivElement | null>(null);\n  const [targetStyle, setTargetStyle] = useState<React.CSSProperties>({});\n  const [frame] = React.useState({ translate: [0, 0] });\n  const activeClip = useMemo(() => {\n    const { trackIndex, clipIndex } = getTrackAndClipIndex(tracks, activeClipId);\n    if (trackIndex > -1 && clipIndex > -1) {\n      return tracks[trackIndex][clipIndex];\n    }\n    return undefined;\n  }, [activeClipId, tracks]);\n\n  useEffect(() => {\n    if (activeClip) {\n      const { left: playerLeft, top, height: playerHeight, width: playerWidth } = getPlayerContainerBounding();\n      const { width, height, left, bottom } = getClipRenderInfo(activeClip, playerWidth, playerHeight);\n      setTargetStyle({\n        width,\n        height,\n        left: playerLeft + left,\n        top: top + playerHeight - bottom - height,\n        transform: `rotate(${activeClip.positionInRender.rotate}deg)`,\n      });\n      setTarget(document.querySelector('.resize-rotate') as HTMLDivElement);\n    } else {\n      setTarget(null);\n    }\n  }, [activeClip]);\n\n  const handleDragStart = useCallback(({ set }) => {\n    set(frame.translate);\n  }, [frame.translate]);\n\n  const handleDrag = useCallback(({ target, delta, beforeTranslate }) => {\n    frame.translate = beforeTranslate;\n    target.style.transform = `translate(${beforeTranslate[0]}px, ${beforeTranslate[1]}px)`;\n    if (activeClip) {\n      Object.assign(activeClip, {\n        positionInRender: {\n          ...activeClip.positionInRender,\n          fitType: FitType.CUSTOM,\n          left: activeClip.positionInRender.left + delta[0],\n          bottom: activeClip.positionInRender.bottom - delta[1],\n        },\n      });\n    }\n  }, [activeClip, frame]);\n\n  const handleResizeStart = useCallback(({ setOrigin, dragStart }) => {\n    setOrigin(['%', '%']);\n    dragStart && dragStart.set(frame.translate);\n  }, [frame.translate]);\n\n  const handleResize = useCallback(({ target, width, height, delta, drag, direction }) => {\n    const isDragBottom = direction[1] === 1;\n    const isDragLeft = direction[0] === -1;\n    const beforeTranslate = drag.beforeTranslate;\n    frame.translate = beforeTranslate;\n    if (activeClip) {\n      Object.assign(activeClip, {\n        positionInRender: {\n          ...activeClip.positionInRender,\n          fitType: FitType.CUSTOM,\n          width: width,\n          height: height,\n          ...(isDragLeft ? { left: activeClip.positionInRender.left - delta[0] } : null),\n          ...(isDragBottom ? { bottom: activeClip.positionInRender.bottom - delta[1] } : null),\n        },\n      });\n    }\n    delta[0] && (target!.style.width = `${width}px`);\n    delta[1] && (target!.style.height = `${height}px`);\n    target!.style.transform = `translate(${beforeTranslate[0]}px, ${beforeTranslate[1]}px)`;\n  }, [activeClip, frame]);\n\n  return (\n    <>\n      <StyledTarget className=\"resize-rotate\" style={targetStyle}>\n        {\n          activeClip && activeClip.type === ClipType.TEXT ? <TextEditor clip={activeClip as TextClip} /> : null\n        }\n      </StyledTarget>\n      <Moveable\n        target={target}\n        container={null}\n        origin={false}\n\n        renderDirections={renderDirections}\n\n        /* Resize event edges */\n        edge={false}\n\n        /* draggable */\n        draggable={true}\n        throttleDrag={0}\n        onDragStart={handleDragStart}\n        onDrag={handleDrag}\n\n        /* When resize or scale, keeps a ratio of the width, height. */\n        keepRatio={true}\n\n        /* resizable*/\n        /* Only one of resizable, scalable, warpable can be used. */\n        resizable={true}\n        throttleResize={0}\n        onResizeStart={handleResizeStart}\n        onResize={handleResize}\n      />\n    </>\n  );\n};\n\nexport default ResizeRotate;\n","import React, { useCallback, useEffect, useRef, useState } from 'react';\nimport SideBar from './components/SideBar';\nimport Tracks from './components/Tracks';\nimport {\n  Stage,\n  StyledEditor,\n  StyledEditorLeft,\n  StyledEditorRight,\n  StyledStageTimeline,\n  StyledTimelineWrapper,\n  TracksScrollContainer,\n} from './styled';\nimport { EditorContext } from './type';\nimport { Clip } from '../common/types/clip';\nimport Ruler from './components/Ruler';\nimport { getTotalDuration, millisecondsToWidth } from './util';\nimport { useKeyboard } from './hooks/keyboard';\nimport { INIT_EDITOR_CONTEXT } from './config';\nimport { usePlayer } from './hooks/player';\nimport ConfigPanel from './components/ConfigPanel';\nimport Header from './components/Header';\nimport ToolBar from './components/ToolBar';\nimport ResizeRotate from './components/ResizeRotate';\n\nexport const editorContext = React.createContext<EditorContext>(INIT_EDITOR_CONTEXT);\n\nconst Editor: React.FC = () => {\n  const [hoverTrack, setHoverTrack] = useState<HTMLElement | null>(null);\n  const [tracks, setTracks] = useState<Clip[][]>([[]]);\n  const [newTrackIndex, setNewTrackIndex] = useState(-1);\n  const [totalDuration, setTotalDuration] = useState(0);\n  const [activeClipId, setActiveClipId] = useState('');\n  const [currentTime, setCurrentTime] = useState(0);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [draggingClip, setDraggingClip] = useState<Clip>();\n  const playerContainerRef = useRef<HTMLDivElement>(null);\n\n  const handleTracksChange = useCallback((tracks: Clip[][]) => {\n    const newTracks = tracks.filter((track) => track.length);\n    const newTotalDuration = getTotalDuration(newTracks);\n    if (newTotalDuration !== totalDuration) {\n      setTotalDuration(newTotalDuration);\n      if (currentTime > newTotalDuration) {\n        setCurrentTime(newTotalDuration);\n      }\n    }\n    // 更新zIndex\n    newTracks.flat(1).forEach((clip, index) => {\n      clip.zIndex = index;\n    });\n    setTracks(newTracks.length ? newTracks : [[]]);\n  }, [currentTime, setCurrentTime, totalDuration]);\n\n  useEffect(() => {\n    // 更新容器的宽度\n    if (totalDuration) {\n      const scrollContainer = document.querySelector('.tracks-wrapper') as HTMLElement;\n      if (scrollContainer) {\n        const currentWidth = scrollContainer.clientWidth;\n        const newWidth = millisecondsToWidth(totalDuration);\n        if (currentWidth < newWidth) {\n          scrollContainer.style.width = `${newWidth + 100}px`;\n        }\n      }\n    }\n  }, [totalDuration]);\n\n  const editorContextValue = {\n    hoverTrack,\n    setHoverTrack,\n    tracks,\n    setTracks: handleTracksChange,\n    newTrackIndex,\n    setNewTrackIndex,\n    activeClipId,\n    setActiveClipId,\n    currentTime,\n    setCurrentTime,\n    totalDuration,\n    setTotalDuration,\n    isPlaying,\n    setIsPlaying,\n    draggingClip,\n    setDraggingClip,\n  };\n\n  const playerContext = usePlayer(editorContextValue, playerContainerRef);\n\n  // 绑定键盘操作\n  useKeyboard(editorContextValue, playerContext);\n\n  const handleDocumentClick = useCallback(() => {\n    if (activeClipId) {\n      setActiveClipId('');\n    }\n  }, [activeClipId]);\n\n  useEffect(() => {\n    document.removeEventListener('click', handleDocumentClick, false);\n    document.addEventListener('click', handleDocumentClick, false);\n    return () => {\n      document.removeEventListener('click', handleDocumentClick, false);\n    };\n  }, [handleDocumentClick]);\n\n  return (\n    <editorContext.Provider value={editorContextValue}>\n      <Header player={playerContext.player} />\n      <ResizeRotate />\n      <StyledEditor>\n        <StyledEditorLeft>\n          <SideBar />\n        </StyledEditorLeft>\n        <StyledEditorRight>\n          <StyledStageTimeline>\n            <Stage>\n              <div className=\"player-container\" ref={playerContainerRef} style={{ width: 768, height: 432 }}></div>\n              <ConfigPanel />\n            </Stage>\n            <StyledTimelineWrapper>\n              <ToolBar playerContext={playerContext} />\n              <TracksScrollContainer>\n                <Ruler />\n                <Tracks onCurrentTimeChange={playerContext.handleCurrentTimeChange} />\n              </TracksScrollContainer>\n            </StyledTimelineWrapper>\n          </StyledStageTimeline>\n        </StyledEditorRight>\n      </StyledEditor>\n    </editorContext.Provider>\n  );\n};\n\nexport default Editor;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport Editor from './editor';\nimport './index.css';\n\nReactDOM.render(\n  <React.StrictMode>\n    <Editor />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n","module.exports = THREE;","module.exports = FFmpeg;"],"sourceRoot":""}